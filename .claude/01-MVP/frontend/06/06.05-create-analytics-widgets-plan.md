# Task 06.05: Create Analytics Widgets

**Status**: ⏸️ Pending
**Estimated Duration**: 60 minutes
**Dependencies**: Task 06.02 (Analytics State Management) ✅, Task 06.03 (Recharts) ✅
**Priority**: High
**Created**: 2025-11-05

---

## Overview

Build reusable analytics widget components that display key statistics in a visually compelling format. These widgets serve as the primary "at-a-glance" metrics on the dashboard, highlighting user achievements, study habits, and progress milestones to drive engagement and motivation.

**What This Subtask Delivers**:
- 5 reusable widget components for displaying key analytics metrics
- Integration with analytics hooks for real-time data updates
- Responsive design with mobile-first approach
- Loading states and empty state handling
- Consistent visual design matching Style Guide specifications

**Why This Matters**:
Widgets are the first thing users see when opening the dashboard. They must:
- Provide instant gratification (streak, words mastered)
- Surface actionable insights (retention rate trends)
- Encourage daily habit formation (streak maintenance)
- Build confidence through visible progress milestones

---

## Objectives

1. Create **StatCard** component for displaying individual metrics with icon, label, value, and optional trend
2. Create **StreakWidget** component for study streak visualization with flame icon and milestone indicators
3. Create **WordStatusWidget** component for vocabulary breakdown by card state (New/Learning/Review/Mastered)
4. Create **RetentionWidget** component for displaying retention rate with percentage and visual indicator
5. Create **TimeStudiedWidget** component for showing total study time with formatted duration
6. Ensure all widgets use analytics hooks for data integration
7. Add responsive design and loading states
8. Export all widgets from barrel file

---

## Success Criteria

### Component Existence (8 criteria)

- [ ] SC1: **StatCard.tsx** component file created in `src/components/analytics/`
- [ ] SC2: **StreakWidget.tsx** component file created in `src/components/analytics/`
- [ ] SC3: **WordStatusWidget.tsx** component file created in `src/components/analytics/`
- [ ] SC4: **RetentionWidget.tsx** component file created in `src/components/analytics/`
- [ ] SC5: **TimeStudiedWidget.tsx** component file created in `src/components/analytics/`
- [ ] SC6: All 5 components exported from `src/components/analytics/index.ts` barrel file
- [ ] SC7: All components use TypeScript with proper interface definitions
- [ ] SC8: No 'any' types used in component implementations

### Data Integration (7 criteria)

- [ ] DI1: StreakWidget uses `useStudyStreak()` hook from Task 06.02
- [ ] DI2: WordStatusWidget uses `useAnalytics()` hook to fetch word status breakdown
- [ ] DI3: RetentionWidget uses `useAnalytics()` hook to display retention rate
- [ ] DI4: TimeStudiedWidget uses `useAnalytics()` hook for total time studied
- [ ] DI5: All widgets display real data from analytics store (not hardcoded values)
- [ ] DI6: Widgets update when analytics data changes (reactive to store updates)
- [ ] DI7: Widgets handle undefined/null data gracefully with fallback values (0, "N/A", etc.)

### Loading States (4 criteria)

- [ ] LS1: All widgets display Skeleton component during data loading
- [ ] LS2: Loading skeleton matches final component dimensions (no layout shift)
- [ ] LS3: Loading state triggered when `analyticsStore.isLoading === true`
- [ ] LS4: Smooth transition from loading to loaded state (no flash)

### Empty States (4 criteria)

- [ ] ES1: Widgets display appropriate empty state when no data available
- [ ] ES2: StreakWidget shows "0 days" with encouraging message for new users
- [ ] ES3: WordStatusWidget shows "No cards yet" message when all counts are zero
- [ ] ES4: RetentionWidget shows "N/A" or "--" when insufficient data (<7 days history)

### Visual Design (9 criteria)

- [ ] VD1: All widgets use Shadcn/ui Card component as base container
- [ ] VD2: Icons from Lucide React library (Flame, Trophy, Clock, TrendingUp, etc.)
- [ ] VD3: Color palette consistent with Style Guide:
  - Primary: `#667eea` (blue-purple gradient)
  - Success: `#10b981` (green for positive metrics)
  - Warning: `#f59e0b` (orange for attention-needed metrics)
  - Danger: `#ef4444` (red for low performance)
- [ ] VD4: Typography hierarchy:
  - Label: `text-sm` (14px) with `text-gray-500`
  - Value: `text-3xl` (30px) with `font-bold` and `text-gray-900`
  - Subtext: `text-xs` (12px) with `text-gray-400`
- [ ] VD5: Proper spacing and padding (Tailwind spacing scale: p-6, gap-2, mt-2)
- [ ] VD6: StreakWidget flame icon changes color based on streak status:
  - Active streak: `text-orange-500` with `bg-orange-100`
  - Inactive: `text-gray-400` with `bg-gray-100`
- [ ] VD7: RetentionWidget displays color-coded trend indicator:
  - Green (≥80%): `text-green-600`
  - Yellow (60-79%): `text-yellow-600`
  - Red (<60%): `text-red-600`
- [ ] VD8: Icons sized consistently (w-8 h-8 or w-5 h-5 depending on context)
- [ ] VD9: Hover states on clickable widgets (if applicable)

### Responsive Design (5 criteria)

- [ ] RD1: Widgets stack vertically on mobile (< 768px)
- [ ] RD2: Widgets display in 2-column grid on tablet (768px - 1024px)
- [ ] RD3: Widgets display in 4-column grid on desktop (≥ 1024px)
- [ ] RD4: Widget content remains readable at all viewport sizes (no text truncation)
- [ ] RD5: Icons and values scale appropriately with viewport size

### Accessibility (6 criteria)

- [ ] A1: All icons have `aria-hidden="true"` (decorative, not semantic)
- [ ] A2: Values have semantic HTML (use `<span>` with proper classes, not divs)
- [ ] A3: Labels use `<label>` or `<p>` tags with proper semantic structure
- [ ] A4: Color contrast meets WCAG AA standard (4.5:1 for text, 3:1 for large text)
- [ ] A5: Widgets have implicit ARIA roles from Shadcn Card component
- [ ] A6: No reliance on color alone to convey information (use icons + text + color)

### Specific Widget Requirements (25 criteria)

#### StatCard (Generic Reusable Component)
- [ ] SW1: Accepts `icon`, `label`, `value`, `subtext`, `trend` as props
- [ ] SW2: Supports optional `trendDirection` prop ("up" | "down" | "neutral")
- [ ] SW3: Trend arrow icon displays conditionally (TrendingUp, TrendingDown)
- [ ] SW4: Trend text color-coded (green for up, red for down, gray for neutral)
- [ ] SW5: Layout: icon on right, text on left (mirroring MetricCard from Task 02)

#### StreakWidget
- [ ] STR1: Displays current streak value (number of days)
- [ ] STR2: Displays longest streak as subtext ("Best: X days")
- [ ] STR3: Flame icon (`Flame` from lucide-react) with dynamic color
- [ ] STR4: Encouraging message changes based on streak length:
  - 0 days: "Start studying to build your streak!"
  - 1 day: "Great start! Come back tomorrow!"
  - 2-6 days: "Keep going! You're building momentum!"
  - 7-29 days: "Amazing! You're on fire!"
  - 30+ days: "Incredible dedication! Keep it up!"
- [ ] STR5: Border color changes when streak is active (border-orange-500)

#### WordStatusWidget
- [ ] WS1: Displays 4 card status categories with counts:
  - New: Gray badge
  - Learning: Blue badge
  - Review: Yellow badge
  - Mastered: Green badge
- [ ] WS2: Each status displays count and percentage of total
- [ ] WS3: Uses Badge component from Shadcn/ui for status labels
- [ ] WS4: Responsive: stacks vertically on mobile, 2x2 grid on tablet, 1x4 on desktop
- [ ] WS5: Total cards displayed as sum of all statuses

#### RetentionWidget
- [ ] RT1: Displays retention rate as percentage (0-100%)
- [ ] RT2: Shows trend indicator (↑ improving, ↓ declining, → stable)
- [ ] RT3: Color-coded based on retention threshold:
  - ≥80%: Green (success)
  - 60-79%: Yellow (warning)
  - <60%: Red (danger)
- [ ] RT4: Subtext explains metric ("% of cards remembered after 7+ days")
- [ ] RT5: Displays "N/A" when insufficient data (< 7 days of review history)

#### TimeStudiedWidget
- [ ] TS1: Displays total time studied in current date range
- [ ] TS2: Time formatted correctly (e.g., "12h 34m" or "45m")
- [ ] TS3: Clock icon (`Clock` from lucide-react)
- [ ] TS4: Comparison to previous period optional (e.g., "↑ 2h more than last week")
- [ ] TS5: Handles zero time gracefully ("0m" not blank)

---

## Implementation Details

### File Structure

```
src/components/analytics/
├── StatCard.tsx              (new) - Generic metric card
├── StreakWidget.tsx          (new) - Study streak display
├── WordStatusWidget.tsx      (new) - Card status breakdown
├── RetentionWidget.tsx       (new) - Retention rate display
├── TimeStudiedWidget.tsx     (new) - Study time tracking
└── index.ts                  (modify) - Add exports for new widgets
```

### 1. StatCard Component (Generic Reusable Widget)

**Purpose**: Reusable component for displaying a single metric with icon, label, value, and optional trend indicator.

**Props Interface**:
```typescript
interface StatCardProps {
  icon: React.ReactNode;
  label: string;
  value: string | number;
  subtext?: string;
  trend?: {
    value: string | number;
    direction: 'up' | 'down' | 'neutral';
  };
  colorScheme?: 'primary' | 'success' | 'warning' | 'danger';
  isLoading?: boolean;
}
```

**Implementation Structure**:
- Use Shadcn Card component as base
- Icon positioned top-right in colored circle background
- Label as small gray text (text-sm text-gray-500)
- Value as large bold number (text-3xl font-bold text-gray-900)
- Subtext as extra-small gray text below value (text-xs text-gray-400)
- Optional trend arrow with color-coded text

**Example Usage**:
```typescript
<StatCard
  icon={<Trophy className="h-5 w-5 text-green-600" />}
  label="Words Mastered"
  value={127}
  subtext="Your vocabulary is growing!"
  trend={{ value: "+15 this week", direction: "up" }}
  colorScheme="success"
/>
```

---

### 2. StreakWidget Component

**Purpose**: Display current study streak with motivational messaging and visual indicators.

**Props Interface**:
```typescript
interface StreakWidgetProps {
  isLoading?: boolean;
}
```

**Data Source**: `useStudyStreak()` hook

**Implementation Structure**:
- Uses StatCard or custom Card layout
- Flame icon (`Flame` from lucide-react) with dynamic color:
  - Active streak: orange (`text-orange-500`, `bg-orange-100`)
  - Inactive: gray (`text-gray-400`, `bg-gray-100`)
- Display current streak as main value
- Display longest streak as subtext ("Best: X days")
- Dynamic encouraging message based on streak length
- Border highlight when streak is active (`border-orange-500`)

**Message Logic**:
```typescript
const getMessage = (streakDays: number, isActive: boolean) => {
  if (!isActive) return 'Start studying to build your streak!';
  if (streakDays === 1) return 'Great start! Come back tomorrow!';
  if (streakDays < 7) return "Keep going! You're building momentum!";
  if (streakDays < 30) return "Amazing! You're on fire!";
  return 'Incredible dedication! Keep it up!';
};
```

**Implementation Example**:
```typescript
export const StreakWidget: React.FC<StreakWidgetProps> = ({ isLoading }) => {
  const { streak, isLoading: dataLoading } = useStudyStreak();
  const loading = isLoading || dataLoading;

  if (loading) {
    return <Skeleton className="h-32" />;
  }

  const message = getMessage(streak.currentStreak, streak.isActive);

  return (
    <Card className={streak.isActive ? 'border-orange-500' : ''}>
      <CardContent className="pt-6">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-sm font-medium text-gray-500">Study Streak</p>
            <div className="flex items-baseline gap-2 mt-2">
              <span className="text-3xl font-bold text-gray-900">
                {streak.currentStreak}
              </span>
              <span className="text-sm text-gray-500">
                {streak.currentStreak === 1 ? 'day' : 'days'}
              </span>
            </div>
            <p className="text-xs text-gray-400 mt-1">
              Best: {streak.longestStreak} {streak.longestStreak === 1 ? 'day' : 'days'}
            </p>
          </div>
          <div className={`p-3 rounded-full ${streak.isActive ? 'bg-orange-100' : 'bg-gray-100'}`}>
            <Flame
              className={`w-8 h-8 ${streak.isActive ? 'text-orange-500' : 'text-gray-400'}`}
              aria-hidden="true"
            />
          </div>
        </div>
        <p className="text-xs text-gray-500 mt-3">{message}</p>
      </CardContent>
    </Card>
  );
};
```

---

### 3. WordStatusWidget Component

**Purpose**: Display breakdown of vocabulary cards by learning state (New, Learning, Review, Mastered).

**Props Interface**:
```typescript
interface WordStatusWidgetProps {
  isLoading?: boolean;
}
```

**Data Source**: `useAnalytics()` hook → `dashboardData.wordStatusBreakdown`

**Implementation Structure**:
- Card component with title "Vocabulary Breakdown"
- 4 status rows with Badge + count + percentage
- Each status has icon and color:
  - New: Circle icon, gray
  - Learning: BookOpen icon, blue
  - Review: RefreshCw icon, yellow
  - Mastered: CheckCircle icon, green
- Total cards displayed at bottom as bold sum
- Responsive grid: mobile (1 col), tablet (2x2), desktop (1x4 or 2x2 depending on space)

**Status Breakdown Display**:
```typescript
const statuses = [
  { key: 'new', label: 'New', color: 'gray', icon: Circle },
  { key: 'learning', label: 'Learning', color: 'blue', icon: BookOpen },
  { key: 'review', label: 'Review', color: 'yellow', icon: RefreshCw },
  { key: 'mastered', label: 'Mastered', color: 'green', icon: CheckCircle },
];
```

**Implementation Example**:
```typescript
export const WordStatusWidget: React.FC<WordStatusWidgetProps> = ({ isLoading }) => {
  const { dashboardData, isLoading: dataLoading } = useAnalytics();
  const loading = isLoading || dataLoading;

  if (loading) {
    return <Skeleton className="h-48" />;
  }

  const wordStatus = dashboardData?.wordStatusBreakdown;
  if (!wordStatus || wordStatus.total === 0) {
    return (
      <Card>
        <CardHeader>
          <CardTitle>Vocabulary Breakdown</CardTitle>
        </CardHeader>
        <CardContent>
          <p className="text-gray-400 text-sm">No cards yet. Start learning!</p>
        </CardContent>
      </Card>
    );
  }

  const statuses = [
    { key: 'new', label: 'New', count: wordStatus.new, color: 'gray', Icon: Circle },
    { key: 'learning', label: 'Learning', count: wordStatus.learning, color: 'blue', Icon: BookOpen },
    { key: 'review', label: 'Review', count: wordStatus.review, color: 'yellow', Icon: RefreshCw },
    { key: 'mastered', label: 'Mastered', count: wordStatus.mastered, color: 'green', Icon: CheckCircle },
  ];

  return (
    <Card>
      <CardHeader>
        <CardTitle>Vocabulary Breakdown</CardTitle>
      </CardHeader>
      <CardContent className="space-y-3">
        {statuses.map(({ key, label, count, color, Icon }) => {
          const percentage = wordStatus.total > 0 ? Math.round((count / wordStatus.total) * 100) : 0;
          return (
            <div key={key} className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <Icon className={`h-4 w-4 text-${color}-500`} aria-hidden="true" />
                <span className="text-sm font-medium text-gray-700">{label}</span>
              </div>
              <div className="flex items-center gap-2">
                <Badge variant={color === 'green' ? 'default' : 'secondary'}>
                  {count}
                </Badge>
                <span className="text-xs text-gray-500 w-12 text-right">{percentage}%</span>
              </div>
            </div>
          );
        })}
        <div className="pt-3 border-t border-gray-200">
          <div className="flex items-center justify-between">
            <span className="text-sm font-bold text-gray-900">Total Cards</span>
            <span className="text-lg font-bold text-gray-900">{wordStatus.total}</span>
          </div>
        </div>
      </CardContent>
    </Card>
  );
};
```

---

### 4. RetentionWidget Component

**Purpose**: Display retention rate (% of cards remembered after 7+ days) with color-coded visual indicator.

**Props Interface**:
```typescript
interface RetentionWidgetProps {
  isLoading?: boolean;
}
```

**Data Source**: `useAnalytics()` hook → `dashboardData.retentionRate`

**Implementation Structure**:
- Uses StatCard or custom Card
- Display retention rate as percentage (0-100%)
- Color-coded based on threshold:
  - ≥80%: Green (text-green-600, bg-green-100)
  - 60-79%: Yellow (text-yellow-600, bg-yellow-100)
  - <60%: Red (text-red-600, bg-red-100)
- Trend indicator (↑ ↓ →) showing change from previous period
- Subtext: "% of cards remembered after 7+ days"
- Shows "N/A" when insufficient data (< 7 days history)

**Color Logic**:
```typescript
const getRetentionColor = (rate: number) => {
  if (rate >= 80) return { text: 'text-green-600', bg: 'bg-green-100', icon: 'text-green-600' };
  if (rate >= 60) return { text: 'text-yellow-600', bg: 'bg-yellow-100', icon: 'text-yellow-600' };
  return { text: 'text-red-600', bg: 'bg-red-100', icon: 'text-red-600' };
};
```

**Implementation Example**:
```typescript
export const RetentionWidget: React.FC<RetentionWidgetProps> = ({ isLoading }) => {
  const { dashboardData, isLoading: dataLoading } = useAnalytics();
  const loading = isLoading || dataLoading;

  if (loading) {
    return <Skeleton className="h-32" />;
  }

  const retentionRate = dashboardData?.retentionRate;
  const hasData = retentionRate !== null && retentionRate !== undefined;
  const displayValue = hasData ? `${Math.round(retentionRate)}%` : 'N/A';
  const colors = hasData ? getRetentionColor(retentionRate) : {
    text: 'text-gray-600',
    bg: 'bg-gray-100',
    icon: 'text-gray-600',
  };

  return (
    <Card>
      <CardContent className="pt-6">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-sm font-medium text-gray-500">Retention Rate</p>
            <div className="flex items-baseline gap-2 mt-2">
              <span className={`text-3xl font-bold ${colors.text}`}>
                {displayValue}
              </span>
              {hasData && (
                <TrendingUp className={`h-5 w-5 ${colors.icon}`} aria-hidden="true" />
              )}
            </div>
            <p className="text-xs text-gray-400 mt-1">
              % remembered after 7+ days
            </p>
          </div>
          <div className={`p-3 rounded-full ${colors.bg}`}>
            <Brain className={`w-8 h-8 ${colors.icon}`} aria-hidden="true" />
          </div>
        </div>
      </CardContent>
    </Card>
  );
};
```

---

### 5. TimeStudiedWidget Component

**Purpose**: Display total time studied in the selected date range with formatted duration.

**Props Interface**:
```typescript
interface TimeStudiedWidgetProps {
  isLoading?: boolean;
}
```

**Data Source**: `useAnalytics()` hook → `dashboardData.totalTimeStudied` (in minutes)

**Implementation Structure**:
- Uses StatCard or custom Card
- Display time in "Xh Ym" format (e.g., "12h 34m" or "45m")
- Clock icon (`Clock` from lucide-react)
- Subtext shows date range context (e.g., "in last 7 days")
- Optional trend comparison to previous period ("↑ 2h more than last week")
- Handles zero time gracefully ("0m" not blank)

**Time Formatting Logic**:
```typescript
const formatTimeStudied = (minutes: number): string => {
  if (minutes === 0) return '0m';
  const hours = Math.floor(minutes / 60);
  const mins = minutes % 60;
  if (hours > 0) {
    return `${hours}h ${mins}m`;
  }
  return `${mins}m`;
};
```

**Implementation Example**:
```typescript
export const TimeStudiedWidget: React.FC<TimeStudiedWidgetProps> = ({ isLoading }) => {
  const { dashboardData, dateRange, isLoading: dataLoading } = useAnalytics();
  const loading = isLoading || dataLoading;

  if (loading) {
    return <Skeleton className="h-32" />;
  }

  const timeStudied = dashboardData?.totalTimeStudied || 0;
  const formattedTime = formatTimeStudied(timeStudied);
  const rangeText = dateRange === '7days' ? 'in last 7 days' :
                    dateRange === '30days' ? 'in last 30 days' :
                    dateRange === 'today' ? 'today' : 'all time';

  return (
    <Card>
      <CardContent className="pt-6">
        <div className="flex items-center justify-between">
          <div>
            <p className="text-sm font-medium text-gray-500">Time Studied</p>
            <div className="mt-2">
              <span className="text-3xl font-bold text-gray-900">
                {formattedTime}
              </span>
            </div>
            <p className="text-xs text-gray-400 mt-1">{rangeText}</p>
          </div>
          <div className="p-3 rounded-full bg-blue-100">
            <Clock className="w-8 h-8 text-blue-600" aria-hidden="true" />
          </div>
        </div>
      </CardContent>
    </Card>
  );
};
```

---

## Dependencies

### Analytics Hooks (from Task 06.02)
- `useAnalytics()` - Primary hook for dashboard data
- `useStudyStreak()` - Study streak information
- `useProgressData()` - Progress chart data (not used in widgets)
- `useDeckPerformance()` - Deck stats (not used in widgets)

### Shadcn/ui Components
- `Card`, `CardHeader`, `CardTitle`, `CardContent` - Base widget container
- `Badge` - Status labels in WordStatusWidget
- `Skeleton` - Loading states

### Lucide React Icons
- `Flame` - StreakWidget
- `Trophy` - WordsMasteredWidget (if created)
- `Clock` - TimeStudiedWidget
- `Brain` - RetentionWidget
- `TrendingUp`, `TrendingDown` - Trend indicators
- `Circle`, `BookOpen`, `RefreshCw`, `CheckCircle` - WordStatusWidget status icons

### Utility Functions
- `formatTimeStudied()` - Convert minutes to "Xh Ym" format
- `getRetentionColor()` - Color logic for retention rate
- `getMessage()` - Dynamic streak encouragement messages

---

## Testing Checklist

### Component Rendering (10 tests)

- [ ] T1: StatCard renders with all props correctly
- [ ] T2: StreakWidget displays current streak and longest streak
- [ ] T3: StreakWidget flame icon changes color based on active/inactive state
- [ ] T4: WordStatusWidget displays 4 status categories with counts and percentages
- [ ] T5: RetentionWidget displays percentage with correct color coding (green/yellow/red)
- [ ] T6: TimeStudiedWidget displays formatted time correctly ("12h 34m" format)
- [ ] T7: All widgets display loading skeleton when `isLoading={true}`
- [ ] T8: All widgets display empty state when no data available
- [ ] T9: All widgets integrate with analytics hooks (no hardcoded data)
- [ ] T10: All widgets exported from barrel file and importable

### Data Integration (8 tests)

- [ ] D1: StreakWidget updates when streak changes in analytics store
- [ ] D2: WordStatusWidget counts sum to total correctly
- [ ] D3: WordStatusWidget percentages add up to 100%
- [ ] D4: RetentionWidget shows "N/A" when retention rate is null/undefined
- [ ] D5: TimeStudiedWidget displays "0m" when time is zero (not blank)
- [ ] D6: All widgets handle undefined analytics data without crashing
- [ ] D7: Widgets re-render when date range changes
- [ ] D8: Widgets reflect real user progress (not mock data)

### Visual Design (10 tests)

- [ ] V1: All widgets use consistent Card component styling
- [ ] V2: Icon sizes consistent across all widgets (w-8 h-8 or w-5 h-5)
- [ ] V3: Typography hierarchy correct (label: text-sm, value: text-3xl, subtext: text-xs)
- [ ] V4: Color palette matches Style Guide specifications
- [ ] V5: StreakWidget border color changes when streak active (orange border)
- [ ] V6: RetentionWidget color coding works for all thresholds (80%, 60%, <60%)
- [ ] V7: WordStatusWidget badges have correct colors (gray, blue, yellow, green)
- [ ] V8: Spacing and padding consistent (p-6, gap-2, mt-2)
- [ ] V9: Icons positioned consistently (right side of card)
- [ ] V10: No visual glitches or layout shifts

### Responsive Design (5 tests)

- [ ] R1: Widgets stack vertically on mobile (< 768px) - tested at 375px
- [ ] R2: Widgets display in 2-column grid on tablet (768px - 1024px)
- [ ] R3: Widgets display in 4-column grid on desktop (≥ 1024px)
- [ ] R4: Widget content readable at all viewport sizes
- [ ] R5: No horizontal scroll at any viewport width

### Accessibility (6 tests)

- [ ] A1: All icons have `aria-hidden="true"` attribute
- [ ] A2: Values use semantic HTML (spans, not divs)
- [ ] A3: Color contrast meets WCAG AA standard (4.5:1 text, 3:1 large text)
- [ ] A4: No reliance on color alone (icons + text + color used together)
- [ ] A5: Widgets inherit ARIA roles from Card component
- [ ] A6: Screen readers can read all metric values

### Edge Cases (6 tests)

- [ ] E1: StreakWidget handles 0-day streak correctly
- [ ] E2: StreakWidget displays correct message for 1-day, 7-day, 30+ day streaks
- [ ] E3: WordStatusWidget handles all-zero counts (empty state)
- [ ] E4: RetentionWidget shows "N/A" when < 7 days of data
- [ ] E5: TimeStudiedWidget formats large times correctly (e.g., "150h 23m")
- [ ] E6: All widgets handle null/undefined data without crashing

### Code Quality (5 tests)

- [ ] CQ1: TypeScript compilation succeeds with 0 errors
- [ ] CQ2: No 'any' types used in any widget implementation
- [ ] CQ3: ESLint passes with no warnings
- [ ] CQ4: All components properly typed with interfaces
- [ ] CQ5: Production build succeeds (`npm run build`)

---

## Documentation Updates

### Components-Reference.md

Add entries for all 5 new widget components:

```markdown
## Analytics Components

### StatCard

**File**: `src/components/analytics/StatCard.tsx`
**Purpose**: Generic reusable widget for displaying a single metric with icon, label, value, and optional trend

**Props**:
- `icon: React.ReactNode` - Icon element (from Lucide React)
- `label: string` - Metric label
- `value: string | number` - Main metric value
- `subtext?: string` - Optional explanatory text below value
- `trend?: { value: string | number, direction: 'up' | 'down' | 'neutral' }` - Optional trend indicator
- `colorScheme?: 'primary' | 'success' | 'warning' | 'danger'` - Color theme
- `isLoading?: boolean` - Show loading skeleton

**Usage**:
```tsx
<StatCard
  icon={<Trophy className="h-5 w-5 text-green-600" />}
  label="Words Mastered"
  value={127}
  subtext="Your vocabulary is growing!"
  trend={{ value: "+15 this week", direction: "up" }}
  colorScheme="success"
/>
```

### StreakWidget

**File**: `src/components/analytics/StreakWidget.tsx`
**Purpose**: Display current study streak with motivational messaging

**Props**:
- `isLoading?: boolean` - Show loading skeleton

**Data Source**: `useStudyStreak()` hook

**Features**:
- Dynamic flame icon color (orange when active, gray when inactive)
- Shows current streak and longest streak
- Encouraging messages based on streak length
- Border highlight when streak is active

**Usage**:
```tsx
<StreakWidget />
```

### WordStatusWidget

**File**: `src/components/analytics/WordStatusWidget.tsx`
**Purpose**: Display breakdown of vocabulary cards by learning state

**Props**:
- `isLoading?: boolean` - Show loading skeleton

**Data Source**: `useAnalytics()` hook → `wordStatusBreakdown`

**Features**:
- 4 status categories: New, Learning, Review, Mastered
- Badge + count + percentage for each status
- Color-coded icons (gray, blue, yellow, green)
- Total cards sum displayed at bottom

**Usage**:
```tsx
<WordStatusWidget />
```

### RetentionWidget

**File**: `src/components/analytics/RetentionWidget.tsx`
**Purpose**: Display retention rate with color-coded visual indicator

**Props**:
- `isLoading?: boolean` - Show loading skeleton

**Data Source**: `useAnalytics()` hook → `retentionRate`

**Features**:
- Color-coded based on threshold (green ≥80%, yellow 60-79%, red <60%)
- Shows "N/A" when insufficient data (< 7 days)
- Brain icon with matching color scheme
- Explanatory subtext

**Usage**:
```tsx
<RetentionWidget />
```

### TimeStudiedWidget

**File**: `src/components/analytics/TimeStudiedWidget.tsx`
**Purpose**: Display total time studied with formatted duration

**Props**:
- `isLoading?: boolean` - Show loading skeleton

**Data Source**: `useAnalytics()` hook → `totalTimeStudied`

**Features**:
- Time formatted as "Xh Ym" (e.g., "12h 34m")
- Clock icon with blue color scheme
- Date range context in subtext
- Handles zero time gracefully ("0m")

**Usage**:
```tsx
<TimeStudiedWidget />
```
```

### Style-Guide.md (if new patterns introduced)

If any new patterns are introduced (e.g., widget grid layout, new color combinations), document them in Style-Guide.md.

---

## Implementation Plan

### Step 1: Create StatCard Component (12 min)

**Goal**: Build generic reusable component for metric display

**Actions**:
1. Create `src/components/analytics/StatCard.tsx`
2. Define `StatCardProps` interface with all props
3. Implement component with Card base, icon positioning, value/label layout
4. Add optional trend indicator with TrendingUp/TrendingDown icons
5. Add color scheme variants (primary, success, warning, danger)
6. Implement loading skeleton
7. Add TypeScript types, ensure no 'any' types
8. Test with sample props

**Success**: StatCard renders with all props, supports all color schemes, displays loading state

---

### Step 2: Create StreakWidget Component (10 min)

**Goal**: Build study streak display with motivational messaging

**Actions**:
1. Create `src/components/analytics/StreakWidget.tsx`
2. Define `StreakWidgetProps` interface
3. Import `useStudyStreak()` hook
4. Implement Card layout with flame icon (dynamic color)
5. Display current streak, longest streak, encouraging message
6. Add getMessage() logic for dynamic messages
7. Add border highlight for active streaks (`border-orange-500`)
8. Implement loading skeleton
9. Test with different streak values (0, 1, 7, 30)

**Success**: StreakWidget displays streak, flame icon changes color, messages update correctly

---

### Step 3: Create WordStatusWidget Component (12 min)

**Goal**: Build vocabulary breakdown display

**Actions**:
1. Create `src/components/analytics/WordStatusWidget.tsx`
2. Define `WordStatusWidgetProps` interface
3. Import `useAnalytics()` hook
4. Implement Card layout with CardHeader ("Vocabulary Breakdown")
5. Create status array with icons and colors (Circle, BookOpen, RefreshCw, CheckCircle)
6. Map over statuses to display badge + count + percentage
7. Calculate percentages correctly (count / total * 100)
8. Display total cards at bottom with border separator
9. Implement empty state ("No cards yet")
10. Implement loading skeleton
11. Test with zero counts, partial counts, full counts

**Success**: WordStatusWidget displays 4 statuses, percentages sum to 100%, empty state works

---

### Step 4: Create RetentionWidget Component (10 min)

**Goal**: Build retention rate display with color coding

**Actions**:
1. Create `src/components/analytics/RetentionWidget.tsx`
2. Define `RetentionWidgetProps` interface
3. Import `useAnalytics()` hook
4. Implement `getRetentionColor()` logic (thresholds: 80%, 60%)
5. Implement Card layout with Brain icon
6. Display retention rate as percentage
7. Add color-coded text and icon background
8. Add trend indicator (TrendingUp icon)
9. Display "N/A" when retention rate is null/undefined
10. Implement loading skeleton
11. Test with different retention values (85%, 70%, 50%, null)

**Success**: RetentionWidget displays percentage, colors correct, "N/A" shows when no data

---

### Step 5: Create TimeStudiedWidget Component (10 min)

**Goal**: Build time studied display with formatted duration

**Actions**:
1. Create `src/components/analytics/TimeStudiedWidget.tsx`
2. Define `TimeStudiedWidgetProps` interface
3. Import `useAnalytics()` hook
4. Implement `formatTimeStudied()` utility function
5. Implement Card layout with Clock icon
6. Display formatted time as main value
7. Add date range context in subtext ("in last 7 days")
8. Handle zero time case ("0m" not blank)
9. Implement loading skeleton
10. Test with different time values (0, 45, 150, 1234 minutes)

**Success**: TimeStudiedWidget displays formatted time, date range context correct, zero handled

---

### Step 6: Create Barrel Export and Integration (6 min)

**Goal**: Export all widgets and prepare for dashboard integration

**Actions**:
1. Modify `src/components/analytics/index.ts`
2. Add exports for all 5 widgets:
   ```typescript
   export { StatCard } from './StatCard';
   export { StreakWidget } from './StreakWidget';
   export { WordStatusWidget } from './WordStatusWidget';
   export { RetentionWidget } from './RetentionWidget';
   export { TimeStudiedWidget } from './TimeStudiedWidget';
   ```
3. Verify all imports work from barrel file
4. Test TypeScript compilation (0 errors)
5. Test production build (`npm run build`)
6. Document all components in Components-Reference.md

**Success**: All widgets importable from `@/components/analytics`, TypeScript 0 errors, build succeeds

---

## Expected Deliverables

1. **5 widget components** (300-400 lines total):
   - StatCard.tsx (~80 lines)
   - StreakWidget.tsx (~90 lines)
   - WordStatusWidget.tsx (~110 lines)
   - RetentionWidget.tsx (~80 lines)
   - TimeStudiedWidget.tsx (~70 lines)

2. **TypeScript interfaces** for all props (no 'any' types)

3. **Integration with analytics hooks** (useAnalytics, useStudyStreak)

4. **Responsive design** implementation (mobile, tablet, desktop)

5. **Loading/error/empty state** handling for all widgets

6. **Documentation** in Components-Reference.md (5 new component entries)

---

## Notes

- **Reuse MetricCard Pattern**: If MetricCard from Task 02.08 is similar to StatCard, consider refactoring to unify them
- **Icon Consistency**: All icons from Lucide React library for visual consistency
- **Color Palette**: Use existing Tailwind theme colors (primary, success, warning, danger)
- **Analytics Hook Usage**: All widgets must pull from analytics hooks, not hardcoded data
- **Empty State Messaging**: Encouraging, not discouraging ("No cards yet. Start learning!" not "No data.")
- **Loading Performance**: Skeleton components should match final widget dimensions to prevent layout shift
- **Accessibility**: Ensure WCAG AA compliance (color contrast, semantic HTML, ARIA labels)
- **Mobile-First**: Design widgets to work on small screens first, then enhance for larger viewports

---

**Ready for Execution**: This plan can be handed off to an executor agent or developer for immediate implementation. All requirements, success criteria, and implementation steps are clearly defined.
