# Task 07.10: Add Error Boundary Components

**Status**: ðŸ“‹ **PLANNED** (OPTIONAL)
**Parent Task**: [Task 07 - UI Components](../07-ui-components.md)
**Track**: B - Refactoring (Optional)
**Priority**: Low
**Estimated Duration**: 75 minutes
**Dependencies**: None
**Deliverable**: ErrorBoundary and ErrorFallback components

---

## Objective

Add React Error Boundary to catch and display errors gracefully, preventing white screen of death and improving user experience during runtime errors.

---

## Components to Create

### 1. ErrorBoundary Component

**File**: `/src/components/errors/ErrorBoundary.tsx`

**Implementation**:
```typescript
import React, { Component, ErrorInfo, ReactNode } from 'react';

interface ErrorBoundaryProps {
  children: ReactNode;
  fallback?: ReactNode;
  onError?: (error: Error, errorInfo: ErrorInfo) => void;
}

interface ErrorBoundaryState {
  hasError: boolean;
  error: Error | null;
}

export class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {
  constructor(props: ErrorBoundaryProps) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('ErrorBoundary caught an error:', error, errorInfo);

    // Call optional error handler
    this.props.onError?.(error, errorInfo);

    // Log to error tracking service (Sentry, etc.)
    // logErrorToService(error, errorInfo);
  }

  handleReset = () => {
    this.setState({ hasError: false, error: null });
  };

  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }

      return <ErrorFallback error={this.state.error} onReset={this.handleReset} />;
    }

    return this.props.children;
  }
}
```

---

### 2. ErrorFallback Component

**File**: `/src/components/errors/ErrorFallback.tsx`

**Implementation**:
```typescript
import { AlertCircleIcon, RefreshCwIcon, HomeIcon } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { useNavigate } from 'react-router-dom';

interface ErrorFallbackProps {
  error: Error | null;
  onReset?: () => void;
}

export function ErrorFallback({ error, onReset }: ErrorFallbackProps) {
  const navigate = useNavigate();

  const handleGoHome = () => {
    navigate('/');
    onReset?.();
  };

  return (
    <div className="flex flex-col items-center justify-center min-h-screen p-8 bg-gray-50">
      <div className="max-w-md w-full space-y-6">
        <div className="text-center">
          <AlertCircleIcon className="h-16 w-16 text-red-500 mx-auto mb-4" />
          <h1 className="text-2xl font-bold text-gray-900 mb-2">
            Something went wrong
          </h1>
          <p className="text-muted">
            We're sorry, but something unexpected happened. Please try again.
          </p>
        </div>

        {error && import.meta.env.DEV && (
          <Alert variant="destructive">
            <AlertDescription className="text-xs font-mono overflow-auto max-h-48">
              <strong>Error:</strong> {error.message}
              {error.stack && (
                <>
                  <br />
                  <br />
                  <strong>Stack:</strong>
                  <pre className="text-xs whitespace-pre-wrap">{error.stack}</pre>
                </>
              )}
            </AlertDescription>
          </Alert>
        )}

        <div className="flex gap-3">
          <Button onClick={onReset} variant="outline" className="flex-1">
            <RefreshCwIcon className="mr-2 h-4 w-4" />
            Try Again
          </Button>
          <Button onClick={handleGoHome} className="flex-1">
            <HomeIcon className="mr-2 h-4 w-4" />
            Go Home
          </Button>
        </div>

        <p className="text-xs text-center text-muted">
          If this problem persists, please contact support.
        </p>
      </div>
    </div>
  );
}
```

---

## Integration Pattern

**Wrap entire app**:
```tsx
// App.tsx
import { ErrorBoundary } from '@/components/errors/ErrorBoundary';

function App() {
  return (
    <ErrorBoundary>
      <BrowserRouter>
        <Routes>
          {/* routes */}
        </Routes>
      </BrowserRouter>
    </ErrorBoundary>
  );
}
```

**Wrap specific features**:
```tsx
// Wrap analytics section
<ErrorBoundary fallback={<p>Failed to load analytics</p>}>
  <AnalyticsSection />
</ErrorBoundary>

// Wrap flashcard review
<ErrorBoundary onError={(error) => trackError(error)}>
  <FlashcardReviewPage />
</ErrorBoundary>
```

---

## Error Logging Integration

**Add error tracking service**:
```typescript
// src/lib/errorTracking.ts
export function logError(error: Error, errorInfo?: React.ErrorInfo) {
  if (import.meta.env.PROD) {
    // Send to Sentry, LogRocket, etc.
    // Sentry.captureException(error, { contexts: { react: errorInfo } });
  } else {
    console.error('Error logged:', error, errorInfo);
  }
}
```

---

## Implementation Steps

1. Create ErrorBoundary class component (30 min)
2. Create ErrorFallback component (20 min)
3. Wrap App.tsx with ErrorBoundary (5 min)
4. Add error logging (10 min)
5. Test error scenarios (10 min)

---

## Success Criteria

- [ ] ErrorBoundary component created
- [ ] ErrorFallback component created with good UX
- [ ] App wrapped with ErrorBoundary
- [ ] Error logging integrated
- [ ] Tested with intentional errors
- [ ] Development mode shows error details
- [ ] Production mode shows user-friendly message
- [ ] Documented in Components-Reference.md

---

## Testing Checklist

- [ ] Throw error in component â†’ ErrorBoundary catches it
- [ ] Error details shown in dev mode
- [ ] User-friendly message shown in prod mode
- [ ] "Try Again" button resets error state
- [ ] "Go Home" button navigates to home
- [ ] Error logged to console/service
- [ ] Nested ErrorBoundaries work correctly

---

## Time Breakdown

| Activity | Duration |
|----------|----------|
| Create ErrorBoundary | 30 min |
| Create ErrorFallback | 20 min |
| Integrate in App.tsx | 5 min |
| Add error logging | 10 min |
| Test error scenarios | 10 min |
| **TOTAL** | **75 min** |
