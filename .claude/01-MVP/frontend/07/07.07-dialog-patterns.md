# Task 07.07: Standardize Dialog Component Patterns

**Status**: ðŸ“‹ **PLANNED** (OPTIONAL)
**Parent Task**: [Task 07 - UI Components](../07-ui-components.md)
**Track**: B - Refactoring (Optional)
**Priority**: Low
**Estimated Duration**: 60 minutes
**Dependencies**: None
**Deliverable**: Standardized dialog components (ConfirmDialog, AlertDialog)

---

## Objective

Audit all dialog usage across the application and create reusable ConfirmDialog and AlertDialog base components to standardize modal patterns.

---

## Current Dialog Usage

**Existing Dialog Components**:
1. LogoutDialog - Confirmation dialog for logout
2. SessionWarningDialog - Session expiration warning
3. Inline dialogs in various pages (delete deck, cancel review, etc.)

**Patterns Identified**:
- **Confirmation dialogs**: Yes/No, Cancel/Confirm, Cancel/Delete
- **Alert dialogs**: OK-only, informational messages
- **Destructive actions**: Red warning icon, destructive button variant
- **Loading states**: Disabled buttons during async operations

---

## Components to Create

### 1. ConfirmDialog Component

**File**: `/src/components/dialogs/ConfirmDialog.tsx`

**Purpose**: Reusable confirmation dialog for any action requiring user confirmation

**Interface**:
```typescript
interface ConfirmDialogProps {
  open: boolean;
  onClose: () => void;
  onConfirm: () => void | Promise<void>;
  title: string;
  description: string;
  confirmText?: string;
  cancelText?: string;
  variant?: 'default' | 'destructive';
  loading?: boolean;
  icon?: React.ReactNode;
}
```

**Implementation Pattern**:
```tsx
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { LoaderIcon, AlertTriangleIcon } from 'lucide-react';
import { useState } from 'react';
import { cn } from '@/lib/utils';

export function ConfirmDialog({
  open,
  onClose,
  onConfirm,
  title,
  description,
  confirmText = 'Confirm',
  cancelText = 'Cancel',
  variant = 'default',
  loading: externalLoading,
  icon
}: ConfirmDialogProps) {
  const [internalLoading, setInternalLoading] = useState(false);
  const loading = externalLoading ?? internalLoading;

  const handleConfirm = async () => {
    setInternalLoading(true);
    try {
      await onConfirm();
      onClose();
    } catch (error) {
      // Error handled by caller
    } finally {
      setInternalLoading(false);
    }
  };

  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle className={cn(
            'flex items-center gap-2',
            variant === 'destructive' && 'text-red-600'
          )}>
            {icon || (variant === 'destructive' && <AlertTriangleIcon className="h-5 w-5" />)}
            {title}
          </DialogTitle>
          <DialogDescription>{description}</DialogDescription>
        </DialogHeader>

        <DialogFooter>
          <Button variant="outline" onClick={onClose} disabled={loading}>
            {cancelText}
          </Button>
          <Button
            variant={variant === 'destructive' ? 'destructive' : 'default'}
            onClick={handleConfirm}
            disabled={loading}
          >
            {loading ? (
              <>
                <LoaderIcon className="mr-2 h-4 w-4 animate-spin" />
                Processing...
              </>
            ) : (
              confirmText
            )}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

**Usage Examples**:
```tsx
import { ConfirmDialog } from '@/components/dialogs/ConfirmDialog';

// Logout confirmation
<ConfirmDialog
  open={showLogoutDialog}
  onClose={() => setShowLogoutDialog(false)}
  onConfirm={handleLogout}
  title="Confirm Logout"
  description="Are you sure you want to log out of your account?"
  confirmText="Logout"
/>

// Delete confirmation (destructive)
<ConfirmDialog
  open={showDeleteDialog}
  onClose={() => setShowDeleteDialog(false)}
  onConfirm={() => deleteDeck(deckId)}
  title="Delete Deck"
  description={`Are you sure you want to delete "${deckName}"? This will permanently delete all ${cardCount} flashcards and cannot be undone.`}
  confirmText="Delete Deck"
  variant="destructive"
/>

// Cancel review confirmation
<ConfirmDialog
  open={showCancelDialog}
  onClose={() => setShowCancelDialog(false)}
  onConfirm={handleCancelReview}
  title="Cancel Review Session"
  description="Are you sure you want to cancel? Your progress in this session will be saved."
  confirmText="Cancel Session"
  cancelText="Continue Reviewing"
/>
```

---

### 2. AlertDialog Component

**File**: `/src/components/dialogs/AlertDialog.tsx`

**Purpose**: Informational dialog with single action (OK/Close)

**Interface**:
```typescript
interface AlertDialogProps {
  open: boolean;
  onClose: () => void;
  title: string;
  description: string;
  variant?: 'default' | 'success' | 'error' | 'warning';
  actionText?: string;
  icon?: React.ReactNode;
}
```

**Implementation Pattern**:
```tsx
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { CheckCircleIcon, AlertCircleIcon, AlertTriangleIcon, InfoIcon } from 'lucide-react';
import { cn } from '@/lib/utils';

const VARIANT_ICONS = {
  success: <CheckCircleIcon className="h-5 w-5" />,
  error: <AlertCircleIcon className="h-5 w-5" />,
  warning: <AlertTriangleIcon className="h-5 w-5" />,
  default: <InfoIcon className="h-5 w-5" />
};

const VARIANT_COLORS = {
  success: 'text-green-600',
  error: 'text-red-600',
  warning: 'text-yellow-600',
  default: 'text-blue-600'
};

export function AlertDialog({
  open,
  onClose,
  title,
  description,
  variant = 'default',
  actionText = 'OK',
  icon
}: AlertDialogProps) {
  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle className={cn(
            'flex items-center gap-2',
            VARIANT_COLORS[variant]
          )}>
            {icon || VARIANT_ICONS[variant]}
            {title}
          </DialogTitle>
          <DialogDescription>{description}</DialogDescription>
        </DialogHeader>

        <DialogFooter>
          <Button onClick={onClose}>{actionText}</Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

**Usage Examples**:
```tsx
import { AlertDialog } from '@/components/dialogs/AlertDialog';

// Success message
<AlertDialog
  open={showSuccess}
  onClose={() => setShowSuccess(false)}
  title="Success"
  description="Your changes have been saved successfully."
  variant="success"
/>

// Error message
<AlertDialog
  open={!!error}
  onClose={() => setError(null)}
  title="Error"
  description={error || 'An unexpected error occurred. Please try again.'}
  variant="error"
/>

// Warning message
<AlertDialog
  open={showWarning}
  onClose={() => setShowWarning(false)}
  title="Session Expiring Soon"
  description="Your session will expire in 5 minutes. Please save your work."
  variant="warning"
  actionText="I Understand"
/>
```

---

## Refactoring Plan

### Pages/Components to Update

1. **LogoutDialog.tsx** â†’ Refactor to use ConfirmDialog
2. **SessionWarningDialog.tsx** â†’ Keep as-is (has custom timer logic)
3. **DecksPage** â†’ Add delete deck confirmation
4. **DeckDetailPage** â†’ Add delete card confirmation
5. **FlashcardReviewPage** â†’ Add cancel session confirmation
6. **Profile** â†’ Add delete account confirmation (if exists)

---

## Implementation Steps

### Step 1: Create Dialog Components (30 min)

1. Create `/src/components/dialogs/` directory
2. Implement ConfirmDialog component
3. Implement AlertDialog component
4. Create barrel export `/src/components/dialogs/index.ts`
5. Add TypeScript interfaces

### Step 2: Refactor LogoutDialog (10 min)

```tsx
// Before
export function LogoutDialog({ open, onClose }: LogoutDialogProps) {
  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Confirm Logout</DialogTitle>
          <DialogDescription>
            Are you sure you want to log out?
          </DialogDescription>
        </DialogHeader>
        <DialogFooter>
          <Button variant="outline" onClick={onClose}>Cancel</Button>
          <Button onClick={handleLogout}>Logout</Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}

// After
import { ConfirmDialog } from '@/components/dialogs/ConfirmDialog';

export function LogoutDialog({ open, onClose }: LogoutDialogProps) {
  const { logout } = useAuthStore();

  return (
    <ConfirmDialog
      open={open}
      onClose={onClose}
      onConfirm={logout}
      title="Confirm Logout"
      description="Are you sure you want to log out of your account?"
      confirmText="Logout"
    />
  );
}
```

### Step 3: Add Missing Confirmations (20 min)

Add confirmation dialogs where they're missing:

**Delete Deck in DecksPage**:
```tsx
import { ConfirmDialog } from '@/components/dialogs/ConfirmDialog';

const [deletingDeck, setDeletingDeck] = useState<Deck | null>(null);

<ConfirmDialog
  open={!!deletingDeck}
  onClose={() => setDeletingDeck(null)}
  onConfirm={async () => {
    await deckStore.deleteDeck(deletingDeck!.id);
    toast.success('Deck deleted');
  }}
  title="Delete Deck"
  description={`Are you sure you want to delete "${deletingDeck?.name}"? This will permanently delete all flashcards and cannot be undone.`}
  confirmText="Delete Deck"
  variant="destructive"
/>
```

**Cancel Review Session**:
```tsx
const [showCancelDialog, setShowCancelDialog] = useState(false);

<ConfirmDialog
  open={showCancelDialog}
  onClose={() => setShowCancelDialog(false)}
  onConfirm={handleCancelReview}
  title="Cancel Review Session"
  description="Your progress will be saved. You can resume this session later."
  confirmText="Cancel Session"
/>
```

---

## Success Criteria

- [ ] ConfirmDialog component created and tested
- [ ] AlertDialog component created and tested
- [ ] LogoutDialog refactored to use ConfirmDialog
- [ ] Delete confirmations added to DecksPage
- [ ] Cancel confirmation added to FlashcardReviewPage
- [ ] All dialogs follow consistent patterns
- [ ] No regressions in dialog functionality
- [ ] Dialog components documented in Components-Reference.md
- [ ] Dialog patterns updated in Style Guide

---

## Testing Checklist

- [ ] Confirmation dialogs show correct title/description
- [ ] Destructive variant shows red styling
- [ ] Loading state works during async operations
- [ ] Cancel button works
- [ ] Confirm button triggers action
- [ ] Dialog closes after confirmation
- [ ] Dialog closes on overlay click
- [ ] Dialog closes on Escape key
- [ ] Focus trapped within dialog
- [ ] Focus returns to trigger element on close

---

## Benefits

**Consistency**: All confirmation dialogs follow same pattern
**Maintainability**: Single source of truth for dialog behavior
**User Experience**: Consistent interaction patterns across app
**Code Reduction**: Eliminates ~50 lines per dialog instance

---

## Time Breakdown

| Activity | Duration |
|----------|----------|
| Create ConfirmDialog | 15 min |
| Create AlertDialog | 15 min |
| Refactor LogoutDialog | 10 min |
| Add missing confirmations | 20 min |
| **TOTAL** | **60 min** |
