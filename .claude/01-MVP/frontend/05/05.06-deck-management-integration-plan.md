# Task 05.06: Integrate with Deck Management - Implementation Plan

**Task ID**: 05.06
**Status**: ✅ **COMPLETED** (Verified 2025-11-04)
**Priority**: High
**Estimated Time**: 30 minutes
**Actual Time**: 30 minutes
**Dependencies**: 05.01, 05.02, 05.03, 05.04, 05.05
**Verification Report**: [05.06-verification-report.md](./05.06-verification-report.md)

---

## 1. Background and Context

### Previous Work Completed

Task 05 has successfully implemented a complete flashcard review system:

- **Task 05.01**: ✅ Review data types and mock service (50 min)
- **Task 05.02**: ✅ SM-2 spaced repetition algorithm (75 min)
- **Task 05.03**: ✅ Review state management with reviewStore (50 min)
- **Task 05.04**: ✅ Flashcard review interface with 19 components (90 min)
- **Task 05.05**: ✅ Session summary and statistics page (60 min)

### Current Architecture Status

**Completed Components**:
- `FlashcardReviewPage` - Full-screen review interface at `/decks/:deckId/review`
- `SessionSummaryPage` - Post-session statistics at `/decks/:deckId/summary`
- `reviewStore` - Full session lifecycle management (start, rate, flip, end)
- `mockReviewAPI` - localStorage-based review data persistence
- SM-2 algorithm implementation for spaced repetition

**Existing Infrastructure**:
- `DeckDetailPage` exists at `/decks/:id` with action buttons
- Routes already configured in `App.tsx` (lines 75-77)
- `deckStore` has `reviewSession()` method for progress updates
- Navigation handlers (`handleStartLearning`, `handleContinue`) exist but point to wrong routes

**Current Problem**:
The action buttons in `DeckDetailPage` currently navigate to `/learn/:deckId` (which doesn't exist), not to the review routes. The navigation flow is broken:
- ❌ "Start Learning" button → `/learn/:deckId` (404)
- ❌ "Continue Learning" button → `/learn/:deckId` (404)
- ✅ Review routes exist at `/decks/:deckId/review` and `/decks/:deckId/summary`

### Business Objective

Connect the deck management page to the review system to enable users to:
1. Start new review sessions directly from the deck detail page
2. See review statistics and progress on the deck page
3. Complete the full navigation loop: Deck → Review → Summary → Deck
4. Update deck progress automatically after completing review sessions

---

## 2. Technical Analysis

### 2.1 Current DeckDetailPage Architecture

**File**: `/src/pages/DeckDetailPage.tsx` (614 lines)

**Current Structure**:
```typescript
export const DeckDetailPage: React.FC = () => {
  // ... state and hooks

  return (
    <div className="container mx-auto max-w-4xl px-4 py-6 md:py-8">
      {/* Breadcrumb Navigation */}
      <nav>...</nav>

      <div className="space-y-6">
        {/* Deck Header Section */}
        <DeckHeaderSection deck={selectedDeck} isPremiumLocked={isPremiumLocked} />

        {/* Statistics Section */}
        <StatisticsSection deck={selectedDeck} />

        {/* Action Buttons Section */}
        <ActionButtonsSection
          deck={selectedDeck}
          isPremiumLocked={isPremiumLocked}
          deckStatus={deckStatus}
          onStartLearning={() => handleStartLearning(deckId, startLearning, navigate)}
          onContinue={() => handleContinue(deckId, navigate)}
          onUpgrade={() => handleUpgrade(navigate)}
        />
      </div>
    </div>
  );
};
```

**Current Navigation Handlers** (Lines 118-141):
```typescript
const handleStartLearning = async (
  deckId: string,
  startLearning: (id: string) => Promise<void>,
  navigate: any
) => {
  try {
    await startLearning(deckId);
    // TODO: Navigate to learning session when implemented
    navigate(`/learn/${deckId}`); // ❌ WRONG ROUTE
  } catch (error) {
    console.error('Failed to start learning:', error);
  }
};

const handleContinue = (deckId: string, navigate: any) => {
  // TODO: Navigate to learning session when implemented
  navigate(`/learn/${deckId}`); // ❌ WRONG ROUTE
};
```

**Current StatisticsSection** (Lines 268-340):
- Shows basic deck stats (total cards, estimated time)
- Shows progress if deck is started (mastery rate, accuracy)
- Shows card distribution (new, learning, mastered)
- **MISSING**: Review-specific statistics (cards due today, last review date)

### 2.2 Review System Integration Points

**reviewStore API** (from `/src/stores/reviewStore.ts`):
```typescript
interface ReviewState {
  // Session management
  startSession: (deckId: string, maxCards?: number) => Promise<void>;
  endSession: () => Promise<SessionSummary>;

  // Computed getters
  readonly currentCard: CardReview | null;
  readonly progress: { current: number; total: number };
  readonly hasNextCard: boolean;
}
```

**mockReviewAPI Methods** (from `/src/services/mockReviewAPI.ts`):
```typescript
export const mockReviewAPI = {
  getReviewQueue: (deckId: string, maxCards: number) => Promise<CardReview[]>;
  startReviewSession: (deckId, cardIds?, config?) => Promise<ReviewSession>;
  submitCardRating: (sessionId, cardId, rating, timeSpent) => Promise<SpacedRepetitionData>;
  endReviewSession: (sessionId) => Promise<SessionSummary>;
  getCardHistory: (cardId) => Promise<SpacedRepetitionData | null>;
}
```

**localStorage Data Structure**:
```typescript
// Key: 'learn-greek-easy:review-data'
// Value: Record<cardId, SpacedRepetitionData>
interface SpacedRepetitionData {
  cardId: string;
  deckId: string;
  interval: number; // Days until next review
  easeFactor: number; // SM-2 ease factor
  repetitions: number; // Consecutive successes
  state: 'new' | 'learning' | 'review' | 'relearning' | 'mastered';
  step: number; // Learning step
  dueDate: Date | null; // When card is due
  lastReviewed: Date | null; // Last review timestamp
  reviewCount: number; // Total reviews
  successCount: number; // Successful reviews
  failureCount: number; // Failed reviews
  successRate: number; // Percentage (0-100)
}
```

### 2.3 Data Flow Analysis

**Current Flow (Broken)**:
1. User clicks "Start Learning" on DeckDetailPage
2. `handleStartLearning()` calls `deckStore.startLearning(deckId)`
3. Navigation to `/learn/:deckId` → 404 Not Found

**Required Flow**:
1. User clicks "Start Review" on DeckDetailPage
2. Navigation to `/decks/:deckId/review` (FlashcardReviewPage)
3. FlashcardReviewPage calls `reviewStore.startSession(deckId)`
4. User completes review session
5. Auto-navigation to `/decks/:deckId/summary` (SessionSummaryPage)
6. User clicks "Back to Deck"
7. Navigation to `/decks/:deckId` with updated progress

**Key Insight**: The review system architecture is already complete. We just need to:
- ✅ Fix navigation routes in DeckDetailPage
- ✅ Add review statistics display (cards due, last review)
- ✅ Ensure deckStore updates after session completion

### 2.4 Statistics Calculation Requirements

**Need to Display**:
1. **Cards Due Today**: Count of cards with `dueDate <= today`
2. **New Cards Available**: Count of cards with `state === 'new'`
3. **Learning Cards**: Count of cards with `state === 'learning' || state === 'relearning'`
4. **Mastered Cards**: Count of cards with `state === 'mastered'`
5. **Last Review Date**: Most recent `lastReviewed` timestamp across all cards

**Data Source**: localStorage key `'learn-greek-easy:review-data'`

**Calculation Logic**:
```typescript
function calculateReviewStats(deckId: string): ReviewStats {
  const reviewData = loadReviewData(); // From localStorage
  const allCards = getCardsForDeck(deckId); // From mockReviewData
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  let dueCount = 0;
  let newCount = 0;
  let learningCount = 0;
  let masteredCount = 0;
  let lastReviewed: Date | null = null;

  allCards.forEach((card) => {
    const srData = reviewData[card.id] || card.srData;

    // Count by state
    if (srData.state === 'new') newCount++;
    else if (srData.state === 'learning' || srData.state === 'relearning') learningCount++;
    else if (srData.state === 'mastered') masteredCount++;

    // Count due cards
    if (srData.state === 'new' || (srData.dueDate && srData.dueDate <= today)) {
      dueCount++;
    }

    // Track latest review date
    if (srData.lastReviewed && (!lastReviewed || srData.lastReviewed > lastReviewed)) {
      lastReviewed = srData.lastReviewed;
    }
  });

  return {
    dueToday: dueCount,
    cardsNew: newCount,
    cardsLearning: learningCount,
    cardsMastered: masteredCount,
    lastReviewed,
  };
}
```

---

## 3. Component Architecture

### 3.1 Decision: Inline vs. Separate Components

**Analysis**:
- Task 05.06 is allocated **30 minutes** (tight timeline)
- DeckDetailPage already has inline components (`StatisticsSection`, `ActionButtonsSection`)
- Review statistics are simple data displays (numbers + labels)
- Creating separate components adds overhead (files, exports, props drilling)

**Decision**: **Inline implementation** - Add review statistics directly to the existing `StatisticsSection` component.

**Rationale**:
- ✅ Faster implementation (no new files)
- ✅ Consistent with existing DeckDetailPage architecture
- ✅ Reduced complexity (no prop interfaces)
- ✅ Easier to maintain (fewer files)
- ⚠️ Component slightly larger, but still manageable (< 100 lines)

### 3.2 Modified StatisticsSection

**Location**: Inside `/src/pages/DeckDetailPage.tsx` (lines 268-340)

**New Structure**:
```typescript
const StatisticsSection: React.FC<StatisticsSectionProps> = ({ deck }) => {
  const { progress } = deck;

  // NEW: Calculate review statistics from localStorage
  const reviewStats = useMemo(() => calculateReviewStats(deck.id), [deck.id]);

  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-lg font-semibold">Deck Statistics</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-2 gap-4 md:grid-cols-4">
          {/* Existing stats: Total Cards, Estimated Time */}

          {/* NEW: Review-specific stats (if deck started) */}
          {progress && progress.status !== 'not-started' && (
            <>
              <StatCard
                icon={<Clock className="h-5 w-5 text-red-500" />}
                label="Due Today"
                value={reviewStats.dueToday}
                subtext="cards to review"
              />
              <StatCard
                icon={<BookOpen className="h-5 w-5 text-blue-500" />}
                label="New Cards"
                value={reviewStats.cardsNew}
                subtext="not started"
              />
            </>
          )}
        </div>

        {/* NEW: Last review date (if deck has been reviewed) */}
        {reviewStats.lastReviewed && (
          <div className="mt-4 border-t pt-4 text-center text-sm text-gray-600">
            Last reviewed: {formatRelativeDate(reviewStats.lastReviewed)}
          </div>
        )}

        {/* Existing: Card Distribution */}
        {progress && progress.status !== 'not-started' && (
          <div className="mt-6 grid grid-cols-3 gap-4 border-t pt-4">
            {/* Existing new/learning/mastered display */}
          </div>
        )}
      </CardContent>
    </Card>
  );
};
```

**Data Flow**:
1. Component receives `deck` prop with `id`
2. `calculateReviewStats()` reads from localStorage
3. `useMemo()` caches calculation (only recomputes when `deck.id` changes)
4. Render stats inline using existing `StatCard` component

### 3.3 Modified ActionButtonsSection

**Location**: Inside `/src/pages/DeckDetailPage.tsx` (lines 361-493)

**Changes Required**:
- Update button labels: "Start Learning" → "Start Review"
- Update button labels: "Continue Learning" → "Continue Review"
- Update subtext to reference review statistics
- Navigation routes already correct through parent handlers

**Modified In-Progress State**:
```typescript
{!isPremiumLocked && deckStatus === 'in-progress' && (
  <div className="py-8 text-center">
    <TrendingUp className="mx-auto mb-4 h-12 w-12 text-green-500" />
    <h3 className="mb-2 text-lg font-semibold text-gray-900">Continue Your Progress</h3>
    <p className="mx-auto mb-2 max-w-md text-sm text-gray-600">
      {/* NEW: Show due cards from reviewStats instead of deck.progress.dueToday */}
      You have {reviewStats?.dueToday || 0} cards due for review today.
    </p>
    <p className="mb-6 text-xs text-gray-500">Keep your streak going!</p>
    <Button
      size="lg"
      onClick={onContinue}
      className="bg-gradient-to-br from-green-600 to-emerald-600 text-white hover:from-green-700 hover:to-emerald-700"
    >
      Continue Review {/* UPDATED LABEL */}
    </Button>
  </div>
)}
```

---

## 4. Data Flow and Calculations

### 4.1 Review Statistics Utility Function

**Create Helper**: `/src/lib/reviewStatsHelpers.ts`

**Purpose**: Centralize review statistics calculation logic for reusability.

```typescript
// src/lib/reviewStatsHelpers.ts

import { getCardsForDeck } from '@/services/mockReviewData';

/**
 * localStorage key for review data
 */
const REVIEW_DATA_KEY = 'learn-greek-easy:review-data';

/**
 * Review statistics for a deck
 */
export interface DeckReviewStats {
  dueToday: number; // Cards due for review today
  cardsNew: number; // Cards not yet started
  cardsLearning: number; // Cards in learning state
  cardsMastered: number; // Cards mastered (21+ day interval)
  lastReviewed: Date | null; // Most recent review timestamp
}

/**
 * Load review data from localStorage
 */
function loadReviewData(): Record<string, any> {
  try {
    const data = localStorage.getItem(REVIEW_DATA_KEY);
    if (!data) return {};

    const parsed = JSON.parse(data);

    // Convert date strings back to Date objects
    Object.values(parsed).forEach((sr: any) => {
      if (sr.dueDate) sr.dueDate = new Date(sr.dueDate);
      if (sr.lastReviewed) sr.lastReviewed = new Date(sr.lastReviewed);
    });

    return parsed;
  } catch (error) {
    console.error('Failed to load review data from localStorage:', error);
    return {};
  }
}

/**
 * Calculate review statistics for a deck
 *
 * @param deckId - Deck ID to calculate stats for
 * @returns Review statistics object
 */
export function calculateDeckReviewStats(deckId: string): DeckReviewStats {
  const reviewData = loadReviewData();
  const allCards = getCardsForDeck(deckId);

  // Set today to midnight for accurate due date comparison
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  let dueCount = 0;
  let newCount = 0;
  let learningCount = 0;
  let masteredCount = 0;
  let lastReviewed: Date | null = null;

  allCards.forEach((card) => {
    // Get SR data from localStorage, fall back to card default
    const srData = reviewData[card.id] || card.srData;

    // Count cards by state
    if (srData.state === 'new') {
      newCount++;
    } else if (srData.state === 'learning' || srData.state === 'relearning') {
      learningCount++;
    } else if (srData.state === 'mastered') {
      masteredCount++;
    }

    // Count due cards (new cards are always due)
    if (srData.state === 'new') {
      dueCount++;
    } else if (srData.dueDate) {
      const dueDate = new Date(srData.dueDate);
      dueDate.setHours(0, 0, 0, 0);
      if (dueDate <= today) {
        dueCount++;
      }
    }

    // Track latest review date
    if (srData.lastReviewed) {
      const reviewDate = new Date(srData.lastReviewed);
      if (!lastReviewed || reviewDate > lastReviewed) {
        lastReviewed = reviewDate;
      }
    }
  });

  return {
    dueToday: dueCount,
    cardsNew: newCount,
    cardsLearning: learningCount,
    cardsMastered: masteredCount,
    lastReviewed,
  };
}

/**
 * Format date as relative time (e.g., "2 hours ago", "3 days ago")
 *
 * @param date - Date to format
 * @returns Human-readable relative time string
 */
export function formatRelativeDate(date: Date | null): string {
  if (!date) return 'Never';

  const now = new Date();
  const diffMs = now.getTime() - new Date(date).getTime();
  const diffSeconds = Math.floor(diffMs / 1000);
  const diffMinutes = Math.floor(diffSeconds / 60);
  const diffHours = Math.floor(diffMinutes / 60);
  const diffDays = Math.floor(diffHours / 24);

  if (diffSeconds < 60) {
    return 'Just now';
  } else if (diffMinutes < 60) {
    return `${diffMinutes} minute${diffMinutes !== 1 ? 's' : ''} ago`;
  } else if (diffHours < 24) {
    return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
  } else if (diffDays < 30) {
    return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;
  } else {
    // Fall back to formatted date
    return new Intl.DateTimeFormat('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric',
    }).format(new Date(date));
  }
}
```

**Key Features**:
- ✅ Reusable across components
- ✅ Handles edge cases (no reviews yet, missing data)
- ✅ Efficient localStorage access
- ✅ Type-safe with TypeScript interfaces
- ✅ Human-readable date formatting

### 4.2 Integration with DeckDetailPage

**Import in DeckDetailPage**:
```typescript
import { calculateDeckReviewStats, formatRelativeDate } from '@/lib/reviewStatsHelpers';
```

**Usage in StatisticsSection**:
```typescript
const StatisticsSection: React.FC<StatisticsSectionProps> = ({ deck }) => {
  const { progress } = deck;

  // Calculate review stats (memoized to avoid recalculating on every render)
  const reviewStats = useMemo(
    () => calculateDeckReviewStats(deck.id),
    [deck.id]
  );

  // ... rest of component
};
```

**Usage in ActionButtonsSection**:
```typescript
const ActionButtonsSection: React.FC<ActionButtonsSectionProps> = ({
  deck,
  isPremiumLocked,
  deckStatus,
  onStartLearning,
  onContinue,
  onUpgrade,
}) => {
  // Calculate review stats for button text
  const reviewStats = useMemo(
    () => calculateDeckReviewStats(deck.id),
    [deck.id]
  );

  // ... rest of component
};
```

---

## 5. Implementation Steps

### Step 1: Create Review Statistics Helper (5 minutes)

**Create file**: `/src/lib/reviewStatsHelpers.ts`

**Implementation**:
1. Copy utility functions from Section 4.1
2. Export `calculateDeckReviewStats()` function
3. Export `formatRelativeDate()` function
4. Export `DeckReviewStats` interface

**Verification**:
- TypeScript compiles with 0 errors
- No import errors

---

### Step 2: Update Navigation Handlers (3 minutes)

**File**: `/src/pages/DeckDetailPage.tsx` (lines 118-141)

**Changes**:

```typescript
// BEFORE (lines 118-131)
const handleStartLearning = async (
  deckId: string,
  startLearning: (id: string) => Promise<void>,
  navigate: any
) => {
  try {
    await startLearning(deckId);
    // TODO: Navigate to learning session when implemented
    navigate(`/learn/${deckId}`); // ❌ WRONG
  } catch (error) {
    console.error('Failed to start learning:', error);
    // Error is handled by store
  }
};

// AFTER
const handleStartLearning = async (
  deckId: string,
  startLearning: (id: string) => Promise<void>,
  navigate: any
) => {
  try {
    await startLearning(deckId);
    // Navigate to review session
    navigate(`/decks/${deckId}/review`); // ✅ CORRECT
  } catch (error) {
    console.error('Failed to start learning:', error);
    // Error is handled by store
  }
};

// BEFORE (lines 133-136)
const handleContinue = (deckId: string, navigate: any) => {
  // TODO: Navigate to learning session when implemented
  navigate(`/learn/${deckId}`); // ❌ WRONG
};

// AFTER
const handleContinue = (deckId: string, navigate: any) => {
  // Navigate to review session
  navigate(`/decks/${deckId}/review`); // ✅ CORRECT
};
```

**Verification**:
- Clicking "Start Learning" navigates to `/decks/:deckId/review`
- Clicking "Continue Learning" navigates to `/decks/:deckId/review`
- FlashcardReviewPage loads successfully

---

### Step 3: Update StatisticsSection Component (10 minutes)

**File**: `/src/pages/DeckDetailPage.tsx` (lines 268-340)

**Changes**:

1. **Add import** (top of file):
```typescript
import { calculateDeckReviewStats, formatRelativeDate } from '@/lib/reviewStatsHelpers';
import { useMemo } from 'react'; // Add if not already imported
```

2. **Add review stats calculation**:
```typescript
const StatisticsSection: React.FC<StatisticsSectionProps> = ({ deck }) => {
  const { progress } = deck;

  // Calculate review statistics from localStorage
  const reviewStats = useMemo(
    () => calculateDeckReviewStats(deck.id),
    [deck.id]
  );

  // ... rest of component
};
```

3. **Add "Due Today" stat card** (after "Estimated Time" card):
```typescript
{/* Cards Due Today (if deck started) */}
{progress && progress.status !== 'not-started' && (
  <StatCard
    icon={<Clock className="h-5 w-5 text-red-500" />}
    label="Due Today"
    value={reviewStats.dueToday}
    subtext="cards to review"
  />
)}
```

4. **Add last review date** (after card distribution section):
```typescript
{/* Last Review Date (if reviewed) */}
{reviewStats.lastReviewed && (
  <div className="mt-4 border-t pt-4 text-center text-sm text-gray-600">
    Last reviewed: {formatRelativeDate(reviewStats.lastReviewed)}
  </div>
)}
```

**Final StatisticsSection Layout**:
- **Row 1** (grid-cols-2 md:grid-cols-4):
  - Total Cards (always shown)
  - Estimated Time (always shown)
  - Due Today (shown if deck started)
  - Mastery Rate OR Accuracy (shown if deck started)
- **Row 2** (border-top):
  - Card Distribution: New / Learning / Mastered (shown if deck started)
- **Row 3** (border-top):
  - Last Review Date (shown if reviewed)

**Verification**:
- ✅ "Due Today" stat displays correct count
- ✅ Last review date shows human-readable format
- ✅ Stats update after completing a review session
- ✅ Responsive layout (2x2 on mobile, 1x4 on desktop)

---

### Step 4: Update ActionButtonsSection Component (8 minutes)

**File**: `/src/pages/DeckDetailPage.tsx` (lines 361-493)

**Changes**:

1. **Add review stats calculation**:
```typescript
const ActionButtonsSection: React.FC<ActionButtonsSectionProps> = ({
  deck,
  isPremiumLocked,
  deckStatus,
  onStartLearning,
  onContinue,
  onUpgrade,
}) => {
  const { reviewSession } = useDeckStore();
  const [isSimulating, setIsSimulating] = useState(false);

  // Calculate review statistics for button text
  const reviewStats = useMemo(
    () => calculateDeckReviewStats(deck.id),
    [deck.id]
  );

  // ... rest of component
};
```

2. **Update "Not Started" state button label** (line 432-436):
```typescript
// BEFORE
<Button
  size="lg"
  onClick={onStartLearning}
  className="bg-gradient-to-br from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700"
>
  Start Learning
</Button>

// AFTER
<Button
  size="lg"
  onClick={onStartLearning}
  className="bg-gradient-to-br from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700"
>
  Start Review
</Button>
```

3. **Update "In Progress" state** (lines 442-456):
```typescript
// BEFORE
<h3 className="mb-2 text-lg font-semibold text-gray-900">Continue Your Progress</h3>
<p className="mx-auto mb-2 max-w-md text-sm text-gray-600">
  You have {deck.progress?.dueToday || 0} cards due for review today.
</p>
<p className="mb-6 text-xs text-gray-500">Keep your streak going!</p>
<Button
  size="lg"
  onClick={onContinue}
  className="bg-gradient-to-br from-green-600 to-emerald-600 text-white hover:from-green-700 hover:to-emerald-700"
>
  Continue Learning
</Button>

// AFTER
<h3 className="mb-2 text-lg font-semibold text-gray-900">Continue Your Progress</h3>
<p className="mx-auto mb-2 max-w-md text-sm text-gray-600">
  You have {reviewStats.dueToday} cards due for review today.
</p>
<p className="mb-6 text-xs text-gray-500">Keep your streak going!</p>
<Button
  size="lg"
  onClick={onContinue}
  className="bg-gradient-to-br from-green-600 to-emerald-600 text-white hover:from-green-700 hover:to-emerald-700"
>
  Continue Review
</Button>
```

4. **Update "Completed" state button label** (line 483-486):
```typescript
// BEFORE
<Button
  size="lg"
  onClick={onContinue}
  className="bg-gradient-to-br from-purple-600 to-pink-600 text-white hover:from-purple-700 hover:to-pink-700"
>
  Review Deck
</Button>

// AFTER (label is already correct, no change needed)
<Button
  size="lg"
  onClick={onContinue}
  className="bg-gradient-to-br from-purple-600 to-pink-600 text-white hover:from-purple-700 hover:to-pink-700"
>
  Review Deck
</Button>
```

**Verification**:
- ✅ Button labels updated ("Start Review", "Continue Review")
- ✅ Due cards count accurate
- ✅ Buttons navigate to correct routes

---

### Step 5: Verify Routes Configuration (2 minutes)

**File**: `/src/App.tsx` (lines 75-77)

**Current configuration** (ALREADY CORRECT):
```typescript
{/* Review page outside AppLayout for full-screen experience */}
<Route path="decks/:deckId/review" element={<FlashcardReviewPage />} />
{/* Session summary page outside AppLayout for full-screen experience */}
<Route path="decks/:deckId/summary" element={<SessionSummaryPage />} />
```

**Verification**:
- ✅ `/decks/:deckId/review` route exists
- ✅ `/decks/:deckId/summary` route exists
- ✅ Routes are outside `AppLayout` (full-screen)
- ✅ Routes are protected (inside `ProtectedRoute`)

**Action**: No changes needed - routes already configured correctly.

---

### Step 6: Test Complete Navigation Flow (2 minutes)

**Test Scenario 1: New User Flow**
1. Navigate to `/decks/deck-a1-basics` (deck detail page)
2. Verify "Start Review" button is visible
3. Click "Start Review"
4. Verify navigation to `/decks/deck-a1-basics/review`
5. Verify FlashcardReviewPage loads with cards
6. Complete review session (rate all cards)
7. Verify auto-navigation to `/decks/deck-a1-basics/summary`
8. Click "Back to Deck"
9. Verify navigation to `/decks/deck-a1-basics`
10. Verify deck progress updated (stats changed)

**Test Scenario 2: Returning User Flow**
1. Navigate to `/decks/deck-a1-basics` (already started deck)
2. Verify "Continue Review" button is visible
3. Verify "Due Today" stat shows correct count
4. Verify "Last reviewed" date is displayed
5. Click "Continue Review"
6. Verify navigation to `/decks/deck-a1-basics/review`
7. Complete session and verify stats update

**Test Scenario 3: Empty Queue Flow**
1. Complete all due cards in a deck
2. Navigate to `/decks/:deckId`
3. Verify "Due Today" shows 0
4. Click "Continue Review"
5. Verify error message: "No cards available for review"
6. User stays on deck detail page

**Verification**:
- ✅ All navigation flows work correctly
- ✅ Stats update after session completion
- ✅ No 404 errors
- ✅ No console errors

---

## 6. DeckDetailPage Integration Plan

### 6.1 Visual Layout Changes

**Before Integration**:
```
┌─────────────────────────────────────────┐
│ Breadcrumb: Decks / Greek Title        │
├─────────────────────────────────────────┤
│ Deck Header                             │
│ - Title (Greek + English)               │
│ - Level Badge, Premium Badge            │
│ - Description                           │
│ - Progress Bar (if started)             │
├─────────────────────────────────────────┤
│ Deck Statistics                         │
│ ┌──────┬──────┬──────┬──────┐          │
│ │Total │ Time │Master│Accura│          │
│ │Cards │      │ Rate │ cy   │          │
│ └──────┴──────┴──────┴──────┘          │
│                                         │
│ Card Distribution (if started)          │
│ New: 50 | Learning: 30 | Mastered: 5   │
├─────────────────────────────────────────┤
│ Action Buttons                          │
│ [Start Learning] or [Continue Learning] │
└─────────────────────────────────────────┘
```

**After Integration**:
```
┌─────────────────────────────────────────┐
│ Breadcrumb: Decks / Greek Title        │
├─────────────────────────────────────────┤
│ Deck Header                             │
│ - Title (Greek + English)               │
│ - Level Badge, Premium Badge            │
│ - Description                           │
│ - Progress Bar (if started)             │
├─────────────────────────────────────────┤
│ Deck Statistics                         │
│ ┌──────┬──────┬──────┬──────┐          │
│ │Total │ Time │ Due  │Master│ ← NEW    │
│ │Cards │      │Today │ Rate │          │
│ └──────┴──────┴──────┴──────┘          │
│                                         │
│ Card Distribution (if started)          │
│ New: 50 | Learning: 30 | Mastered: 5   │
│                                         │
│ Last reviewed: 2 hours ago     ← NEW    │
├─────────────────────────────────────────┤
│ Action Buttons                          │
│ You have 15 cards due today    ← UPDATED│
│ [Start Review] or [Continue Review]     │
└─────────────────────────────────────────┘
```

### 6.2 Responsive Behavior

**Mobile (< 768px)**:
- Statistics grid: 2x2 layout
- Cards Due + Total Cards (row 1)
- Estimated Time + Mastery Rate (row 2)
- Card distribution: 3 columns (compact)
- Last reviewed: Full width below distribution

**Desktop (≥ 768px)**:
- Statistics grid: 1x4 layout (all in one row)
- Card distribution: 3 columns (spacious)
- Last reviewed: Full width below distribution

### 6.3 Loading States

**Initial Load**:
- Show skeleton loaders for stat cards
- Disable action buttons until stats loaded

**After Review Session**:
- Briefly show loading spinner on "Back to Deck" navigation
- Refresh statistics automatically (React re-render)
- No manual refresh needed (stats calculated from localStorage)

### 6.4 Empty States

**No Reviews Yet (New Deck)**:
- Don't show "Due Today" stat
- Don't show "Last reviewed" text
- Show only "Total Cards" and "Estimated Time"
- Show "Start Review" button

**All Cards Mastered (Completed Deck)**:
- Show "Due Today: 0"
- Show "Last reviewed" date
- Show "Review Deck" button (allows continued practice)
- Button click may show "No cards due" message

---

## 7. Documentation Updates

### 7.1 Components-Reference.md Updates

**File**: `.claude/01-MVP/frontend/Components-Reference.md`

**Section to Add**: `### DeckDetailPage - Review Integration`

**Content**:
```markdown
### DeckDetailPage - Review Integration

**Location**: `/src/pages/DeckDetailPage.tsx`

**Review Integration Features**:

The DeckDetailPage now integrates with the flashcard review system (Task 05) to provide seamless navigation to review sessions.

**Review Statistics Display**:

The `StatisticsSection` component displays live review statistics:
- **Due Today**: Number of cards scheduled for review today (includes new cards)
- **Last Reviewed**: Human-readable relative time (e.g., "2 hours ago")
- Statistics are calculated from localStorage review data
- Updates automatically after completing review sessions

**Navigation Flow**:
1. User clicks "Start Review" or "Continue Review"
2. Navigation to `/decks/:deckId/review` (FlashcardReviewPage)
3. User completes review session
4. Auto-navigation to `/decks/:deckId/summary` (SessionSummaryPage)
5. User clicks "Back to Deck"
6. Return to `/decks/:deckId` with updated statistics

**Helper Functions**:

Review statistics are calculated using utility functions from `/src/lib/reviewStatsHelpers.ts`:

```typescript
import { calculateDeckReviewStats, formatRelativeDate } from '@/lib/reviewStatsHelpers';

// Calculate stats for a deck
const reviewStats = calculateDeckReviewStats(deckId);
// Returns: { dueToday, cardsNew, cardsLearning, cardsMastered, lastReviewed }

// Format date as relative time
const timeAgo = formatRelativeDate(lastReviewDate);
// Returns: "2 hours ago", "3 days ago", etc.
```

**Data Source**:
- localStorage key: `'learn-greek-easy:review-data'`
- Contains `Record<cardId, SpacedRepetitionData>`
- Updated by `mockReviewAPI` after each card review
- Persists across browser sessions

**Button Labels**:
- Not Started: "Start Review"
- In Progress: "Continue Review" (shows due cards count)
- Completed: "Review Deck"

**Edge Cases Handled**:
- No reviews yet: Don't show "Due Today" or "Last reviewed"
- All cards mastered: Show "Due Today: 0"
- Empty review queue: Error message from FlashcardReviewPage
```

### 7.2 Update Task 05 Main Documentation

**File**: `.claude/01-MVP/frontend/05/05-flashcard-review.md`

**Update Section**: `### 05.06: Integrate with Deck Management`

**Change Status**:
```markdown
### 05.06: Integrate with Deck Management

**Status**: ✅ Completed
**Duration**: 30 minutes (estimated), XX minutes (actual)
**Priority**: High

**Completed Changes**:
- ✅ Fixed navigation handlers to point to `/decks/:deckId/review`
- ✅ Added review statistics display (due today, last reviewed)
- ✅ Updated button labels ("Start Review", "Continue Review")
- ✅ Created `reviewStatsHelpers.ts` utility module
- ✅ Integrated review stats into StatisticsSection
- ✅ Tested complete navigation flow

**Files Modified**:
- `/src/pages/DeckDetailPage.tsx` - Updated handlers and statistics
- `/src/lib/reviewStatsHelpers.ts` - NEW utility module

**Files Verified (No Changes Needed)**:
- `/src/App.tsx` - Routes already configured correctly
- `/src/stores/reviewStore.ts` - Already updates deck progress
```

---

## 8. Success Criteria

### 8.1 Functional Requirements

- ✅ **Navigation**: Clicking "Start Review" navigates to `/decks/:deckId/review`
- ✅ **Navigation**: Clicking "Continue Review" navigates to `/decks/:deckId/review`
- ✅ **Statistics**: "Due Today" displays correct count from localStorage
- ✅ **Statistics**: "Last reviewed" displays human-readable relative time
- ✅ **Flow**: Review session → Summary → Back to Deck works correctly
- ✅ **Updates**: Deck statistics refresh after completing review session
- ✅ **Edge Cases**: Handles no reviews yet (don't show stats)
- ✅ **Edge Cases**: Handles 0 due cards (show "0 cards to review")

### 8.2 Technical Requirements

- ✅ **TypeScript**: 0 compilation errors
- ✅ **Build**: Production build succeeds (`npm run build`)
- ✅ **Console**: No console errors during navigation flow
- ✅ **Imports**: All imports resolve correctly
- ✅ **Types**: All functions properly typed

### 8.3 User Experience Requirements

- ✅ **Responsive**: Layout works on mobile (< 768px) and desktop
- ✅ **Performance**: Statistics calculation is fast (< 100ms)
- ✅ **Clarity**: Button labels are clear ("Review" not "Learning")
- ✅ **Feedback**: Due cards count provides actionable information
- ✅ **Consistency**: Visual design matches existing DeckDetailPage style

### 8.4 Code Quality Requirements

- ✅ **Modularity**: Statistics logic extracted to reusable utility
- ✅ **Memoization**: Statistics calculation uses `useMemo()` for performance
- ✅ **Comments**: Helper functions have JSDoc comments
- ✅ **Naming**: Variable names are descriptive (`reviewStats`, not `stats`)
- ✅ **DRY**: No duplicate code across components

---

## 9. Time Breakdown

**Total Estimated Time**: 30 minutes

| Step | Task | Estimated | Actual |
|------|------|-----------|--------|
| 1 | Create reviewStatsHelpers.ts utility | 5 min | ___ min |
| 2 | Update navigation handlers (2 functions) | 3 min | ___ min |
| 3 | Update StatisticsSection (add stats) | 10 min | ___ min |
| 4 | Update ActionButtonsSection (button labels) | 8 min | ___ min |
| 5 | Verify routes configuration | 2 min | ___ min |
| 6 | Test complete navigation flow | 2 min | ___ min |
| **TOTAL** | | **30 min** | **___ min** |

**Breakdown by File**:
- `/src/lib/reviewStatsHelpers.ts`: 5 min (new file)
- `/src/pages/DeckDetailPage.tsx`: 21 min (modifications)
- `/src/App.tsx`: 0 min (no changes needed)
- Testing: 4 min

**Buffer**: No buffer included (tight 30-minute constraint). If time runs over, skip "Last reviewed" date feature and focus on core navigation + due cards count.

---

## 10. Files to Create/Modify

### 10.1 Files to Create

**New Files** (1 file):
1. `/src/lib/reviewStatsHelpers.ts` - Utility functions for review statistics

### 10.2 Files to Modify

**Modified Files** (1 file):
1. `/src/pages/DeckDetailPage.tsx` - Update handlers, add review statistics

**Lines to Change**:
- Line 126: `navigate(\`/learn/\${deckId}\`)` → `navigate(\`/decks/\${deckId}/review\`)`
- Line 135: `navigate(\`/learn/\${deckId}\`)` → `navigate(\`/decks/\${deckId}/review\`)`
- Lines 268-340: Update `StatisticsSection` component
- Lines 361-493: Update `ActionButtonsSection` component

### 10.3 Files to Update (Documentation)

**Documentation Files** (2 files):
1. `.claude/01-MVP/frontend/Components-Reference.md` - Add DeckDetailPage review integration section
2. `.claude/01-MVP/frontend/05/05-flashcard-review.md` - Update Task 05.06 status to completed

### 10.4 Files Verified (No Changes)

**No changes needed** (3 files):
1. `/src/App.tsx` - Routes already correct
2. `/src/stores/reviewStore.ts` - Already updates deck progress
3. `/src/services/mockReviewAPI.ts` - No changes needed

---

## 11. Example Code

### 11.1 Complete reviewStatsHelpers.ts

See Section 4.1 for full implementation (97 lines).

### 11.2 Updated StatisticsSection Component

```typescript
const StatisticsSection: React.FC<StatisticsSectionProps> = ({ deck }) => {
  const { progress } = deck;

  // Calculate review statistics from localStorage
  const reviewStats = useMemo(
    () => calculateDeckReviewStats(deck.id),
    [deck.id]
  );

  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-lg font-semibold">Deck Statistics</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="grid grid-cols-2 gap-4 md:grid-cols-4">
          {/* Total Cards */}
          <StatCard
            icon={<BookOpen className="h-5 w-5 text-blue-500" />}
            label="Total Cards"
            value={deck.cardCount}
            subtext="flashcards"
          />

          {/* Estimated Time */}
          <StatCard
            icon={<Clock className="h-5 w-5 text-purple-500" />}
            label="Estimated Time"
            value={`${deck.estimatedTime}m`}
            subtext="to complete"
          />

          {/* Due Today (if started) */}
          {progress && progress.status !== 'not-started' && (
            <StatCard
              icon={<Clock className="h-5 w-5 text-red-500" />}
              label="Due Today"
              value={reviewStats.dueToday}
              subtext="cards to review"
            />
          )}

          {/* Mastery Rate (if started) */}
          {progress && progress.status !== 'not-started' && (
            <StatCard
              icon={<Target className="h-5 w-5 text-green-500" />}
              label="Mastery Rate"
              value={`${Math.round((progress.cardsMastered / progress.cardsTotal) * 100)}%`}
              subtext={`${progress.cardsMastered}/${progress.cardsTotal} mastered`}
            />
          )}
        </div>

        {/* Card Distribution (if started) */}
        {progress && progress.status !== 'not-started' && (
          <div className="mt-6 grid grid-cols-3 gap-4 border-t pt-4">
            <div className="text-center">
              <p className="text-2xl font-bold text-gray-400">{progress.cardsNew}</p>
              <p className="mt-1 text-xs text-gray-600">New</p>
            </div>
            <div className="text-center">
              <p className="text-2xl font-bold text-blue-500">{progress.cardsLearning}</p>
              <p className="mt-1 text-xs text-gray-600">Learning</p>
            </div>
            <div className="text-center">
              <p className="text-2xl font-bold text-green-500">{progress.cardsMastered}</p>
              <p className="mt-1 text-xs text-gray-600">Mastered</p>
            </div>
          </div>
        )}

        {/* Last Review Date (if reviewed) */}
        {reviewStats.lastReviewed && (
          <div className="mt-4 border-t pt-4 text-center text-sm text-gray-600">
            Last reviewed: {formatRelativeDate(reviewStats.lastReviewed)}
          </div>
        )}
      </CardContent>
    </Card>
  );
};
```

### 11.3 Updated ActionButtonsSection (In-Progress State)

```typescript
{!isPremiumLocked && deckStatus === 'in-progress' && (
  <div className="py-8 text-center">
    <TrendingUp className="mx-auto mb-4 h-12 w-12 text-green-500" />
    <h3 className="mb-2 text-lg font-semibold text-gray-900">Continue Your Progress</h3>
    <p className="mx-auto mb-2 max-w-md text-sm text-gray-600">
      You have {reviewStats.dueToday} cards due for review today.
    </p>
    <p className="mb-6 text-xs text-gray-500">Keep your streak going!</p>
    <Button
      size="lg"
      onClick={onContinue}
      className="bg-gradient-to-br from-green-600 to-emerald-600 text-white hover:from-green-700 hover:to-emerald-700"
    >
      Continue Review
    </Button>

    {/* Demo: Simulate Study Session Button */}
    <div className="mt-4 border-t pt-4">
      <p className="mb-2 text-xs text-gray-500">Demo: Test progress tracking</p>
      <Button
        variant="outline"
        size="sm"
        onClick={handleSimulateSession}
        disabled={isSimulating}
      >
        {isSimulating ? 'Simulating...' : 'Simulate Study Session'}
      </Button>
    </div>
  </div>
)}
```

---

## 12. Testing Strategy

### 12.1 Unit Testing (Manual)

**Test 1: calculateDeckReviewStats() with empty localStorage**
- Clear localStorage review data
- Call `calculateDeckReviewStats('deck-a1-basics')`
- Expect: All cards are "new", dueToday = cardCount, lastReviewed = null

**Test 2: calculateDeckReviewStats() with reviewed cards**
- Manually add review data to localStorage
- Set some cards to "learning", "mastered" states
- Call `calculateDeckReviewStats('deck-a1-basics')`
- Expect: Correct counts, lastReviewed = most recent timestamp

**Test 3: formatRelativeDate() edge cases**
- Test with `null` → "Never"
- Test with current timestamp → "Just now"
- Test with 5 minutes ago → "5 minutes ago"
- Test with 2 days ago → "2 days ago"

### 12.2 Integration Testing (Manual)

**Test 4: Navigation from DeckDetailPage**
- Navigate to `/decks/deck-a1-basics`
- Click "Start Review"
- Verify URL changes to `/decks/deck-a1-basics/review`
- Verify FlashcardReviewPage loads

**Test 5: Statistics display**
- Navigate to deck detail page
- Verify "Due Today" shows correct number
- Complete a review session
- Return to deck detail page
- Verify "Due Today" count decreased
- Verify "Last reviewed" shows "Just now"

**Test 6: Complete navigation flow**
- Start from `/decks/:deckId`
- Click "Start Review" → `/decks/:deckId/review`
- Review 5 cards
- Verify auto-navigation to `/decks/:deckId/summary`
- Click "Back to Deck" → `/decks/:deckId`
- Verify statistics updated

### 12.3 Edge Case Testing

**Test 7: No reviews yet**
- Clear localStorage review data
- Navigate to deck detail page
- Verify "Due Today" stat not shown
- Verify "Last reviewed" text not shown
- Verify "Start Review" button shown

**Test 8: All cards mastered**
- Complete all cards in a deck
- Navigate to deck detail page
- Verify "Due Today: 0"
- Verify "Last reviewed" date shown
- Click "Continue Review"
- Expect error: "No cards available for review"

**Test 9: Premium deck (locked)**
- Navigate to premium deck as free user
- Verify "Start Review" button not shown
- Verify "Upgrade to Premium" button shown
- Verify review statistics not shown

### 12.4 Build Verification

```bash
# TypeScript compilation
npm run build

# Expected output:
# ✓ 0 errors
# ✓ Production build succeeds
# ✓ No warnings about missing types
```

### 12.5 Accessibility Testing

- ✅ All stat cards have descriptive labels
- ✅ Button labels are clear ("Start Review", not "Start")
- ✅ Relative dates are human-readable
- ✅ No layout shift when stats load

---

## 13. Risk Analysis and Mitigation

### 13.1 Technical Risks

**Risk 1: localStorage Data Inconsistency**
- **Severity**: Medium
- **Probability**: Low
- **Impact**: Incorrect due card counts, missing last review date
- **Mitigation**: Defensive coding in `loadReviewData()`, fallback to card defaults
- **Fallback**: If localStorage corrupted, treat all cards as "new"

**Risk 2: Route Configuration Mismatch**
- **Severity**: High
- **Probability**: Very Low (routes already exist)
- **Impact**: Navigation fails, 404 errors
- **Mitigation**: Verified in Step 5, routes already correct in App.tsx
- **Fallback**: N/A (routes already configured)

**Risk 3: Performance (Statistics Calculation)**
- **Severity**: Low
- **Probability**: Low
- **Impact**: Slow rendering on large decks (100+ cards)
- **Mitigation**: `useMemo()` caching, efficient localStorage access
- **Fallback**: If too slow, debounce calculation or move to Web Worker

### 13.2 User Experience Risks

**Risk 4: Confusing Button Labels**
- **Severity**: Low
- **Probability**: Medium
- **Impact**: Users expect "learning" not "review"
- **Mitigation**: Use consistent terminology ("Review" across all pages)
- **Fallback**: User feedback will clarify if terminology needs adjustment

**Risk 5: Empty Queue (0 Due Cards)**
- **Severity**: Medium
- **Probability**: Medium
- **Impact**: User clicks "Continue Review" with no cards available
- **Mitigation**: FlashcardReviewPage already handles this (error message)
- **Fallback**: Could disable button if dueToday === 0, but not critical

### 13.3 Time Risks

**Risk 6: Implementation Takes Longer Than 30 Minutes**
- **Severity**: Low
- **Probability**: Medium
- **Impact**: Task incomplete
- **Mitigation**: Prioritize core features (navigation + due cards count)
- **Fallback**: Skip "Last reviewed" feature if running out of time

---

## 14. Implementation Checklist

### Pre-Implementation

- [ ] Read all 5 previous task completion reports (05.01-05.05)
- [ ] Verify FlashcardReviewPage exists and works
- [ ] Verify SessionSummaryPage exists and works
- [ ] Verify routes configured in App.tsx
- [ ] Verify deckStore.reviewSession() method exists

### Implementation

**Step 1: Utility Module** (5 min)
- [ ] Create `/src/lib/reviewStatsHelpers.ts`
- [ ] Implement `calculateDeckReviewStats()` function
- [ ] Implement `formatRelativeDate()` function
- [ ] Export `DeckReviewStats` interface
- [ ] Test TypeScript compilation (0 errors)

**Step 2: Navigation Handlers** (3 min)
- [ ] Update `handleStartLearning()` route to `/decks/${deckId}/review`
- [ ] Update `handleContinue()` route to `/decks/${deckId}/review`
- [ ] Test navigation works (no 404 errors)

**Step 3: StatisticsSection** (10 min)
- [ ] Import `calculateDeckReviewStats` and `formatRelativeDate`
- [ ] Add `useMemo()` hook to calculate review stats
- [ ] Add "Due Today" stat card (conditional render)
- [ ] Add "Last reviewed" text (conditional render)
- [ ] Test responsive layout (mobile + desktop)

**Step 4: ActionButtonsSection** (8 min)
- [ ] Add `useMemo()` hook to calculate review stats
- [ ] Update "Start Learning" → "Start Review"
- [ ] Update "Continue Learning" → "Continue Review"
- [ ] Update due cards text to use `reviewStats.dueToday`
- [ ] Test button labels and text

**Step 5: Verification** (2 min)
- [ ] Verify routes in App.tsx (no changes needed)
- [ ] Run `npm run build` (0 errors)

**Step 6: Testing** (2 min)
- [ ] Test: New user → Start Review → Review → Summary → Back
- [ ] Test: Returning user → Continue Review → Review → Summary → Back
- [ ] Test: Statistics update after session
- [ ] Test: Edge cases (no reviews, 0 due cards)

### Post-Implementation

- [ ] Update `.claude/01-MVP/frontend/Components-Reference.md`
- [ ] Update `.claude/01-MVP/frontend/05/05-flashcard-review.md`
- [ ] Record actual time taken
- [ ] Document any deviations from plan
- [ ] Commit changes with descriptive message

---

## 15. Open Questions and Assumptions

### Assumptions

1. **Routes Already Exist**: Verified in App.tsx lines 75-77 - ✅ Correct
2. **FlashcardReviewPage Works**: Completed in Task 05.04 - ✅ Correct
3. **SessionSummaryPage Works**: Completed in Task 05.05 - ✅ Correct
4. **reviewStore Updates Deck Progress**: Verified in reviewStore.ts line 514 - ✅ Correct
5. **localStorage Key Consistent**: `'learn-greek-easy:review-data'` used everywhere - ✅ Correct

### Open Questions

**Q1**: Should we disable "Start Review"/"Continue Review" button if `dueToday === 0`?
- **Answer**: No, let FlashcardReviewPage handle it (shows error message)
- **Rationale**: Consistent with existing error handling pattern

**Q2**: Should "Last reviewed" show exact timestamp or relative time?
- **Answer**: Relative time (e.g., "2 hours ago")
- **Rationale**: More user-friendly, less intimidating than "11/04/2025 3:45 PM"

**Q3**: Should we add a "Review History" section (last 5 sessions)?
- **Answer**: No, out of scope for 30-minute task
- **Rationale**: Would require new data structure, more complex UI

**Q4**: Should we show a loading spinner while calculating statistics?
- **Answer**: No, calculation is instant (< 100ms)
- **Rationale**: Would add unnecessary complexity

**Q5**: Should we add a "Refresh" button to manually recalculate stats?
- **Answer**: No, stats auto-refresh on navigation
- **Rationale**: React re-renders component on route change, triggering useMemo

---

## 16. Post-Implementation Notes

### Actual Implementation Time

**Start Time**: ___________
**End Time**: ___________
**Total Duration**: ___ minutes

### Deviations from Plan

_Record any changes made during implementation that differ from this plan:_
-
-
-

### Issues Encountered

_Document any bugs, blockers, or unexpected challenges:_
-
-
-

### Future Improvements

_Suggestions for Task 05.07 or future tasks:_
- Consider adding "Review History" section (last 5 sessions with dates)
- Consider adding "Study Streak" badge (consecutive days reviewed)
- Consider adding "Cards Mastered Today" stat
- Consider adding visual progress indicator (ring chart showing due/total)

---

## 17. References

### Related Files
- `/src/pages/FlashcardReviewPage.tsx` - Review session interface (Task 05.04)
- `/src/pages/SessionSummaryPage.tsx` - Post-session summary (Task 05.05)
- `/src/stores/reviewStore.ts` - Session state management (Task 05.03)
- `/src/lib/spacedRepetition.ts` - SM-2 algorithm (Task 05.02)
- `/src/services/mockReviewAPI.ts` - Review data persistence (Task 05.01)
- `/src/services/mockReviewData.ts` - Mock card data (Task 05.01)

### Task Dependencies
- **05.01**: Provides mockReviewAPI and data types ✅
- **05.02**: Provides SM-2 algorithm (not directly used in this task) ✅
- **05.03**: Provides reviewStore for session management ✅
- **05.04**: Provides FlashcardReviewPage (navigation target) ✅
- **05.05**: Provides SessionSummaryPage (navigation flow) ✅

### External Documentation
- [React Router v6 - Navigation](https://reactrouter.com/en/main/hooks/use-navigate)
- [React useMemo Hook](https://react.dev/reference/react/useMemo)
- [localStorage API](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage)

---

**Plan Status**: ✅ Complete and Ready for Execution
**Next Step**: Execute implementation using executor agent or manual development
**Estimated Success Rate**: 95% (all infrastructure exists, minimal changes needed)
