# Task 05.07: Add Keyboard Shortcuts and Accessibility - Implementation Plan

**Task ID**: 05.07
**Status**: ‚úÖ **COMPLETED (Verified 2025-11-04)**
**Priority**: High
**Estimated Time**: 30 minutes
**Actual Time**: 28 minutes
**Dependencies**: 05.01, 05.02, 05.03, 05.04, 05.05, 05.06 (All ‚úÖ Completed)
**Verification Report**: [05.07-verification-report.md](./05.07-verification-report.md)

---

## 1. Overview

### 1.1 Background and Motivation

**Current State**:
Task 05 has successfully delivered a complete flashcard review system with 16+ components:
- ‚úÖ FlashcardReviewPage with session management
- ‚úÖ SessionSummaryPage with detailed statistics
- ‚úÖ Basic keyboard shortcuts (Space, 1-4, implemented in useKeyboardShortcuts.ts)
- ‚úÖ KeyboardShortcutsTooltip component (hover-activated, shows basic shortcuts)
- ‚úÖ Semantic HTML in most components (Card, Button, etc.)
- ‚úÖ Color contrast meeting WCAG AA (from Style Guide)

**Gap Identified**:
While basic keyboard functionality exists, the system lacks:
1. **Discoverability**: No visual help dialog accessible via keyboard
2. **Complete Keyboard Navigation**: Limited keyboard-only navigation capabilities
3. **Screen Reader Support**: Missing ARIA labels, live regions, announcements
4. **Focus Management**: No auto-focus on card flip, no focus trap in modals
5. **Accessibility Documentation**: Missing focus state guidance in Style Guide

**Business Value**:
- **Compliance**: WCAG 2.1 AA compliance is required for government exam preparation software
- **Inclusivity**: Users with motor disabilities can navigate without mouse
- **Power Users**: Keyboard shortcuts dramatically improve review speed
- **Quality Signal**: Accessibility demonstrates professional-grade software

### 1.2 Scope Definition

**In Scope** (30 minutes):
1. ‚úÖ Enhance keyboard shortcuts (add help dialog toggle with "?")
2. ‚úÖ Add KeyboardShortcutsHelp modal/dialog component
3. ‚úÖ Improve screen reader support (ARIA labels, live regions)
4. ‚úÖ Add focus management (auto-focus on key actions)
5. ‚úÖ Update Style Guide with accessibility guidelines
6. ‚úÖ Add visible focus indicators (CSS updates)

**Out of Scope**:
- ‚ùå Skip links (low priority, can add later)
- ‚ùå Custom focus trap hooks (use existing dialog focus management)
- ‚ùå Complex ARIA patterns (keep simple for 30-minute constraint)
- ‚ùå Automated accessibility testing (manual verification only)
- ‚ùå Mobile touch gesture improvements (separate task)

### 1.3 Success Criteria

**Functional**:
- ‚úÖ Pressing "?" toggles keyboard shortcuts help dialog
- ‚úÖ All review actions accessible via keyboard only (no mouse)
- ‚úÖ Screen reader announces card flip, rating selection, progress updates
- ‚úÖ Focus visible on all interactive elements (2px outline)
- ‚úÖ Help dialog keyboard accessible (Esc to close, Tab navigation)

**Technical**:
- ‚úÖ TypeScript: 0 errors
- ‚úÖ Build: SUCCESS
- ‚úÖ No console errors during keyboard navigation
- ‚úÖ All ARIA attributes valid

**User Experience**:
- ‚úÖ Keyboard shortcuts discoverable (help dialog accessible)
- ‚úÖ Logical tab order (follows visual hierarchy)
- ‚úÖ Screen reader feedback clear and concise
- ‚úÖ Focus indicators visible but not distracting

---

## 2. Current State Analysis

### 2.1 Existing Keyboard Infrastructure

**File**: `/src/hooks/useKeyboardShortcuts.ts` (68 lines)

**Current Implementation**:
```typescript
export function useKeyboardShortcuts() {
  const { flipCard, rateCard, canRate } = useReviewStore();

  useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      // Ignore if typing in input or textarea
      if (
        event.target instanceof HTMLInputElement ||
        event.target instanceof HTMLTextAreaElement
      ) {
        return;
      }

      // Ignore if modifier keys are pressed
      if (event.ctrlKey || event.metaKey || event.altKey) {
        return;
      }

      switch (event.code) {
        case 'Space':
          event.preventDefault();
          flipCard();
          break;
        case 'Digit1':
          if (canRate) {
            event.preventDefault();
            rateCard('again');
          }
          break;
        // ... Digit2, Digit3, Digit4
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [flipCard, rateCard, canRate]);
}
```

**Current Shortcuts**:
- ‚úÖ **Space**: Flip card
- ‚úÖ **1**: Rate as "Again"
- ‚úÖ **2**: Rate as "Hard"
- ‚úÖ **3**: Rate as "Good"
- ‚úÖ **4**: Rate as "Easy"
- ‚ùå **?**: Help dialog (MISSING)
- ‚ùå **Esc**: Exit review (documented but NOT implemented in hook)

### 2.2 Existing KeyboardShortcutsTooltip Component

**File**: `/src/components/review/KeyboardShortcutsTooltip.tsx` (48 lines)

**Current Features**:
- Hover-activated tooltip (not keyboard accessible!)
- Shows shortcuts: Space, 1-4
- Position: absolute top-4 left-4 (overlays card)
- Icon: ‚å®Ô∏è emoji
- CSS: hidden on mobile (md:block)

**Limitations**:
1. **Not keyboard accessible**: Requires mouse hover, no Tab focus
2. **Limited shortcuts**: Doesn't show "?" for help or Esc for exit
3. **Emoji icon**: Not customizable, accessibility concerns
4. **Tooltip only**: Needs full help dialog for comprehensive list

**Decision**: Keep tooltip for quick reference, create separate full help dialog.

### 2.3 Accessibility Gaps in Components

**Component**: `CardMain.tsx` (Lines 14-50)

**Current Accessibility**:
- ‚úÖ `role="button"` on clickable div
- ‚úÖ `tabIndex={0}` for keyboard focus
- ‚úÖ `onKeyDown` handler for Enter/Space
- ‚úÖ `aria-label="Flip card to reveal translation"`
- ‚ùå No ARIA live region for flip announcements
- ‚ùå No focus management after flip

**Component**: `RatingButtons.tsx` (Lines 6-45)

**Current Accessibility**:
- ‚úÖ `aria-label` on each button (e.g., "Rate card as Good")
- ‚úÖ Semantic `<button>` elements
- ‚úÖ Disabled state properly managed
- ‚ùå No screen reader announcement after rating
- ‚ùå No visual keyboard hint (e.g., badge showing "3")

**Component**: `ProgressHeader.tsx` (Lines 3-29)

**Current Accessibility**:
- ‚úÖ Semantic text elements
- ‚ùå No ARIA role for progress information
- ‚ùå No live region for progress updates
- ‚ùå Screen reader doesn't announce card transitions

**Component**: `FlashcardReviewPage.tsx` (Lines 11-131)

**Current Accessibility**:
- ‚úÖ useKeyboardShortcuts hook enabled (line 24)
- ‚úÖ Semantic structure with nav, buttons
- ‚ùå No landmark roles (main, navigation)
- ‚ùå No skip link to main content
- ‚ùå "Exit Review" button uses ghost variant (poor contrast for focus)

### 2.4 Style Guide Accessibility Coverage

**File**: `.claude/01-MVP/frontend/Style-Guide.md` (Lines 593-631)

**Current Accessibility Section**:
- ‚úÖ Color contrast ratios documented (WCAG AA compliant)
- ‚úÖ Focus states defined (2px solid #2563eb, outline-offset: 2px)
- ‚úÖ Keyboard navigation mentioned
- ‚úÖ ARIA patterns guidance
- ‚úÖ Motion preferences (prefers-reduced-motion)
- ‚ùå No specific guidance for skip links
- ‚ùå No guidance for focus management patterns
- ‚ùå No guidance for ARIA live regions

---

## 3. Architecture and Design Decisions

### 3.1 Keyboard Shortcuts Help Dialog

**Decision**: Create a modal dialog accessible with "?" key.

**Rationale**:
- ‚úÖ Comprehensive shortcuts list (not limited by tooltip size)
- ‚úÖ Keyboard accessible (Shadcn Dialog has built-in focus trap)
- ‚úÖ Discoverable (users familiar with "?" convention from Gmail, Slack)
- ‚úÖ Reusable (can show dialog from menu or button if needed)

**Component Structure**:
```
<Dialog> (Shadcn/ui)
‚îú‚îÄ‚îÄ <DialogTrigger> (programmatic, triggered by "?" key)
‚îú‚îÄ‚îÄ <DialogContent>
‚îÇ   ‚îú‚îÄ‚îÄ <DialogHeader>
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ <DialogTitle>"Keyboard Shortcuts"
‚îÇ   ‚îú‚îÄ‚îÄ <div> (shortcuts grid)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ <ShortcutRow key="Space" action="Flip card" />
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ <ShortcutRow key="1-4" action="Rate card" />
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ <ShortcutRow key="?" action="Show/hide help" />
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ <ShortcutRow key="Esc" action="Close dialog / Exit review" />
‚îÇ   ‚îî‚îÄ‚îÄ <DialogFooter> (optional, "Close" button)
```

**Layout**:
- 2-column grid: Key (left) | Action (right)
- Key shown in `<kbd>` element with gray background
- Max-width: 600px
- Responsive: Single column on mobile
- Close methods: Esc key, X button, click outside

### 3.2 Enhanced Keyboard Shortcuts Hook

**File**: `/src/hooks/useKeyboardShortcuts.ts` (enhance existing)

**New Shortcuts to Add**:
1. **?** or **Shift+/** ‚Üí Toggle help dialog
2. **Esc** ‚Üí Close help dialog (if open) OR exit review (confirm first)

**Implementation Strategy**:
- Add dialog open/close state (useState)
- Add "?" case to handleKeyDown switch
- Add Esc case with conditional logic (dialog vs. exit)
- Pass dialog state to FlashcardReviewPage via return value

**Alternative Approach**: Create separate hook `useHelpDialog()` for dialog state.
**Decision**: Enhance existing hook - keeps related logic together, simpler architecture.

### 3.3 Screen Reader Strategy

**Approach**: ARIA Live Regions + ARIA Labels

**Key Principles**:
1. **Minimize noise**: Only announce meaningful state changes
2. **Be concise**: "Card flipped" not "The flashcard has been flipped to show the translation"
3. **Use aria-live="polite"**: Don't interrupt user's reading flow
4. **Strategic placement**: Live regions in FlashcardContainer (root level)

**What to Announce**:
1. ‚úÖ Card flip: "Answer revealed" (aria-live="polite")
2. ‚úÖ Rating selection: "Rated as Good" (aria-live="polite")
3. ‚úÖ Card transition: "Card 3 of 24" (aria-live="polite")
4. ‚úÖ Session end: "Session complete. 24 cards reviewed." (aria-live="assertive")
5. ‚ùå Button hover (too noisy)
6. ‚ùå Timer updates (distracting)

**Implementation**:
```typescript
// Add to FlashcardContainer.tsx
<div aria-live="polite" aria-atomic="true" className="sr-only">
  {announcements}
</div>

// Update announcements on state changes
useEffect(() => {
  if (isCardFlipped) {
    setAnnouncements('Answer revealed');
  }
}, [isCardFlipped]);
```

### 3.4 Focus Management Strategy

**Focus Points** (where to auto-focus):
1. ‚úÖ After card flip: Focus stays on card (no change needed)
2. ‚úÖ After rating: Focus moves to next card (auto-handled by re-render)
3. ‚úÖ Help dialog open: Focus moves to dialog title (Shadcn default)
4. ‚úÖ Help dialog close: Focus returns to last focused element (Shadcn default)
5. ‚ùå Exit review button (keep manual focus, don't auto-focus)

**Focus Trap**:
- ‚úÖ Help dialog: Shadcn Dialog has built-in focus trap (Radix UI)
- ‚ùå Flashcard: No focus trap needed (not a modal)

**Visible Focus Indicators**:
- ‚úÖ All buttons: 2px solid #2563eb outline, 2px offset (Style Guide line 605)
- ‚úÖ Flashcard: Same outline on focus (tabIndex={0})
- ‚úÖ Links: Same outline
- ‚ö†Ô∏è Progress bar: Not focusable (static display)

---

## 4. Detailed Implementation Plan

### 4.1 Subtask 1: Enhance useKeyboardShortcuts Hook (5 minutes)

**File**: `/src/hooks/useKeyboardShortcuts.ts`

**Changes**:
1. Add dialog state management
2. Add "?" key handler
3. Add Esc key handler with conditional logic
4. Return dialog state for component access

**Implementation**:
```typescript
import { useEffect, useState } from 'react';
import { useReviewStore } from '@/stores/reviewStore';

export function useKeyboardShortcuts() {
  const { flipCard, rateCard, canRate } = useReviewStore();
  const [isHelpDialogOpen, setIsHelpDialogOpen] = useState(false);

  useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      // Ignore if typing in input or textarea
      if (
        event.target instanceof HTMLInputElement ||
        event.target instanceof HTMLTextAreaElement
      ) {
        return;
      }

      // Ignore if modifier keys are pressed (except Shift for "?")
      if (event.ctrlKey || event.metaKey || event.altKey) {
        return;
      }

      switch (event.code) {
        case 'Space':
          event.preventDefault();
          flipCard();
          break;
        case 'Digit1':
          if (canRate) {
            event.preventDefault();
            rateCard('again');
          }
          break;
        case 'Digit2':
          if (canRate) {
            event.preventDefault();
            rateCard('hard');
          }
          break;
        case 'Digit3':
          if (canRate) {
            event.preventDefault();
            rateCard('good');
          }
          break;
        case 'Digit4':
          if (canRate) {
            event.preventDefault();
            rateCard('easy');
          }
          break;
        case 'Slash':
          // Toggle help dialog with "?" (Shift+/)
          if (event.shiftKey) {
            event.preventDefault();
            setIsHelpDialogOpen((prev) => !prev);
          }
          break;
        case 'Escape':
          // Close help dialog if open, otherwise ignore (don't exit review)
          if (isHelpDialogOpen) {
            event.preventDefault();
            setIsHelpDialogOpen(false);
          }
          // Note: Exit review handled by FlashcardReviewPage "Exit" button
          break;
      }
    };

    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [flipCard, rateCard, canRate, isHelpDialogOpen]);

  return {
    isHelpDialogOpen,
    setIsHelpDialogOpen,
  };
}
```

**Lines Changed**: ~30 lines modified, ~20 lines added (total: ~90 lines)

**Verification**:
- Pressing "?" toggles help dialog
- Pressing Esc closes help dialog (if open)
- Existing shortcuts still work (Space, 1-4)

---

### 4.2 Subtask 2: Create KeyboardShortcutsHelp Component (10 minutes)

**File**: `/src/components/review/KeyboardShortcutsHelp.tsx` (NEW)

**Purpose**: Full-screen modal dialog showing all keyboard shortcuts.

**Implementation**:
```typescript
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';

interface KeyboardShortcutsHelpProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

interface Shortcut {
  keys: string[];
  action: string;
  category: 'review' | 'navigation';
}

const shortcuts: Shortcut[] = [
  { keys: ['Space'], action: 'Flip card to reveal answer', category: 'review' },
  { keys: ['1'], action: 'Rate card as "Again" (review soon)', category: 'review' },
  { keys: ['2'], action: 'Rate card as "Hard" (medium interval)', category: 'review' },
  { keys: ['3'], action: 'Rate card as "Good" (standard interval)', category: 'review' },
  { keys: ['4'], action: 'Rate card as "Easy" (long interval)', category: 'review' },
  { keys: ['?'], action: 'Show/hide this help dialog', category: 'navigation' },
  { keys: ['Esc'], action: 'Close dialog', category: 'navigation' },
];

export function KeyboardShortcutsHelp({ open, onOpenChange }: KeyboardShortcutsHelpProps) {
  const reviewShortcuts = shortcuts.filter((s) => s.category === 'review');
  const navShortcuts = shortcuts.filter((s) => s.category === 'navigation');

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-2xl">
        <DialogHeader>
          <DialogTitle className="text-2xl font-semibold">Keyboard Shortcuts</DialogTitle>
          <DialogDescription>
            Use these shortcuts to navigate the review session faster
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-6">
          {/* Review Actions Section */}
          <div>
            <h3 className="mb-3 text-sm font-semibold uppercase tracking-wide text-gray-500">
              Review Actions
            </h3>
            <div className="space-y-2">
              {reviewShortcuts.map((shortcut) => (
                <ShortcutRow key={shortcut.keys.join('+')} shortcut={shortcut} />
              ))}
            </div>
          </div>

          {/* Navigation Section */}
          <div>
            <h3 className="mb-3 text-sm font-semibold uppercase tracking-wide text-gray-500">
              Navigation
            </h3>
            <div className="space-y-2">
              {navShortcuts.map((shortcut) => (
                <ShortcutRow key={shortcut.keys.join('+')} shortcut={shortcut} />
              ))}
            </div>
          </div>
        </div>

        {/* Footer Tip */}
        <div className="mt-4 rounded-lg bg-blue-50 p-3 text-sm text-blue-800">
          <p className="flex items-center gap-2">
            <span className="font-semibold">üí° Tip:</span>
            <span>Keyboard shortcuts work when not typing in a text field</span>
          </p>
        </div>
      </DialogContent>
    </Dialog>
  );
}

interface ShortcutRowProps {
  shortcut: Shortcut;
}

function ShortcutRow({ shortcut }: ShortcutRowProps) {
  return (
    <div className="flex items-center justify-between rounded-lg border border-gray-200 bg-white px-4 py-3 hover:bg-gray-50">
      <div className="flex items-center gap-2">
        {shortcut.keys.map((key, index) => (
          <kbd
            key={key}
            className="inline-flex h-7 min-w-[28px] items-center justify-center rounded border border-gray-300 bg-gray-100 px-2 font-mono text-sm font-semibold text-gray-700 shadow-sm"
          >
            {key}
          </kbd>
        ))}
      </div>
      <span className="text-sm text-gray-600">{shortcut.action}</span>
    </div>
  );
}
```

**Lines**: ~110 lines

**Styling**:
- Uses Shadcn Dialog (built-in focus trap, Esc handling, backdrop)
- 2-column grid: Keys (left, monospace) | Action (right, text)
- Responsive: max-w-2xl on desktop, full-width on mobile
- Categories: Review Actions, Navigation (separated)
- Footer tip: Blue background, helpful context

**Verification**:
- Dialog opens/closes with state change
- Tab navigation works (all focusable elements accessible)
- Esc closes dialog
- Screen reader reads title and description

---

### 4.3 Subtask 3: Add ARIA Live Regions to FlashcardContainer (8 minutes)

**File**: `/src/components/review/FlashcardContainer.tsx` (enhance existing)

**Current Structure** (lines 12-52):
```typescript
export function FlashcardContainer({ card }: FlashcardContainerProps) {
  const { isCardFlipped, flipCard } = useReviewStore();
  const [selectedTense, setSelectedTense] = useState<'present' | 'past' | 'future'>('present');

  // Reset tense when card changes
  useEffect(() => {
    setSelectedTense('present');
  }, [card.id]);

  return (
    <div className="max-w-4xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col min-h-[800px] transition-transform duration-300 hover:-translate-y-1">
      <ProgressHeader />
      <CardMain card={card} isFlipped={isCardFlipped} onFlip={flipCard} />
      <RatingButtons />
      {/* ... grammar sections ... */}
    </div>
  );
}
```

**Add Announcements State and Live Region**:
```typescript
import { useState, useEffect } from 'react';
import { useReviewStore } from '@/stores/reviewStore';
import type { CardReview } from '@/types/review';
import { ProgressHeader } from './ProgressHeader';
import { CardMain } from './CardMain';
import { RatingButtons } from './RatingButtons';
import { NounGrammarSection } from './grammar/NounGrammarSection';
import { VerbGrammarSection } from './grammar/VerbGrammarSection';
import { ExampleSection } from './shared/ExampleSection';

interface FlashcardContainerProps {
  card: CardReview;
}

export function FlashcardContainer({ card }: FlashcardContainerProps) {
  const { isCardFlipped, flipCard, progress } = useReviewStore();
  const [selectedTense, setSelectedTense] = useState<'present' | 'past' | 'future'>('present');
  const [announcement, setAnnouncement] = useState('');

  // Reset tense when card changes
  useEffect(() => {
    setSelectedTense('present');
  }, [card.id]);

  // Announce card flip
  useEffect(() => {
    if (isCardFlipped) {
      setAnnouncement('Answer revealed');
      // Clear announcement after brief delay (allows screen reader to read it)
      const timer = setTimeout(() => setAnnouncement(''), 100);
      return () => clearTimeout(timer);
    }
  }, [isCardFlipped]);

  // Announce card transitions
  useEffect(() => {
    const { current, total } = progress;
    setAnnouncement(`Card ${current + 1} of ${total}`);
    const timer = setTimeout(() => setAnnouncement(''), 100);
    return () => clearTimeout(timer);
  }, [card.id, progress]);

  return (
    <div className="max-w-4xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col min-h-[800px] transition-transform duration-300 hover:-translate-y-1">
      {/* Screen Reader Live Region */}
      <div
        className="sr-only"
        role="status"
        aria-live="polite"
        aria-atomic="true"
      >
        {announcement}
      </div>

      <ProgressHeader />
      <CardMain card={card} isFlipped={isCardFlipped} onFlip={flipCard} />
      <RatingButtons />

      {/* Grammar Section - conditional based on card type */}
      {card.nounData && <NounGrammarSection nounData={card.nounData} />}
      {card.verbData && (
        <VerbGrammarSection
          verbData={card.verbData}
          selectedTense={selectedTense}
          onTenseChange={setSelectedTense}
        />
      )}

      <ExampleSection card={card} selectedTense={selectedTense} isFlipped={isCardFlipped} />
    </div>
  );
}
```

**Changes**:
- Import `progress` from reviewStore
- Add `announcement` state
- Add live region div with `aria-live="polite"`, `role="status"`, `aria-atomic="true"`
- Add `sr-only` class (screen reader only, visually hidden)
- useEffect for flip announcement
- useEffect for card transition announcement

**Lines Changed**: ~30 lines added (total: ~80 lines)

**Verification**:
- Screen reader announces "Answer revealed" on card flip
- Screen reader announces "Card 3 of 24" on card change
- Announcements don't appear visually (sr-only class)

---

### 4.4 Subtask 4: Add ARIA Labels to RatingButtons (3 minutes)

**File**: `/src/components/review/RatingButtons.tsx` (enhance existing)

**Current Implementation** (lines 24-44):
```typescript
return (
  <div className="px-8 py-6 flex gap-3 justify-center">
    {buttons.map(({ rating, label, color }) => (
      <button
        key={rating}
        onClick={() => handleRate(rating)}
        disabled={!canRate || isLoading}
        className={cn(
          'flex-1 max-w-[120px] px-6 py-3 rounded-lg text-white font-semibold text-sm',
          'transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed',
          color,
          highlightedButton === rating && 'ring-2 ring-offset-2 ring-current',
          canRate && 'hover:-translate-y-0.5 hover:shadow-lg'
        )}
        aria-label={`Rate card as ${label}`}
        type="button"
      >
        {label}
      </button>
    ))}
  </div>
);
```

**Current Status**: Already has `aria-label` ‚úÖ

**Enhancement**: Add keyboard hint badges (optional, low priority).

**Decision**: No changes needed - ARIA labels already implemented.

**Alternative**: Add visual keyboard hint (e.g., small badge showing "3" on "Good" button).

**Decision for 30-min constraint**: Skip visual hints (already shown in tooltip and help dialog).

**Lines Changed**: 0 (no changes)

---

### 4.5 Subtask 5: Integrate Help Dialog into FlashcardReviewPage (3 minutes)

**File**: `/src/pages/FlashcardReviewPage.tsx` (enhance existing)

**Current Structure** (lines 11-131):
```typescript
export function FlashcardReviewPage() {
  const { deckId } = useParams<{ deckId: string }>();
  const navigate = useNavigate();
  const { activeSession, currentCard, startSession, isLoading, error, sessionSummary } = useReviewStore();

  // Enable keyboard shortcuts
  useKeyboardShortcuts();

  // ... rest of component
}
```

**Add Help Dialog Integration**:
```typescript
import { useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { useReviewStore } from '@/stores/reviewStore';
import { useKeyboardShortcuts } from '@/hooks/useKeyboardShortcuts';
import { FlashcardContainer } from '@/components/review/FlashcardContainer';
import { FlashcardSkeleton } from '@/components/review/FlashcardSkeleton';
import { KeyboardShortcutsHelp } from '@/components/review/KeyboardShortcutsHelp';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Button } from '@/components/ui/button';
import { AlertCircle, ChevronLeft } from 'lucide-react';

export function FlashcardReviewPage() {
  const { deckId } = useParams<{ deckId: string }>();
  const navigate = useNavigate();
  const {
    activeSession,
    currentCard,
    startSession,
    isLoading,
    error,
    sessionSummary,
  } = useReviewStore();

  // Enable keyboard shortcuts (returns help dialog state)
  const { isHelpDialogOpen, setIsHelpDialogOpen } = useKeyboardShortcuts();

  // ... rest of hooks (startSession, navigate to summary)

  // Main flashcard view
  return (
    <div className="min-h-screen bg-gradient-to-br from-[#667eea] to-[#764ba2] p-10">
      <div className="max-w-4xl mx-auto mb-4">
        <Button
          variant="ghost"
          onClick={() => navigate(`/decks/${deckId}`)}
          className="text-white hover:bg-white/20"
        >
          <ChevronLeft className="mr-2 h-4 w-4" />
          Exit Review
        </Button>
      </div>
      <FlashcardContainer card={currentCard} />

      {/* Keyboard Shortcuts Help Dialog */}
      <KeyboardShortcutsHelp
        open={isHelpDialogOpen}
        onOpenChange={setIsHelpDialogOpen}
      />
    </div>
  );
}
```

**Changes**:
- Import `KeyboardShortcutsHelp` component
- Destructure `{ isHelpDialogOpen, setIsHelpDialogOpen }` from useKeyboardShortcuts()
- Add `<KeyboardShortcutsHelp>` component at end of JSX

**Lines Changed**: ~5 lines added (total: ~136 lines)

**Verification**:
- Pressing "?" opens help dialog
- Pressing Esc closes help dialog
- Help dialog displays over flashcard (z-index managed by Shadcn Dialog)

---

### 4.6 Subtask 6: Update Style Guide with Accessibility Guidelines (1 minute)

**File**: `.claude/01-MVP/frontend/Style-Guide.md` (lines 593-631)

**Add New Section** (after line 631):

```markdown
### Focus Management

**Auto-Focus Patterns**:
- Dialog open: Focus moves to dialog title (Shadcn default)
- Dialog close: Focus returns to triggering element (Radix UI)
- Card flip: Focus remains on card (no auto-focus)
- After rating: Focus moves to next card (via re-render)

**Focus Trap**:
- Modals/Dialogs: Use Shadcn Dialog (built-in focus trap via Radix UI)
- Non-modal components: No focus trap needed

**Visual Focus Indicators**:
```css
/* All interactive elements */
button:focus, a:focus, [role="button"]:focus {
    outline: 2px solid #2563eb;
    outline-offset: 2px;
}

/* Keyboard-only focus (optional enhancement) */
button:focus:not(:focus-visible) {
    outline: none;
}

button:focus-visible {
    outline: 2px solid #2563eb;
    outline-offset: 2px;
}
```

### ARIA Live Regions

**Usage**:
```typescript
// Polite announcements (don't interrupt)
<div className="sr-only" role="status" aria-live="polite" aria-atomic="true">
  {announcement}
</div>

// Assertive announcements (interrupt if necessary)
<div className="sr-only" role="alert" aria-live="assertive" aria-atomic="true">
  {errorMessage}
</div>
```

**Best Practices**:
- Use `aria-live="polite"` for most announcements (progress, state changes)
- Use `aria-live="assertive"` only for critical errors/alerts
- Keep announcements concise (5-10 words)
- Clear announcement after brief delay (100ms) to allow re-announcement

### Keyboard Shortcuts

**Standard Patterns**:
- Help dialog: `?` or `Shift+/` (Gmail convention)
- Close dialog: `Esc`
- Primary action: `Space` or `Enter`
- Secondary actions: Number keys (1-4)

**Implementation**:
```typescript
// Ignore shortcuts when typing in inputs
if (event.target instanceof HTMLInputElement || event.target instanceof HTMLTextAreaElement) {
  return;
}

// Ignore shortcuts with modifier keys (except Shift for "?")
if (event.ctrlKey || event.metaKey || event.altKey) {
  return;
}
```

### Screen Reader Only Content

**Utility Class**:
```css
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}
```

**Usage**:
- ARIA live regions
- Skip links
- Additional context for screen readers
- Hidden labels for icon-only buttons
```

**Lines Added**: ~80 lines

**Verification**:
- Documentation complete and accurate
- Examples are copy-paste ready
- Follows existing Style Guide format

---

## 5. Testing Strategy

### 5.1 Manual Keyboard Navigation Test (5 minutes total for all tests)

**Test 1: Basic Keyboard Shortcuts**
1. Navigate to `/decks/:deckId/review`
2. Press **Space** ‚Üí Verify card flips
3. Press **3** (Good) ‚Üí Verify card rated, next card loads
4. Press **1** (Again) ‚Üí Verify card rated
5. Press **?** ‚Üí Verify help dialog opens
6. Press **Esc** ‚Üí Verify help dialog closes
7. ‚úÖ All shortcuts work

**Test 2: Keyboard-Only Navigation**
1. Navigate to `/decks/:deckId/review`
2. Press **Tab** ‚Üí Focus should move to "Exit Review" button
3. Press **Enter** ‚Üí Should exit review
4. Navigate back to review page
5. Press **?** ‚Üí Open help dialog
6. Press **Tab** repeatedly ‚Üí Focus should cycle through dialog elements
7. Press **Esc** ‚Üí Close dialog
8. ‚úÖ All elements keyboard accessible

**Test 3: Screen Reader Announcements** (VoiceOver on macOS)
1. Enable VoiceOver (Cmd+F5)
2. Navigate to `/decks/:deckId/review`
3. Press **Space** ‚Üí Listen for "Answer revealed" announcement
4. Press **3** ‚Üí Navigate to next card, listen for "Card 2 of 24"
5. Press **?** ‚Üí Listen for dialog title "Keyboard Shortcuts"
6. ‚úÖ Screen reader announces state changes

**Test 4: Focus Indicators**
1. Navigate to `/decks/:deckId/review`
2. Press **Tab** to focus on "Exit Review" button
3. Verify 2px blue outline visible around button
4. Press **Tab** to focus on card
5. Verify 2px blue outline visible around card
6. Click rating button, verify outline visible
7. ‚úÖ Focus indicators visible on all interactive elements

**Test 5: Help Dialog Accessibility**
1. Press **?** to open help dialog
2. Verify focus moves to dialog (title or first focusable element)
3. Press **Tab** repeatedly ‚Üí Verify focus cycles within dialog (focus trap)
4. Press **Esc** ‚Üí Verify focus returns to page
5. ‚úÖ Dialog focus management works

### 5.2 Build Verification

```bash
cd learn-greek-easy-frontend
npm run build
```

**Expected**:
- ‚úÖ TypeScript: 0 errors
- ‚úÖ Build: SUCCESS
- ‚úÖ No warnings about missing ARIA attributes

### 5.3 Browser Console Verification

**Steps**:
1. Open browser DevTools console
2. Navigate to `/decks/:deckId/review`
3. Press **?**, **Space**, **1-4**, **Esc** in sequence
4. Check console for errors

**Expected**:
- ‚úÖ No console errors
- ‚úÖ No React warnings
- ‚úÖ No ARIA validation warnings

---

## 6. Time Breakdown

**Total Estimated Time**: 30 minutes

| Subtask | Task | Estimated | Priority |
|---------|------|-----------|----------|
| 4.1 | Enhance useKeyboardShortcuts hook | 5 min | High |
| 4.2 | Create KeyboardShortcutsHelp component | 10 min | High |
| 4.3 | Add ARIA live regions to FlashcardContainer | 8 min | High |
| 4.4 | Add ARIA labels to RatingButtons (skip - already done) | 0 min | Low |
| 4.5 | Integrate help dialog into FlashcardReviewPage | 3 min | High |
| 4.6 | Update Style Guide | 1 min | Medium |
| 5 | Testing (all 5 tests) | 3 min | High |
| **TOTAL** | | **30 min** | |

**Buffer Strategy**:
- No buffer included (tight constraint)
- If time runs over, skip optional enhancements (visual keyboard hints on buttons)
- Priority: Help dialog > ARIA live regions > Style Guide updates

---

## 7. Files to Create/Modify

### 7.1 Files to Create (1 file)

**New Files**:
1. `/src/components/review/KeyboardShortcutsHelp.tsx` (~110 lines) - Help dialog component

### 7.2 Files to Modify (4 files)

**Modified Files**:
1. `/src/hooks/useKeyboardShortcuts.ts` - Add "?" and Esc handlers, return dialog state (~90 lines, +20 lines)
2. `/src/components/review/FlashcardContainer.tsx` - Add ARIA live region (~80 lines, +30 lines)
3. `/src/pages/FlashcardReviewPage.tsx` - Integrate help dialog (~136 lines, +5 lines)
4. `.claude/01-MVP/frontend/Style-Guide.md` - Add accessibility guidelines (~778 lines, +80 lines)

### 7.3 Files to Update (Documentation)

**Documentation Files**:
1. `.claude/01-MVP/frontend/Components-Reference.md` - Add KeyboardShortcutsHelp entry
2. `.claude/01-MVP/frontend/05/05-flashcard-review.md` - Update Task 05.07 status to completed

### 7.4 Files Verified (No Changes)

**No changes needed**:
1. `/src/components/review/RatingButtons.tsx` - Already has aria-label ‚úÖ
2. `/src/components/review/CardMain.tsx` - Already has role="button", tabIndex, onKeyDown ‚úÖ
3. `/src/components/review/KeyboardShortcutsTooltip.tsx` - Keep as-is (quick reference tooltip)

---

## 8. Success Criteria Checklist

### 8.1 Functional Requirements

- [ ] Pressing "?" opens keyboard shortcuts help dialog
- [ ] Pressing Esc closes help dialog (if open)
- [ ] Help dialog shows all shortcuts (Space, 1-4, ?, Esc)
- [ ] Screen reader announces card flip ("Answer revealed")
- [ ] Screen reader announces card transitions ("Card 3 of 24")
- [ ] All review actions accessible via keyboard only
- [ ] Focus visible on all interactive elements (2px blue outline)
- [ ] Tab navigation follows logical order (Exit ‚Üí Card ‚Üí Ratings)

### 8.2 Technical Requirements

- [ ] TypeScript: 0 compilation errors
- [ ] Build: SUCCESS (npm run build)
- [ ] No console errors during keyboard navigation
- [ ] All ARIA attributes valid
- [ ] Help dialog has focus trap (Tab cycles within dialog)
- [ ] Help dialog returns focus after close

### 8.3 User Experience Requirements

- [ ] Keyboard shortcuts discoverable (help accessible via "?")
- [ ] Help dialog visually clear and easy to read
- [ ] Screen reader announcements concise and helpful
- [ ] Focus indicators visible but not distracting
- [ ] No layout shift when announcements trigger
- [ ] Help dialog responsive (mobile and desktop)

### 8.4 Code Quality Requirements

- [ ] Components follow existing patterns
- [ ] ARIA implementation follows best practices
- [ ] Live region announcements clear after brief delay
- [ ] No duplicate ARIA attributes
- [ ] Comments explain accessibility features
- [ ] Style Guide documentation complete

---

## 9. Documentation Updates

### 9.1 Components-Reference.md Updates

**File**: `.claude/01-MVP/frontend/Components-Reference.md`

**Add Section** (after SessionSummaryPage section):

```markdown
### 18. KeyboardShortcutsHelp

**Purpose**: Modal dialog displaying all keyboard shortcuts available during flashcard review.

**File**: `/src/components/review/KeyboardShortcutsHelp.tsx`

**Interface**:
```typescript
interface KeyboardShortcutsHelpProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
}
```

**Usage**:
```tsx
import { KeyboardShortcutsHelp } from '@/components/review/KeyboardShortcutsHelp';

// In FlashcardReviewPage
const { isHelpDialogOpen, setIsHelpDialogOpen } = useKeyboardShortcuts();

<KeyboardShortcutsHelp
  open={isHelpDialogOpen}
  onOpenChange={setIsHelpDialogOpen}
/>
```

**Features**:
- Categorized shortcuts (Review Actions, Navigation)
- Visual keyboard key badges (<kbd> elements)
- Responsive layout (max-w-2xl)
- Built-in focus trap (Shadcn Dialog)
- Esc to close, click outside to close
- Footer tip about input exclusion
- ARIA labeled for screen readers

**Shortcut Categories**:

**Review Actions**:
- Space: Flip card to reveal answer
- 1: Rate card as "Again"
- 2: Rate card as "Hard"
- 3: Rate card as "Good"
- 4: Rate card as "Easy"

**Navigation**:
- ?: Show/hide help dialog
- Esc: Close dialog

**Keyboard Trigger**:
- Open/close with `?` key (Shift+/)
- Handled by `useKeyboardShortcuts()` hook

**Accessibility**:
- Focus trap when open (Tab cycles within dialog)
- Focus returns to triggering element on close
- Screen reader announces dialog title
- All shortcuts keyboard accessible

**Related Components**:
- [useKeyboardShortcuts](#usekeyboardshortcuts) - Hook managing help dialog state
- [KeyboardShortcutsTooltip](#keyboardshortcutstooltip) - Hover tooltip for quick reference
```

### 9.2 Task 05 Main Documentation Update

**File**: `.claude/01-MVP/frontend/05/05-flashcard-review.md`

**Update Section**: `### 05.07: Add Keyboard Shortcuts and Accessibility`

**Change Status**:
```markdown
### 05.07: Add Keyboard Shortcuts and Accessibility

**Status**: ‚úÖ **COMPLETED** (2025-11-04)
**Duration**: 30 minutes (estimated), XX minutes (actual)
**Priority**: High

**Completed Changes**:
- ‚úÖ Enhanced useKeyboardShortcuts hook with "?" and Esc handlers
- ‚úÖ Created KeyboardShortcutsHelp modal dialog component
- ‚úÖ Added ARIA live regions to FlashcardContainer (announcements)
- ‚úÖ Integrated help dialog into FlashcardReviewPage
- ‚úÖ Updated Style Guide with accessibility guidelines
- ‚úÖ Verified WCAG 2.1 AA compliance (keyboard navigation, screen reader support)

**Files Created**:
- `/src/components/review/KeyboardShortcutsHelp.tsx` - NEW help dialog component

**Files Modified**:
- `/src/hooks/useKeyboardShortcuts.ts` - Added "?" and Esc handlers
- `/src/components/review/FlashcardContainer.tsx` - Added ARIA live region
- `/src/pages/FlashcardReviewPage.tsx` - Integrated help dialog
- `.claude/01-MVP/frontend/Style-Guide.md` - Added accessibility section

**Accessibility Features Delivered**:
1. Full keyboard navigation (no mouse required)
2. Screen reader announcements (card flip, transitions)
3. Keyboard shortcuts help dialog (accessible with "?")
4. Visible focus indicators (2px blue outline)
5. ARIA labels on all interactive elements
6. ARIA live regions for state changes
7. Focus management (dialog focus trap)

**Testing Completed**:
- ‚úÖ Keyboard-only navigation test
- ‚úÖ Screen reader test (VoiceOver)
- ‚úÖ Focus visibility test
- ‚úÖ Build verification (0 errors)
- ‚úÖ Console verification (no warnings)
```

---

## 10. Risk Analysis and Mitigation

### 10.1 Technical Risks

**Risk 1: Screen Reader Announcement Conflicts**
- **Severity**: Medium
- **Probability**: Low
- **Impact**: Multiple announcements overlap, confusing screen reader users
- **Mitigation**: Use brief delay (100ms) to clear announcements, use aria-live="polite"
- **Fallback**: If issues persist, remove less important announcements (keep only card transitions)

**Risk 2: Focus Trap Breaking Tab Navigation**
- **Severity**: High
- **Probability**: Very Low (Shadcn/Radix UI handles this)
- **Impact**: Users can't close dialog, keyboard navigation broken
- **Mitigation**: Use Shadcn Dialog (built-in focus trap), test thoroughly
- **Fallback**: If Shadcn focus trap fails, implement manual focus trap with useEffect

**Risk 3: ARIA Attribute Validation Errors**
- **Severity**: Low
- **Probability**: Low
- **Impact**: Console warnings, accessibility tools report errors
- **Mitigation**: Use standard ARIA attributes only, verify with browser DevTools
- **Fallback**: Remove invalid attributes, rely on semantic HTML

### 10.2 User Experience Risks

**Risk 4: Screen Reader Announcements Too Verbose**
- **Severity**: Medium
- **Probability**: Medium
- **Impact**: Announcements interrupt reading flow, annoying users
- **Mitigation**: Keep announcements concise (5-10 words), use aria-live="polite"
- **Fallback**: User feedback will clarify if announcements need tuning

**Risk 5: Keyboard Shortcuts Conflict with Browser/OS**
- **Severity**: Low
- **Probability**: Low
- **Impact**: Shortcuts don't work (e.g., Cmd+? opens Safari help)
- **Mitigation**: Use standard conventions ("?"), avoid Cmd/Ctrl modifiers
- **Fallback**: Document known conflicts, suggest alternatives

### 10.3 Time Risks

**Risk 6: Implementation Takes Longer Than 30 Minutes**
- **Severity**: Low
- **Probability**: Medium
- **Impact**: Task incomplete
- **Mitigation**: Prioritize core features (help dialog, ARIA live regions)
- **Fallback**: Skip optional enhancements (visual keyboard hints on buttons)

---

## 11. Open Questions and Assumptions

### Assumptions

1. **Shadcn Dialog Has Focus Trap**: Verified in Shadcn docs - ‚úÖ Correct (uses Radix UI)
2. **sr-only Class Exists**: Standard Tailwind utility - ‚úÖ Correct
3. **FlashcardReviewPage Uses useKeyboardShortcuts**: Verified in code (line 24) - ‚úÖ Correct
4. **RatingButtons Already Has aria-label**: Verified in code (line 37) - ‚úÖ Correct
5. **Style Guide Has Accessibility Section**: Verified (lines 593-631) - ‚úÖ Correct

### Open Questions

**Q1**: Should we add skip links (skip to main content)?
- **Answer**: No, out of scope for 30-minute task
- **Rationale**: Low priority, can add later if needed

**Q2**: Should help dialog show keyboard hints on button hover?
- **Answer**: No, dialog is sufficient
- **Rationale**: Tooltip already exists for quick reference

**Q3**: Should we add visual keyboard badges on rating buttons (e.g., "3" badge on "Good")?
- **Answer**: No, out of scope
- **Rationale**: Would require additional styling, already shown in tooltip/help

**Q4**: Should Esc exit review session (in addition to closing help)?
- **Answer**: No, only close help dialog
- **Rationale**: Accidental Esc press could lose session progress, use "Exit Review" button

**Q5**: Should we announce session completion in live region?
- **Answer**: No, SessionSummaryPage already shows completion
- **Rationale**: Session end auto-navigates to summary, no need for announcement

---

## 12. Post-Implementation Notes

### Actual Implementation Time

**Start Time**: ___________
**End Time**: ___________
**Total Duration**: ___ minutes

### Deviations from Plan

_Record any changes made during implementation that differ from this plan:_
-
-
-

### Issues Encountered

_Document any bugs, blockers, or unexpected challenges:_
-
-
-

### Future Improvements

_Suggestions for Task 05.08 or future tasks:_
- Consider adding skip links (skip to rating buttons)
- Consider adding visual keyboard hints on buttons (badges)
- Consider adding "Pause" shortcut (P key)
- Consider adding "Undo" shortcut (Cmd+Z to undo last rating)
- Consider adding ARIA landmark roles (main, navigation)

---

## 13. References

### Related Files
- `/src/hooks/useKeyboardShortcuts.ts` - Keyboard shortcut logic (Task 05.04)
- `/src/components/review/FlashcardContainer.tsx` - Main review container (Task 05.04)
- `/src/pages/FlashcardReviewPage.tsx` - Review session page (Task 05.04)
- `/src/components/review/KeyboardShortcutsTooltip.tsx` - Existing tooltip (Task 05.04)
- `.claude/01-MVP/frontend/Style-Guide.md` - Design system guidelines

### Task Dependencies
- **05.04**: Provides FlashcardReviewPage, useKeyboardShortcuts hook ‚úÖ
- **05.05**: Provides SessionSummaryPage (navigation target) ‚úÖ
- All tasks completed ‚úÖ

### External Documentation
- [WCAG 2.1 AA Guidelines](https://www.w3.org/WAI/WCAG21/quickref/?currentsidebar=%23col_overview&levels=aaa)
- [ARIA Authoring Practices Guide](https://www.w3.org/WAI/ARIA/apg/)
- [Shadcn Dialog Component](https://ui.shadcn.com/docs/components/dialog)
- [Radix UI Dialog (Focus Management)](https://www.radix-ui.com/primitives/docs/components/dialog)

---

**Plan Status**: ‚úÖ Complete and Ready for Execution
**Next Step**: Execute implementation using executor agent or manual development
**Estimated Success Rate**: 95% (clear scope, existing infrastructure, well-documented)
