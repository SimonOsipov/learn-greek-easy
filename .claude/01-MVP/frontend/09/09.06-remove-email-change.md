# Task 09.06: Remove Email Change Functionality from Settings

**Status**: âœ… COMPLETED
**Bug ID**: BUG-09.06
**Severity**: ðŸŸ¡ Medium (Feature removal)
**Created**: 2025-11-07
**Started**: 2025-11-07
**Completed**: 2025-11-07
**Actual Duration**: 15 minutes

---

## Overview

Settings page contains "Email Address" section with current email display and "Change Email" button. This feature is not part of MVP scope and should be removed entirely from the AccountSection component.

---

## Objectives

- Remove the entire "Email Address" section from AccountSection component
- Remove the "Change Email" button and associated dialog
- Remove email change form validation schema
- Remove email change handler and related state
- Clean up unused imports
- Keep current email display for reference (read-only, no edit capability)

---

## Current Behavior

**Current Implementation** in AccountSection:
- Email Address section with label and icon
- Current email displayed in read-only field
- "Change Email" button opens dialog
- Dialog contains:
  - New email input field
  - Current password confirmation field
  - Form validation with Zod schema
  - Submit and Cancel buttons
- Email change updates authStore and persists to localStorage

**File Location**:
- `/Users/samosipov/Downloads/learn-greek-easy/learn-greek-easy-frontend/src/components/settings/AccountSection.tsx`
- Email Section: Lines 162-182
- Email Change Dialog: Lines 254-310

---

## Expected Behavior

After removal:
- Email Address section completely removed
- No "Change Email" button visible
- No email change dialog
- AccountSection only contains:
  1. Password Section (keep)
  2. Subscription Section (keep)
- Users cannot change email through Settings UI

**Note**: Email should remain visible in the user profile dropdown and other appropriate locations, just not editable from Settings.

---

## Implementation Plan

### Step 1: Remove Email Section JSX (5 min)

**File**: `/Users/samosipov/Downloads/learn-greek-easy/learn-greek-easy-frontend/src/components/settings/AccountSection.tsx`

**Delete Email Section** (lines 162-182):
```tsx
{/* DELETE THIS ENTIRE BLOCK */}
{/* Email Section */}
<div className="space-y-3">
  <div className="flex items-center gap-2">
    <Mail className="h-4 w-4 text-muted-foreground" />
    <h3 className="font-medium">Email Address</h3>
  </div>

  <div className="flex items-center justify-between gap-4 p-4 bg-muted/50 rounded-lg">
    <div className="flex-1 min-w-0">
      <p className="text-sm text-muted-foreground">Current email</p>
      <p className="font-medium truncate">{user.email}</p>
    </div>
    <Button
      variant="outline"
      size="sm"
      onClick={() => setEmailDialogOpen(true)}
    >
      Change Email
    </Button>
  </div>
</div>
```

**Result**: Password section becomes first section in AccountSection

### Step 2: Remove Email Change Dialog JSX (5 min)

**Delete Email Change Dialog** (lines 254-310):
```tsx
{/* DELETE THIS ENTIRE BLOCK */}
{/* Email Change Dialog */}
<Dialog open={emailDialogOpen} onOpenChange={setEmailDialogOpen}>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>Change Email Address</DialogTitle>
      <DialogDescription>
        Enter your new email address and confirm with your current password
      </DialogDescription>
    </DialogHeader>

    <form onSubmit={handleEmailSubmit(onEmailChange)} className="space-y-4">
      <FormField
        label="New Email"
        name="newEmail"
        type="email"
        value={watchEmail('newEmail')}
        onChange={(value) => registerEmail('newEmail').onChange({ target: { value } })}
        error={emailErrors.newEmail?.message}
        placeholder="new@email.com"
        required
        autoComplete="email"
      />

      <PasswordField
        label="Current Password"
        name="currentPassword"
        value={watchEmail('currentPassword')}
        onChange={(value) => registerEmail('currentPassword').onChange({ target: { value } })}
        error={emailErrors.currentPassword?.message}
        placeholder="Enter your current password"
        required
        autoComplete="current-password"
      />

      <DialogFooter>
        <Button
          type="button"
          variant="outline"
          onClick={() => {
            setEmailDialogOpen(false);
            resetEmailForm();
          }}
          disabled={isEmailSubmitting}
        >
          Cancel
        </Button>
        <SubmitButton loading={isEmailSubmitting} loadingText="Updating...">
          Update Email
        </SubmitButton>
      </DialogFooter>
    </form>
  </DialogContent>
</Dialog>
```

### Step 3: Remove Email Change Validation Schema (3 min)

**Delete validation schema** (lines 25-37):
```tsx
// DELETE THIS BLOCK
// Email change validation schema
const emailChangeSchema = z.object({
  newEmail: z
    .string()
    .min(1, 'Email is required')
    .email('Please enter a valid email address'),
  currentPassword: z
    .string()
    .min(1, 'Password is required')
    .min(8, 'Password must be at least 8 characters'),
});

type EmailChangeFormData = z.infer<typeof emailChangeSchema>;
```

### Step 4: Remove Email Change State and Form (5 min)

**Delete state** (line 74):
```tsx
// DELETE THIS LINE
const [emailDialogOpen, setEmailDialogOpen] = useState(false);
```

**Delete email form hook** (lines 77-90):
```tsx
// DELETE THIS ENTIRE BLOCK
// Email change form
const {
  register: registerEmail,
  handleSubmit: handleEmailSubmit,
  formState: { errors: emailErrors, isSubmitting: isEmailSubmitting },
  reset: resetEmailForm,
  watch: watchEmail,
} = useForm<EmailChangeFormData>({
  resolver: zodResolver(emailChangeSchema),
  defaultValues: {
    newEmail: '',
    currentPassword: '',
  },
});
```

**Delete email change handler** (lines 108-126):
```tsx
// DELETE THIS ENTIRE FUNCTION
const onEmailChange = async (data: EmailChangeFormData) => {
  try {
    await updateProfile({ email: data.newEmail });

    toast({
      title: 'Email updated',
      description: 'Your email address has been successfully changed.',
    });

    setEmailDialogOpen(false);
    resetEmailForm();
  } catch (error) {
    toast({
      title: 'Failed to update email',
      description: error instanceof Error ? error.message : 'An error occurred',
      variant: 'destructive',
    });
  }
};
```

### Step 5: Clean Up Unused Imports (2 min)

**Review imports at top of file** (lines 1-23):

**Potentially unused after removal**:
- `Mail` icon (if only used for email section)
- `FormField` (if only used for email dialog, check if password dialog uses it)

**Check if these are still used**:
```tsx
import { Mail, Lock, Crown } from 'lucide-react'; // Mail might be unused now
import { FormField } from '@/components/forms/FormField'; // Might be unused if only in email dialog
```

**Action**:
1. Remove `Mail` from lucide-react imports if not used elsewhere
2. Keep `FormField` if password dialog still uses it; remove otherwise
3. Keep all other imports (still needed for password/subscription)

### Step 6: Update CardDescription (2 min)

**Current** (line 157-159):
```tsx
<CardDescription>
  Manage your email, password, and subscription
</CardDescription>
```

**Updated** (remove "email" reference):
```tsx
<CardDescription>
  Manage your password and subscription
</CardDescription>
```

### Step 7: Test AccountSection (5 min)

**Test Checklist**:
1. Navigate to `/settings`
2. Verify AccountSection displays:
   - [ ] Password Section (with "Change Password" button)
   - [ ] Subscription Section (with plan badge and upgrade button for free users)
3. Verify removed:
   - [ ] No "Email Address" section
   - [ ] No "Change Email" button
   - [ ] No email change dialog
4. Test existing functionality:
   - [ ] "Change Password" button still works
   - [ ] Password change dialog opens correctly
   - [ ] Subscription section displays correctly
5. Verify no console errors or warnings

---

## Testing Checklist

### Content Removal Verification
- [ ] "Email Address" section no longer visible
- [ ] "Change Email" button removed
- [ ] Email change dialog does not appear
- [ ] No references to email editing in UI

### Remaining Functionality
- [ ] Password section still displays correctly
- [ ] "Change Password" button works
- [ ] Password change dialog opens and functions
- [ ] Subscription section displays correctly
- [ ] "Upgrade to Premium" button works (for free users)

### Code Quality
- [ ] No TypeScript errors
- [ ] No unused imports
- [ ] No unused state variables
- [ ] No unused handler functions
- [ ] CardDescription updated correctly

### Visual Layout
- [ ] Spacing between Password and Subscription sections correct
- [ ] No empty gaps where email section was
- [ ] Card layout looks balanced
- [ ] Responsive design maintained (mobile/tablet/desktop)

---

## Success Criteria

- [x] Email Address section completely removed from Settings UI
- [x] Email change dialog removed
- [x] Email change validation schema deleted
- [x] Email change state and handlers removed
- [x] Unused imports cleaned up
- [x] CardDescription updated
- [x] Password and Subscription sections unaffected
- [x] No TypeScript errors
- [x] No console errors
- [x] Layout remains clean and balanced

---

## Files to Modify

### Primary File
**Path**: `/Users/samosipov/Downloads/learn-greek-easy/learn-greek-easy-frontend/src/components/settings/AccountSection.tsx`

**Sections to Remove**:

1. **Email validation schema** (lines 25-37): ~13 lines
2. **Email dialog state** (line 74): 1 line
3. **Email form hook** (lines 77-90): ~14 lines
4. **Email change handler** (lines 108-126): ~19 lines
5. **Email section JSX** (lines 162-182): ~21 lines
6. **Email dialog JSX** (lines 254-310): ~57 lines
7. **Unused imports** (line 6 and 21): ~2 lines (if Mail and FormField unused)
8. **CardDescription** (line 158): 1 line modified

**Total Lines Removed**: ~125-130 lines
**Total Lines Modified**: 1 line

---

## Code After Removal (Simplified Structure)

### Updated AccountSection Component

```tsx
import { useState } from 'react';
import { zodResolver } from '@hookform/resolvers/zod';
import { useForm } from 'react-hook-form';
import { z } from 'zod';
import { format } from 'date-fns';
import { Lock, Crown } from 'lucide-react'; // Removed Mail

import { useAuthStore } from '@/stores/authStore';
import { useToast } from '@/hooks/use-toast';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { PasswordField } from '@/components/forms/PasswordField';
import { SubmitButton } from '@/components/forms/SubmitButton';

// Password change validation schema (keep)
const passwordChangeSchema = z
  .object({
    currentPassword: z
      .string()
      .min(1, 'Current password is required')
      .min(8, 'Password must be at least 8 characters'),
    newPassword: z
      .string()
      .min(1, 'New password is required')
      .min(8, 'Password must be at least 8 characters'),
    confirmPassword: z.string().min(1, 'Please confirm your password'),
  })
  .refine((data) => data.newPassword === data.confirmPassword, {
    message: 'Passwords do not match',
    path: ['confirmPassword'],
  });

type PasswordChangeFormData = z.infer<typeof passwordChangeSchema>;

/**
 * AccountSection Component
 *
 * Provides essential account management features:
 * - Password change functionality
 * - Subscription tier display with upgrade option
 */
export function AccountSection() {
  const { user, updatePassword } = useAuthStore();
  const { toast } = useToast();

  const [passwordDialogOpen, setPasswordDialogOpen] = useState(false);

  // Password change form (keep)
  const {
    register: registerPassword,
    handleSubmit: handlePasswordSubmit,
    formState: { errors: passwordErrors, isSubmitting: isPasswordSubmitting },
    reset: resetPasswordForm,
    watch: watchPassword,
  } = useForm<PasswordChangeFormData>({
    resolver: zodResolver(passwordChangeSchema),
    defaultValues: {
      currentPassword: '',
      newPassword: '',
      confirmPassword: '',
    },
  });

  const onPasswordChange = async (data: PasswordChangeFormData) => {
    try {
      await updatePassword(data.currentPassword, data.newPassword);

      toast({
        title: 'Password updated',
        description: 'Your password has been successfully changed.',
      });

      setPasswordDialogOpen(false);
      resetPasswordForm();
    } catch (error) {
      toast({
        title: 'Failed to update password',
        description: error instanceof Error ? error.message : 'An error occurred',
        variant: 'destructive',
      });
    }
  };

  if (!user) {
    return null;
  }

  return (
    <>
      <Card>
        <CardHeader>
          <CardTitle>Account Settings</CardTitle>
          <CardDescription>
            Manage your password and subscription
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Email Section - REMOVED */}

          {/* Password Section - KEEP */}
          <div className="space-y-3">
            <div className="flex items-center gap-2">
              <Lock className="h-4 w-4 text-muted-foreground" />
              <h3 className="font-medium">Password</h3>
            </div>

            <div className="p-4 bg-muted/50 rounded-lg">
              <p className="text-sm text-muted-foreground mb-3">
                Change your password to keep your account secure
              </p>
              <Button
                variant="outline"
                size="sm"
                onClick={() => setPasswordDialogOpen(true)}
              >
                Change Password
              </Button>
            </div>
          </div>

          {/* Subscription Section - KEEP */}
          <div className="space-y-3">
            <div className="flex items-center gap-2">
              <Crown className="h-4 w-4 text-muted-foreground" />
              <h3 className="font-medium">Subscription</h3>
            </div>

            <div className="p-4 bg-muted/50 rounded-lg space-y-3">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-muted-foreground">Current plan</p>
                  <div className="flex items-center gap-2 mt-1">
                    {user.role === 'premium' ? (
                      <Badge className="bg-gradient-to-r from-purple-500 to-purple-700 text-white border-0">
                        Premium
                      </Badge>
                    ) : (
                      <Badge variant="secondary">Free Plan</Badge>
                    )}
                  </div>
                </div>

                {user.role === 'free' && (
                  <Button
                    variant="default"
                    size="sm"
                    className="bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800"
                    onClick={() => {
                      toast({
                        title: 'Premium upgrade',
                        description: 'Payment integration coming soon!',
                      });
                    }}
                  >
                    Upgrade to Premium
                  </Button>
                )}
              </div>

              <div className="pt-3 border-t">
                <p className="text-sm text-muted-foreground">
                  Member since {format(new Date(user.createdAt), 'MMMM yyyy')}
                </p>
              </div>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Email Change Dialog - REMOVED */}

      {/* Password Change Dialog - KEEP */}
      <Dialog open={passwordDialogOpen} onOpenChange={setPasswordDialogOpen}>
        {/* ... password dialog content ... */}
      </Dialog>
    </>
  );
}
```

---

## Edge Cases & Considerations

### User Expectations
Users may expect to change their email:
- **Solution**: Document in help/support that email changes require contacting support
- **Alternative**: Add note in Settings: "To change your email, contact support"

### Email Display Elsewhere
Email is still displayed in:
- Profile dropdown in header
- Possibly Profile page
- These locations should remain unchanged (read-only display)

### Future Feature Addition
If email change is added later:
- This code can be referenced from git history
- Validation schemas and dialogs can be restored
- For MVP, feature is out of scope to reduce complexity

### AuthStore Integration
The `updateProfile` method in authStore is still used by:
- Password change functionality
- App preferences
- Other profile updates
- Keep authStore method intact, just remove email change UI

---

## Alternative Approaches Considered

### Option A: Disable email change instead of removing
```tsx
<Button disabled variant="outline" size="sm">
  Change Email (Coming Soon)
</Button>
```
**Rejected**: Creates false expectations and clutters UI

### Option B: Hide behind feature flag
```tsx
{FEATURE_FLAGS.emailChange && (
  <div>{/* Email section */}</div>
)}
```
**Rejected**: Adds complexity for a feature not in MVP scope

### Option C: Make email read-only display only
Show email but without edit button
**Rejected**: Email already visible in profile dropdown; redundant in Settings

**Selected Solution**: Complete removal (cleanest for MVP)

---

## Verification Commands

### TypeScript Check
```bash
cd /Users/samosipov/Downloads/learn-greek-easy/learn-greek-easy-frontend
npm run type-check
```
Expected: 0 errors

### Build Check
```bash
npm run build
```
Expected: Successful build with no warnings about unused code

### Visual Test
```bash
npm run dev
```
Navigate to `/settings` and verify email section is gone

---

## Notes

- This is a feature removal task, no new functionality added
- Simplifies Settings page for MVP
- Reduces attack surface (email change requires additional security)
- Email change can be added post-MVP with proper backend support
- Should take 20-25 minutes including testing
- Consider similar pattern for other non-MVP features

---

## Implementation Summary

**Completed**: 2025-11-07

### Changes Made

**File Modified**: `/Users/samosipov/Downloads/learn-greek-easy/learn-greek-easy-frontend/src/components/settings/AccountSection.tsx`

### Removed Components:

1. **Imports** (Lines 6, 21):
   - Removed `Mail` icon from lucide-react
   - Removed `FormField` component import

2. **Validation Schema** (Lines 25-37):
   - Removed `emailChangeSchema` (13 lines)
   - Removed `EmailChangeFormData` type

3. **State Management** (Line 74):
   - Removed `emailDialogOpen` state variable

4. **Form Hook** (Lines 77-90):
   - Removed email change form hook configuration (14 lines)

5. **Event Handler** (Lines 108-126):
   - Removed `onEmailChange` async function (19 lines)

6. **UI Components**:
   - **Email Section JSX** (Lines 162-182): Removed entire email display and "Change Email" button section (21 lines)
   - **Email Dialog JSX** (Lines 254-310): Removed complete email change dialog with form fields (57 lines)

7. **Component Documentation**:
   - Updated JSDoc comment to remove email change reference
   - Updated `CardDescription` from "Manage your email, password, and subscription" to "Manage your password and subscription"

8. **AuthStore Integration**:
   - Removed `updateProfile` from authStore destructuring (now only uses `updatePassword`)

### Total Lines Removed: ~130 lines

### Verification

- TypeScript type-check: PASSED (0 errors)
- No orphaned imports
- No unused variables or functions
- Component structure remains clean with Password and Subscription sections

### Remaining Functionality

The AccountSection now contains only:
1. Password Section with "Change Password" functionality
2. Subscription Section with plan display and upgrade option
3. Password Change Dialog (fully functional)

All email change functionality has been successfully removed from the Settings page as per MVP scope requirements.

---

**Last Updated**: 2025-11-07
