# 02.03 Pre-commit Hooks Setup

**Project**: Learn Greek Easy - MVP DevOps
**Task**: Configure Pre-commit Hooks for Local Code Quality Enforcement
**Created**: 2025-12-03
**Completed**: 2025-12-03
**Status**: âœ… COMPLETED
**Priority**: Medium
**Depends On**: None (independent task)
**Actual Time**: ~1.5 hours

---

## Table of Contents

1. [Overview](#overview)
2. [Current State Analysis](#current-state-analysis)
3. [Target Architecture](#target-architecture)
4. [Implementation Plan](#implementation-plan)
5. [File Specifications](#file-specifications)
6. [Testing Strategy](#testing-strategy)
7. [Risk Assessment](#risk-assessment)
8. [Execution Checklist](#execution-checklist)

---

## Overview

### Purpose

Set up pre-commit hooks to automatically validate code quality **before commits** are created locally. This provides:

1. **Immediate Feedback**: Catch issues in seconds, not minutes (waiting for CI)
2. **Reduced CI Failures**: Prevent pushing code that would fail CI lint checks
3. **Consistent Code Style**: Enforce formatting standards automatically
4. **Developer Experience**: Auto-fix issues where possible (Black, Prettier, ESLint)

### Scope

| Component | Action | Details |
|-----------|--------|---------|
| Pre-commit Framework | Install & Configure | Create `.pre-commit-config.yaml` at repo root |
| Frontend Hooks | Configure | ESLint, Prettier, TypeScript check |
| Backend Hooks | Configure | Black, isort, Flake8, MyPy |
| General Hooks | Configure | Trailing whitespace, YAML/JSON validation, etc. |
| Helper Script | Create | `scripts/setup-hooks.sh` for onboarding |
| Documentation | Update | Add setup instructions to CLAUDE.md |

### Philosophy: Mirror CI Checks

**Critical Principle**: Pre-commit hooks should mirror CI checks exactly.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Code Quality Check Flow                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Local Development              â†’      CI Pipeline               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â”‚  pre-commit hooks                   GitHub Actions               â”‚
â”‚                                                                  â”‚
â”‚  âœ“ Same tools                       âœ“ Same tools                 â”‚
â”‚  âœ“ Same versions                    âœ“ Same versions              â”‚
â”‚  âœ“ Same config files                âœ“ Same config files          â”‚
â”‚                                                                  â”‚
â”‚  Result: If it passes locally, it passes in CI                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Current State Analysis

### Existing Tools & Configurations

#### Frontend (Already Configured)

| Tool | Config File | npm Script | Status |
|------|-------------|------------|--------|
| ESLint | `eslint.config.js` | `npm run lint` | âœ… Working |
| Prettier | `.prettierrc.json` | `npm run format` | âœ… Working |
| TypeScript | `tsconfig.json` | `npm run type-check` | âœ… Working |

**Existing npm Scripts**:
```json
{
  "lint": "eslint .",
  "lint:fix": "eslint . --fix",
  "format": "prettier --write \"src/**/*.{ts,tsx,css,md}\"",
  "format:check": "prettier --check \"src/**/*.{ts,tsx,css,md}\"",
  "type-check": "tsc --noEmit"
}
```

#### Backend (Already Configured in pyproject.toml)

| Tool | Config Location | Command | Status |
|------|-----------------|---------|--------|
| Black | `pyproject.toml` | `poetry run black` | âœ… Working |
| isort | `pyproject.toml` | `poetry run isort` | âœ… Working |
| Flake8 | Needs `.flake8` | `poetry run flake8` | âš ï¸ Needs config file |
| MyPy | `pyproject.toml` | `poetry run mypy` | âœ… Working |

**Existing Black Config**:
```toml
[tool.black]
line-length = 100
target-version = ['py313']
```

**Existing isort Config**:
```toml
[tool.isort]
profile = "black"
line_length = 100
```

### What's Missing

| Item | Status | Impact |
|------|--------|--------|
| `.pre-commit-config.yaml` | âŒ Missing | No local hooks active |
| `learn-greek-easy-backend/.flake8` | âŒ Missing | Flake8 needs explicit config |
| `scripts/setup-hooks.sh` | âŒ Missing | Manual setup required |
| Documentation | âŒ Missing | Developers don't know to use hooks |

---

## Target Architecture

### Hook Execution Flow

```
Developer runs: git commit -m "message"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Pre-commit Framework                        â”‚
â”‚                  (reads .pre-commit-config.yaml)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€ General Hooks (all files) â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   â€¢ trailing-whitespace                  â”‚
        â”‚   â€¢ end-of-file-fixer                   â”‚
        â”‚   â€¢ check-yaml                          â”‚
        â”‚   â€¢ check-json                          â”‚
        â”‚   â€¢ check-added-large-files             â”‚
        â”‚   â€¢ check-merge-conflict                â”‚
        â”‚   â€¢ detect-private-key                  â”‚
        â”‚   â€¢ no-commit-to-branch (main)          â”‚
        â”‚                                          â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€ Frontend Hooks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚   (if files match ^learn-greek-easy-frontend/)
        â”‚   â€¢ ESLint (auto-fix)                   â”‚
        â”‚   â€¢ Prettier (auto-format)              â”‚
        â”‚   â€¢ TypeScript check                    â”‚
        â”‚                                          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€ Backend Hooks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            (if files match ^learn-greek-easy-backend/)
            â€¢ Black (auto-format)                 â”‚
            â€¢ isort (auto-sort imports)           â”‚
            â€¢ Flake8 (lint)                       â”‚
            â€¢ MyPy (type check)                   â”‚
                                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Hook Results                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  All Pass?                                                     â”‚
â”‚    YES â†’ Commit created successfully                          â”‚
â”‚    NO  â†’ Commit blocked, show errors                          â”‚
â”‚         (auto-fixed files staged for re-commit)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Hook Categories

#### Category 1: General Hooks (All Files)

These hooks apply to all files in the repository:

| Hook | Purpose | Auto-fix? |
|------|---------|-----------|
| `trailing-whitespace` | Remove trailing spaces | âœ… Yes |
| `end-of-file-fixer` | Ensure files end with newline | âœ… Yes |
| `check-yaml` | Validate YAML syntax | âŒ No |
| `check-json` | Validate JSON syntax | âŒ No |
| `check-added-large-files` | Block files > 1MB | âŒ No |
| `check-merge-conflict` | Detect merge conflict markers | âŒ No |
| `detect-private-key` | Block commits with private keys | âŒ No |
| `no-commit-to-branch` | Block direct commits to main | âŒ No |

#### Category 2: Frontend Hooks

Apply only to files in `learn-greek-easy-frontend/`:

| Hook | Tool | Auto-fix? | Files |
|------|------|-----------|-------|
| `frontend-eslint` | ESLint | âœ… Yes | `*.ts, *.tsx, *.js, *.jsx` |
| `frontend-prettier` | Prettier | âœ… Yes | `*.ts, *.tsx, *.css, *.md, *.json` |
| `frontend-typecheck` | TypeScript | âŒ No | `*.ts, *.tsx` |

#### Category 3: Backend Hooks

Apply only to files in `learn-greek-easy-backend/`:

| Hook | Tool | Auto-fix? | Files |
|------|------|-----------|-------|
| `black` | Black | âœ… Yes | `*.py` |
| `isort` | isort | âœ… Yes | `*.py` |
| `flake8` | Flake8 | âŒ No | `*.py` |
| `mypy` | MyPy | âŒ No | `*.py` (src/ only) |

---

## Implementation Plan

### Step 1: Create Backend Flake8 Configuration

**File**: `learn-greek-easy-backend/.flake8`

**Purpose**: Configure Flake8 to work harmoniously with Black formatting.

**Key Settings**:
- Match Black's line length (100 chars)
- Ignore rules that conflict with Black (E203, W503)
- Exclude generated/cached directories
- Allow `F401` (unused imports) in `__init__.py` files

### Step 2: Create Pre-commit Configuration

**File**: `.pre-commit-config.yaml` (repository root)

**Structure**:
```yaml
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks  # General hooks
  - repo: local                                           # Frontend hooks (npm-based)
  - repo: https://github.com/psf/black                    # Backend: Black
  - repo: https://github.com/pycqa/isort                  # Backend: isort
  - repo: https://github.com/pycqa/flake8                 # Backend: Flake8
  - repo: https://github.com/pre-commit/mirrors-mypy      # Backend: MyPy
```

**Design Decisions**:

1. **Frontend hooks use `repo: local`**:
   - Reason: Uses existing npm scripts which are already configured correctly
   - Avoids duplicating ESLint/Prettier configs for pre-commit
   - Ensures consistency with `npm run lint` behavior

2. **Backend hooks use upstream repos**:
   - Reason: Cleaner than local scripts, auto-updates
   - Point to config files in `learn-greek-easy-backend/`

3. **Hook versioning**:
   - Pin to specific versions matching `pyproject.toml` dependencies
   - Black: `24.8.0`
   - isort: `5.13.2`
   - Flake8: `7.1.0`
   - MyPy: `v1.11.0`

### Step 3: Create Setup Helper Script

**File**: `scripts/setup-hooks.sh`

**Purpose**: One-command setup for new developers.

**Functionality**:
1. Check if `pre-commit` is installed
2. Install `pre-commit` if missing
3. Run `pre-commit install`
4. Optionally run `pre-commit run --all-files` for initial check

### Step 4: Update Documentation

**File**: `CLAUDE.md` (add new section)

**Content to Add**:
- Pre-commit setup instructions
- Common commands reference
- Troubleshooting tips

### Step 5: Test the Configuration

**Testing Approach**:
1. Create test files with intentional violations
2. Verify hooks catch issues
3. Verify auto-fix works correctly
4. Test on both frontend and backend files

---

## File Specifications

### File 1: `.pre-commit-config.yaml`

**Location**: Repository root (`/Users/samosipov/Downloads/learn-greek-easy/.pre-commit-config.yaml`)

```yaml
# .pre-commit-config.yaml
# Pre-commit hooks for Learn Greek Easy
# See https://pre-commit.com for more information

default_stages: [commit]
default_language_version:
  python: python3.13
  node: "20.19.0"

repos:
  # =============================================================================
  # General Hooks (All Files)
  # =============================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        exclude: ^(learn-greek-easy-frontend/node_modules/|\.git/|.*\.lock$)
      - id: end-of-file-fixer
        exclude: ^(learn-greek-easy-frontend/node_modules/|\.git/|.*\.lock$)
      - id: check-yaml
        args: [--unsafe]  # Allow custom YAML tags (e.g., GitHub Actions)
      - id: check-json
        exclude: ^(learn-greek-easy-frontend/node_modules/)
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: check-merge-conflict
      - id: detect-private-key
      - id: no-commit-to-branch
        args: [--branch, main]

  # =============================================================================
  # Frontend Hooks (TypeScript/React)
  # Uses local npm scripts to ensure consistency with CI
  # =============================================================================
  - repo: local
    hooks:
      - id: frontend-eslint
        name: Frontend ESLint
        entry: bash -c 'cd learn-greek-easy-frontend && npm run lint:fix'
        language: system
        files: ^learn-greek-easy-frontend/.*\.(ts|tsx|js|jsx)$
        exclude: ^learn-greek-easy-frontend/(node_modules|dist|build|html)/
        pass_filenames: false

      - id: frontend-prettier
        name: Frontend Prettier
        entry: bash -c 'cd learn-greek-easy-frontend && npm run format'
        language: system
        files: ^learn-greek-easy-frontend/.*\.(ts|tsx|js|jsx|css|md|json)$
        exclude: ^learn-greek-easy-frontend/(node_modules|dist|build|html)/
        pass_filenames: false

      - id: frontend-typecheck
        name: Frontend TypeScript Check
        entry: bash -c 'cd learn-greek-easy-frontend && npm run type-check'
        language: system
        files: ^learn-greek-easy-frontend/.*\.(ts|tsx)$
        exclude: ^learn-greek-easy-frontend/(node_modules|dist|build|html)/
        pass_filenames: false

  # =============================================================================
  # Backend Hooks (Python/FastAPI)
  # =============================================================================
  - repo: https://github.com/psf/black
    rev: 24.8.0
    hooks:
      - id: black
        args: [--config=learn-greek-easy-backend/pyproject.toml]
        files: ^learn-greek-easy-backend/

  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: [--settings-path=learn-greek-easy-backend/pyproject.toml]
        files: ^learn-greek-easy-backend/

  - repo: https://github.com/pycqa/flake8
    rev: 7.1.0
    hooks:
      - id: flake8
        args: [--config=learn-greek-easy-backend/.flake8]
        files: ^learn-greek-easy-backend/
        exclude: ^learn-greek-easy-backend/(alembic/versions|\.venv)/

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.11.0
    hooks:
      - id: mypy
        args: [--config-file=learn-greek-easy-backend/pyproject.toml]
        files: ^learn-greek-easy-backend/src/
        additional_dependencies:
          - types-python-dateutil
          - types-redis
          - pydantic>=2.0
          - sqlalchemy>=2.0
```

---

### File 2: `learn-greek-easy-backend/.flake8`

**Location**: `learn-greek-easy-backend/.flake8`

```ini
[flake8]
# Line length should match Black configuration
max-line-length = 100

# Complexity threshold
max-complexity = 10

# Exclude directories
exclude =
    .git,
    __pycache__,
    .venv,
    venv,
    .eggs,
    *.egg,
    dist,
    build,
    alembic/versions,
    .mypy_cache,
    .pytest_cache,
    .coverage,
    htmlcov

# Ignore rules that conflict with Black
# E203: whitespace before ':' (Black formats this way)
# E266: too many leading '#' for block comment
# E501: line too long (Black handles this)
# W503: line break before binary operator (Black preference)
# W504: line break after binary operator
ignore =
    E203,
    E266,
    E501,
    W503,
    W504

# Per-file ignores
per-file-ignores =
    # Allow unused imports in __init__.py (re-exports)
    __init__.py:F401
    # Allow assert in tests
    tests/*:S101
    # Allow longer lines in migrations (auto-generated)
    alembic/*:E501

# Statistics
statistics = true
count = true
```

---

### File 3: `scripts/setup-hooks.sh`

**Location**: `scripts/setup-hooks.sh`

```bash
#!/bin/bash
#
# Setup script for pre-commit hooks
# Run this once after cloning the repository
#
set -e

echo "=========================================="
echo "  Learn Greek Easy - Pre-commit Setup"
echo "=========================================="
echo ""

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Check if we're in the repository root
if [ ! -f ".pre-commit-config.yaml" ]; then
    echo -e "${RED}Error: .pre-commit-config.yaml not found.${NC}"
    echo "Please run this script from the repository root."
    exit 1
fi

# Check if pre-commit is installed
echo "Checking for pre-commit installation..."
if ! command -v pre-commit &> /dev/null; then
    echo -e "${YELLOW}pre-commit not found. Installing...${NC}"

    # Try pip first, then pipx
    if command -v pipx &> /dev/null; then
        pipx install pre-commit
    elif command -v pip &> /dev/null; then
        pip install pre-commit
    elif command -v pip3 &> /dev/null; then
        pip3 install pre-commit
    else
        echo -e "${RED}Error: No pip/pipx found. Please install pre-commit manually:${NC}"
        echo "  pip install pre-commit"
        echo "  OR"
        echo "  brew install pre-commit"
        exit 1
    fi
fi

echo -e "${GREEN}âœ“ pre-commit is installed${NC}"
pre-commit --version
echo ""

# Install the git hooks
echo "Installing git hooks..."
pre-commit install
echo -e "${GREEN}âœ“ Git hooks installed${NC}"
echo ""

# Check if frontend dependencies are installed
echo "Checking frontend dependencies..."
if [ -d "learn-greek-easy-frontend/node_modules" ]; then
    echo -e "${GREEN}âœ“ Frontend node_modules exists${NC}"
else
    echo -e "${YELLOW}Warning: Frontend dependencies not installed.${NC}"
    echo "  Run: cd learn-greek-easy-frontend && npm install"
fi
echo ""

# Check if backend dependencies are installed
echo "Checking backend dependencies..."
if [ -d "learn-greek-easy-backend/.venv" ]; then
    echo -e "${GREEN}âœ“ Backend virtual environment exists${NC}"
else
    echo -e "${YELLOW}Warning: Backend virtual environment not found.${NC}"
    echo "  Run: cd learn-greek-easy-backend && poetry install"
fi
echo ""

# Ask if user wants to run hooks on all files
echo "=========================================="
read -p "Run pre-commit on all files now? (recommended for first setup) [y/N] " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "Running pre-commit on all files..."
    echo "(This may take a few minutes the first time)"
    echo ""
    pre-commit run --all-files || true
fi

echo ""
echo "=========================================="
echo -e "${GREEN}Setup complete!${NC}"
echo ""
echo "Pre-commit hooks will now run automatically on every commit."
echo ""
echo "Useful commands:"
echo "  pre-commit run              # Run on staged files"
echo "  pre-commit run --all-files  # Run on all files"
echo "  pre-commit autoupdate       # Update hook versions"
echo "  git commit --no-verify      # Skip hooks (use sparingly)"
echo "=========================================="
```

---

### File 4: Documentation Update for CLAUDE.md

**Section to Add**:

```markdown
## Pre-commit Hooks

### First-Time Setup

```bash
# Option 1: Use setup script (recommended)
./scripts/setup-hooks.sh

# Option 2: Manual setup
pip install pre-commit  # or: brew install pre-commit
pre-commit install
```

### Daily Usage

Pre-commit hooks run automatically on `git commit`. No action needed!

```bash
# If hooks fail:
# 1. Auto-fixed files are already staged
# 2. Review changes: git diff
# 3. Stage and commit again: git add . && git commit

# Manual commands
pre-commit run                    # Run on staged files only
pre-commit run --all-files        # Run on entire codebase
pre-commit run black --all-files  # Run specific hook
pre-commit autoupdate             # Update hook versions

# Skip hooks (emergency only!)
git commit --no-verify -m "message"
```

### Troubleshooting

| Issue | Solution |
|-------|----------|
| "pre-commit: command not found" | Run: `pip install pre-commit` |
| Hook fails but CI passes | Run: `pre-commit autoupdate` |
| "npm: command not found" in hook | Ensure Node.js is installed |
| MyPy missing dependencies | Run: `cd learn-greek-easy-backend && poetry install` |
| Want to skip hooks once | Use: `git commit --no-verify` |
```

---

## Testing Strategy

### Test Case 1: General Hooks

**Test trailing whitespace**:
```bash
# Add trailing spaces to a file
echo "test   " >> test-file.txt
git add test-file.txt
git commit -m "test"
# Expected: Hook removes trailing spaces, commit proceeds
```

**Test no-commit-to-branch**:
```bash
git checkout main
echo "test" >> test.txt
git add test.txt
git commit -m "test"
# Expected: Hook blocks commit to main branch
```

### Test Case 2: Frontend Hooks

**Test ESLint auto-fix**:
```bash
# Create file with lint error
cat > learn-greek-easy-frontend/src/test-lint.ts << 'EOF'
import { useState } from 'react'
import { useEffect } from 'react'  // Duplicate import (should be merged)

export const Test = () => {
  const [x,setX] = useState(0)  // Missing space after comma
  return null
}
EOF

git add learn-greek-easy-frontend/src/test-lint.ts
git commit -m "test"
# Expected: ESLint fixes import order and formatting
```

**Test Prettier auto-format**:
```bash
# Create unformatted file
cat > learn-greek-easy-frontend/src/test-format.ts << 'EOF'
export const foo = {a:1,b:2,c:3}
EOF

git add learn-greek-easy-frontend/src/test-format.ts
git commit -m "test"
# Expected: Prettier formats to multi-line object
```

### Test Case 3: Backend Hooks

**Test Black auto-format**:
```bash
# Create unformatted Python file
cat > learn-greek-easy-backend/src/test_format.py << 'EOF'
def foo(x,y,z):return x+y+z
EOF

git add learn-greek-easy-backend/src/test_format.py
git commit -m "test"
# Expected: Black formats to proper multi-line function
```

**Test Flake8 lint**:
```bash
# Create file with unused import
cat > learn-greek-easy-backend/src/test_lint.py << 'EOF'
import os
import sys  # unused

def foo():
    return "hello"
EOF

git add learn-greek-easy-backend/src/test_lint.py
git commit -m "test"
# Expected: Flake8 reports F401 (unused import)
```

### Test Case 4: Mixed Changes

**Test frontend + backend in same commit**:
```bash
# Make changes in both directories
echo "// test" >> learn-greek-easy-frontend/src/App.tsx
echo "# test" >> learn-greek-easy-backend/src/main.py

git add .
git commit -m "test"
# Expected: All relevant hooks run (frontend AND backend)
```

### Verification Checklist

- [ ] `trailing-whitespace` removes trailing spaces
- [ ] `end-of-file-fixer` adds final newline
- [ ] `check-yaml` validates YAML syntax
- [ ] `check-json` validates JSON syntax
- [ ] `no-commit-to-branch` blocks commits to main
- [ ] `frontend-eslint` auto-fixes lint issues
- [ ] `frontend-prettier` auto-formats code
- [ ] `frontend-typecheck` catches type errors
- [ ] `black` auto-formats Python code
- [ ] `isort` auto-sorts imports
- [ ] `flake8` reports lint violations
- [ ] `mypy` catches type errors

---

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Hooks slow down commits | Medium | Low | Hooks only run on changed files, not all files |
| False positives block legitimate commits | Low | Medium | Provide `--no-verify` escape hatch |
| Developer doesn't install hooks | Medium | Low | Document in README, add CI as backup |
| Hook versions drift from CI | Low | Medium | Pin versions, use `pre-commit autoupdate` |
| MyPy fails due to missing stubs | Medium | Low | Add `additional_dependencies` in config |
| Frontend hooks fail if npm not installed | Medium | Medium | Check in setup script, clear error messages |

### Rollback Plan

If hooks cause issues after deployment:

```bash
# Temporarily disable hooks
pre-commit uninstall

# Or skip specific hooks in config (comment out)
# Or allow developers to use --no-verify
```

---

## Execution Checklist

### Phase 1: Create Configuration Files

- [ ] Create `learn-greek-easy-backend/.flake8`
- [ ] Create `.pre-commit-config.yaml` at repository root
- [ ] Create `scripts/setup-hooks.sh`
- [ ] Make setup script executable: `chmod +x scripts/setup-hooks.sh`

### Phase 2: Test Locally

- [ ] Run `./scripts/setup-hooks.sh`
- [ ] Verify hooks install successfully
- [ ] Run `pre-commit run --all-files`
- [ ] Fix any existing violations (or document as known issues)
- [ ] Test each hook category with intentional violations
- [ ] Verify auto-fix works for Black, isort, ESLint, Prettier

### Phase 3: Update Documentation

- [ ] Add pre-commit section to `CLAUDE.md`
- [ ] Update main `README.md` with setup instructions (if exists)

### Phase 4: Create PR & Merge

- [ ] Create branch: `feature/pre-commit-hooks`
- [ ] Commit all files
- [ ] Create PR with description of changes
- [ ] Verify CI passes
- [ ] Merge to main

### Phase 5: Team Communication

- [ ] Notify team about new pre-commit hooks
- [ ] Share setup instructions
- [ ] Document in team wiki/docs

---

## Dependencies Check

Before starting implementation, verify these are installed:

| Tool | Check Command | Required Version |
|------|---------------|------------------|
| pre-commit | `pre-commit --version` | Any recent version |
| Node.js | `node --version` | 20.19.0+ |
| npm | `npm --version` | 10.0.0+ |
| Python | `python --version` | 3.13.x |
| Poetry | `poetry --version` | 2.0.0+ |

---

## References

- [Pre-commit Framework Documentation](https://pre-commit.com/)
- [Pre-commit Hooks Repository](https://github.com/pre-commit/pre-commit-hooks)
- [Black Formatter](https://black.readthedocs.io/)
- [Flake8 Documentation](https://flake8.pycqa.org/)
- [isort Documentation](https://pycqa.github.io/isort/)
- [MyPy Documentation](https://mypy.readthedocs.io/)
- [ESLint Documentation](https://eslint.org/)
- [Prettier Documentation](https://prettier.io/)

---

**Status**: ðŸ“‹ PLANNED - Ready for implementation
**Next Step**: Execute Phase 1 (Create Configuration Files)
