---
id: task-150
title: 07.02 Get Single Card Endpoint
status: Done
assignee: []
created_date: '2025-12-08 05:21'
updated_date: '2025-12-08 09:56'
labels:
  - backend
  - api
  - cards
  - task-07
dependencies: []
priority: high
ordinal: 7000
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
# 07.02 Get Single Card Endpoint

## Overview
Implement the GET /api/v1/cards/{id} endpoint for retrieving a single card by its UUID.

## Technical Specification

### Files to Modify

1. **Modify**: `src/api/v1/cards.py` - Add get_card endpoint

### Endpoint Implementation

Add to `src/api/v1/cards.py`:

```python
from src.core.exceptions import CardNotFoundException

@router.get(
    "/{card_id}",
    response_model=CardResponse,
    summary="Get card by ID",
    description="Get a single card by its UUID.",
    responses={
        200: {
            "description": "Card details",
            "content": {
                "application/json": {
                    "example": {
                        "id": "660e8400-e29b-41d4-a716-446655440001",
                        "deck_id": "550e8400-e29b-41d4-a716-446655440000",
                        "front_text": "kalimera",
                        "back_text": "good morning",
                        "example_sentence": "Kalimera! Pos eisai?",
                        "pronunciation": "kalimera",
                        "difficulty": "easy",
                        "order_index": 1,
                        "created_at": "2024-01-15T10:30:00Z",
                        "updated_at": "2024-01-15T10:30:00Z"
                    }
                }
            },
        },
        404: {"description": "Card not found"},
    },
)
async def get_card(
    card_id: UUID,
    db: AsyncSession = Depends(get_db),
) -> CardResponse:
    """Get a specific card by ID.

    This is a public endpoint that returns full card details.

    Args:
        card_id: UUID of the card to retrieve
        db: Database session (injected)

    Returns:
        CardResponse with card details

    Raises:
        CardNotFoundException: If card doesn't exist
    """
    repo = CardRepository(db)

    card = await repo.get(card_id)
    if card is None:
        raise CardNotFoundException(card_id=str(card_id))

    return CardResponse.model_validate(card)
```

### API Contract

**Endpoint**: GET /api/v1/cards/{card_id}

**Path Parameters**:
| Parameter | Type | Description |
|-----------|------|-------------|
| card_id | UUID | Card UUID |

**Response** (200 OK):
```json
{
  "id": "660e8400-e29b-41d4-a716-446655440001",
  "deck_id": "550e8400-e29b-41d4-a716-446655440000",
  "front_text": "kalimera",
  "back_text": "good morning",
  "example_sentence": "Kalimera! Pos eisai?",
  "pronunciation": "kalimera",
  "difficulty": "easy",
  "order_index": 1,
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z"
}
```

**Error Responses**:
- 404: Card not found
- 422: Invalid UUID format

### Implementation Notes

- Use CardResponse schema (already exists in `src/schemas/card.py`)
- Use CardNotFoundException from `src/core/exceptions.py`
- No authentication required (public endpoint)
- Return full card details including deck_id

### Route Ordering Note

IMPORTANT: This endpoint must be defined AFTER the /search endpoint in the router to avoid path conflicts (FastAPI matches routes in order).

## Verification Steps

1. Test endpoint with valid card_id returns card
2. Test endpoint with non-existent card_id returns 404
3. Test endpoint with invalid UUID format returns 422
4. Verify response includes all card fields
5. Verify card from inactive deck is still accessible
<!-- SECTION:DESCRIPTION:END -->

## Implementation Plan

<!-- SECTION:PLAN:BEGIN -->
## Implementation Plan

### Prerequisites
- [ ] Task-149 (07.01 Create Card Router and List by Deck Endpoint) must be completed first
  - This task creates `src/api/v1/cards.py` with the router
  - This task registers the card router in `src/api/v1/router.py`
  - The `CardListResponse` schema will be added to `src/schemas/card.py`
  - The `count_by_deck` method will be added to `src/repositories/card.py`
- [ ] Verify `CardNotFoundException` exists in `src/core/exceptions.py` (confirmed: lines 135-140)
- [ ] Verify `CardResponse` schema exists in `src/schemas/card.py` (confirmed: lines 50-59)
- [ ] Verify `CardRepository.get()` method is inherited from `BaseRepository` (confirmed: lines 44-58 in base.py)

### Step 1: Verify Cards Router Exists
**Goal**: Confirm task-149 is complete and the cards router file exists

**Actions**:
1. Check that `src/api/v1/cards.py` exists (created by task-149)
2. Verify the router is registered in `src/api/v1/router.py`
3. If task-149 is not complete, this task is blocked

**Verification**: File `src/api/v1/cards.py` exists and contains the router definition

### Step 2: Add Get Single Card Endpoint
**Goal**: Implement the GET /api/v1/cards/{card_id} endpoint

**Actions**:
1. Open `src/api/v1/cards.py`
2. Add import for `CardNotFoundException` from `src/core/exceptions`
3. Add the `get_card` endpoint function AFTER the `/search` endpoint (route ordering is critical)

**Files to modify**:
- `src/api/v1/cards.py` - Add the endpoint and import

**Verification**: Code compiles without errors

### Step 3: Verify Route Ordering
**Goal**: Ensure the endpoint is placed correctly to avoid path conflicts

**Route Order Should Be**:
1. `GET /` (list cards by deck) - from task-149
2. `GET /search` (search cards) - from task-151
3. `GET /{card_id}` (get single card) - THIS TASK
4. Admin endpoints (POST, PATCH, DELETE) - future tasks

**Verification**: The `get_card` function definition appears after `search_cards` in the file

### Step 4: Test Endpoint Manually
**Goal**: Verify the endpoint works correctly

**Test Cases**:
1. Valid card_id: Should return 200 OK with CardResponse JSON
2. Non-existent card_id: Should return 404 Not Found
3. Invalid UUID format: Should return 422 Validation Error

**Verification**: All three test cases return expected responses

### Step 5: Verify OpenAPI Documentation
**Goal**: Confirm the endpoint appears correctly in API docs

**Actions**:
1. Navigate to http://localhost:8000/docs
2. Verify `GET /api/v1/cards/{card_id}` is listed in Cards section
3. Check the response schema shows `CardResponse`

**Verification**: Endpoint is visible in Swagger UI with correct documentation

### Step 6: Run Existing Tests
**Goal**: Ensure no regressions in existing functionality

**Command**:
```bash
cd /Users/samosipov/Downloads/learn-greek-easy/learn-greek-easy-backend && \
/Users/samosipov/.local/bin/poetry run pytest -n auto
```

**Verification**: Test suite passes with no failures

### Step 7: Create Feature Branch and Commit
**Goal**: Follow git workflow for task implementation

**Commands**:
```bash
git checkout -b feature/task-150-get-single-card-endpoint
git add src/api/v1/cards.py
git commit -m "[task-150] Add GET /api/v1/cards/{card_id} endpoint"
```

**Verification**: Changes are committed to feature branch

---

## Summary of Changes

### Files to Modify
| File | Change |
|------|--------|
| `src/api/v1/cards.py` | Add `get_card` endpoint function and `CardNotFoundException` import |

### Dependencies
- **Blocking**: task-149 must be completed first (creates the cards.py file)

### API Contract
| Aspect | Value |
|--------|-------|
| Endpoint | `GET /api/v1/cards/{card_id}` |
| Auth Required | No (public endpoint) |
| Path Parameter | `card_id` (UUID) |
| Success Response | 200 OK with `CardResponse` |
| Error Responses | 404 (not found), 422 (invalid UUID) |

### Estimated Effort
- **Total steps**: 7
- **Complexity**: Low
- **Estimated time**: 15-30 minutes
- **Risk**: Low (follows established patterns from decks.py)
<!-- SECTION:PLAN:END -->

## Implementation Notes

<!-- SECTION:NOTES:BEGIN -->
- Use CardResponse schema (already exists in `src/schemas/card.py`)
- Use CardNotFoundException from `src/core/exceptions.py`
- No authentication required (public endpoint)
- Return full card details including deck_id

### Route Ordering Note

IMPORTANT: This endpoint must be defined AFTER the /search endpoint in the router to avoid path conflicts (FastAPI matches routes in order).

## Verification Steps

1. Test endpoint with valid card_id returns card
2. Test endpoint with non-existent card_id returns 404
3. Test endpoint with invalid UUID format returns 422
4. Verify response includes all card fields
5. Verify card from inactive deck is still accessible
<!-- SECTION:DESCRIPTION:END -->

PR: https://github.com/SimonOsipov/learn-greek-easy/pull/26

## QA Verification Report

**Verified by**: QA Agent
**Date**: 2025-12-08
**Status**: PASSED

### Verification Checklist

#### Task Specification Compliance
| Requirement | Status | Notes |
|-------------|--------|-------|
| Endpoint: GET /api/v1/cards/{card_id} | PASSED | Correctly implemented at line 132-184 |
| Path Parameter: card_id (UUID) | PASSED | Correctly typed as UUID |
| Response: CardResponse schema | PASSED | Returns all required fields |
| 404 on card not found | PASSED | Uses CardNotFoundException |
| 422 on invalid UUID | PASSED | FastAPI validation works correctly |
| No authentication required | PASSED | Public endpoint, no auth dependency |
| Route ordering note included | PASSED | Comment at lines 127-129 |

#### Verification Steps from Task
| Step | Status | Details |
|------|--------|-------|
| 1. Valid card_id returns card | PASSED | test_get_card_success |
| 2. Non-existent card_id returns 404 | PASSED | test_get_card_not_found |
| 3. Invalid UUID format returns 422 | PASSED | test_get_card_invalid_uuid |
| 4. Response includes all card fields | PASSED | test_get_card_includes_all_fields |
| 5. Card from inactive deck accessible | PASSED | test_get_card_from_inactive_deck_still_accessible |

### Code Review

**Implementation file**: `src/api/v1/cards.py` (lines 132-184)

**Code quality**:
- Follows existing patterns from decks.py
- Proper docstring with Args, Returns, Raises
- Uses CardRepository.get() from BaseRepository
- Proper exception handling with CardNotFoundException
- OpenAPI documentation complete with example response

### Test Coverage

**Tests added**:
- Integration tests: 5 tests in `tests/integration/api/test_cards.py::TestGetCardEndpoint`
- Unit tests: 4 tests in `tests/unit/api/test_cards.py::TestGetCardUnit`

**Coverage**: `src/api/v1/cards.py` - **100%** (18/18 statements)

**All tests passing**: 918 tests pass (increased from 909)

### Test Results Summary
```
tests/integration/api/test_cards.py::TestGetCardEndpoint::test_get_card_success PASSED
tests/integration/api/test_cards.py::TestGetCardEndpoint::test_get_card_not_found PASSED
tests/integration/api/test_cards.py::TestGetCardEndpoint::test_get_card_invalid_uuid PASSED
tests/integration/api/test_cards.py::TestGetCardEndpoint::test_get_card_includes_all_fields PASSED
tests/integration/api/test_cards.py::TestGetCardEndpoint::test_get_card_from_inactive_deck_still_accessible PASSED
tests/unit/api/test_cards.py::TestGetCardUnit::test_get_card_calls_repository_with_card_id PASSED
tests/unit/api/test_cards.py::TestGetCardUnit::test_get_card_not_found_returns_404 PASSED
tests/unit/api/test_cards.py::TestGetCardUnit::test_get_card_invalid_uuid_returns_422 PASSED
tests/unit/api/test_cards.py::TestGetCardUnit::test_get_card_response_format PASSED
```

### Issues Found
None. Implementation is complete and correct.

### Commits
- `acb8fb9` [task-150] Add GET /api/v1/cards/{card_id} endpoint
- `47fc6e6` [task-150] Add unit and integration tests for GET /api/v1/cards/{card_id} endpoint
<!-- SECTION:NOTES:END -->
