---
id: task-155
title: 07.07 Cards API Tests
status: To Do
assignee: []
created_date: '2025-12-08 05:21'
labels:
  - backend
  - testing
  - cards
  - task-07
dependencies: []
priority: medium
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
# 07.07 Cards API Tests

## Overview
Create comprehensive unit and integration tests for all Cards API endpoints.

## Files to Create

1. `tests/unit/api/test_cards.py` - Unit tests
2. `tests/integration/api/test_cards.py` - Integration tests

## Test Cases

### Unit Tests (test_cards.py)

#### TestListCards
- test_list_cards_success - Valid deck_id returns cards
- test_list_cards_pagination - Pagination works correctly
- test_list_cards_filter_by_difficulty - Difficulty filter works
- test_list_cards_invalid_deck - Invalid deck_id returns 404
- test_list_cards_missing_deck_id - Missing deck_id returns 422

#### TestGetCard
- test_get_card_success - Valid card_id returns card
- test_get_card_not_found - Non-existent card returns 404
- test_get_card_invalid_uuid - Invalid UUID returns 422

#### TestSearchCards
- test_search_cards_success - Search returns matching cards
- test_search_cards_with_deck_filter - Search with deck_id filter
- test_search_cards_empty_query - Empty query returns 422

#### TestCreateCard
- test_create_card_success - Admin can create card
- test_create_card_unauthorized - Unauthenticated returns 401
- test_create_card_forbidden - Non-admin returns 403
- test_create_card_invalid_deck - Invalid deck returns 404

#### TestBulkCreateCards
- test_bulk_create_success - Admin can bulk create
- test_bulk_create_too_many_cards - >100 cards returns 422

#### TestUpdateCard
- test_update_card_success - Admin can update card
- test_update_card_not_found - Non-existent card returns 404

#### TestDeleteCard
- test_delete_card_success - Admin can delete card
- test_delete_card_not_found - Non-existent card returns 404

### Integration Tests (test_cards_integration.py)

- test_card_crud_flow - Full create-read-update-delete flow
- test_card_search_integration - Search with real database
- test_bulk_create_integration - Bulk create with database

## Required Fixtures

Add to `tests/conftest.py`:

```python
@pytest.fixture
async def test_card(db_session, test_deck):
    from tests.factories.content import CardFactory
    return await CardFactory.create(session=db_session, deck_id=test_deck.id)

@pytest.fixture
async def test_deck_with_cards(db_session):
    from tests.factories.content import DeckFactory
    return await DeckFactory.create_with_cards(session=db_session, card_count=5)

@pytest.fixture
async def auth_headers_admin(async_client, test_admin_user):
    response = await async_client.post(
        "/api/v1/auth/login",
        json={"email": test_admin_user.email, "password": "testpassword"}
    )
    token = response.json()["access_token"]
    return {"Authorization": f"Bearer {token}"}
```

## Verification Steps

1. Run tests: `pytest tests/unit/api/test_cards.py -v`
2. Run integration tests: `pytest tests/integration/api/test_cards.py -v`
3. Check coverage: `pytest --cov=src/api/v1/cards`
4. Ensure all tests pass
5. Aim for >80% coverage
<!-- SECTION:DESCRIPTION:END -->
