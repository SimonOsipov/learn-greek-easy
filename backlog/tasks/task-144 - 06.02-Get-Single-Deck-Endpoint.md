---
id: task-144
title: '[06.02] Get Single Deck Endpoint'
status: To Do
assignee: []
created_date: '2025-12-07 14:10'
labels:
  - backend
  - deck-api
  - task-6
dependencies: []
priority: high
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
# [06.02] Get Single Deck Endpoint

## Goal/Purpose

Implement the `GET /api/v1/decks/{id}` endpoint that returns a single deck by its UUID, including the card count. This endpoint provides detailed deck information for users who want to view a specific deck before studying it.

## Dependencies

| Component | Location | Usage |
|-----------|----------|-------|
| DeckRepository | `src/repositories/deck.py` | `get_or_404()`, `count_cards()` |
| Deck Schemas | `src/schemas/deck.py` | `DeckResponse`, new `DeckDetailResponse` |
| Exceptions | `src/core/exceptions.py` | `DeckNotFoundException` |
| Deck Router | `src/api/v1/decks.py` | Add endpoint to existing router |

## Implementation Steps

### Step 1: Create DeckDetailResponse Schema

Add to `src/schemas/deck.py`:

```python
class DeckDetailResponse(DeckResponse):
    """Schema for deck detail with card count."""
    card_count: int

    model_config = ConfigDict(from_attributes=True)
```

### Step 2: Implement Get Deck Endpoint

Add to `src/api/v1/decks.py`:

```python
from src.core.exceptions import DeckNotFoundException
from src.schemas.deck import DeckDetailResponse

@router.get(
    "/{deck_id}",
    response_model=DeckDetailResponse,
    summary="Get deck by ID",
    description="Get a single deck by its UUID, including the card count.",
    responses={
        404: {"description": "Deck not found"},
    },
)
async def get_deck(
    deck_id: UUID,
    db: AsyncSession = Depends(get_db),
) -> DeckDetailResponse:
    """
    Get a specific deck by ID with card count.

    - **deck_id**: UUID of the deck to retrieve

    Returns 404 if deck doesn't exist or is inactive.
    """
    repo = DeckRepository(db)

    # Get deck or raise 404
    deck = await repo.get(deck_id)
    if deck is None or not deck.is_active:
        raise DeckNotFoundException(deck_id=str(deck_id))

    # Get card count
    card_count = await repo.count_cards(deck_id)

    # Build response
    deck_data = DeckResponse.model_validate(deck).model_dump()
    deck_data["card_count"] = card_count

    return DeckDetailResponse(**deck_data)
```

### Step 3: Ensure count_cards Method Exists

Verify `src/repositories/deck.py` has the `count_cards` method:

```python
async def count_cards(self, deck_id: UUID) -> int:
    """Count the number of cards in a deck."""
    from src.db.models import Card
    query = select(func.count(Card.id)).where(Card.deck_id == deck_id)
    result = await self.session.execute(query)
    return result.scalar() or 0
```

### Step 4: Ensure DeckNotFoundException Exists

Verify `src/core/exceptions.py` has:

```python
class DeckNotFoundException(HTTPException):
    """Raised when a deck is not found."""
    def __init__(self, deck_id: str):
        super().__init__(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"Deck with ID {deck_id} not found",
        )
```

## Files to Create/Modify

| File | Action | Description |
|------|--------|-------------|
| `src/api/v1/decks.py` | MODIFY | Add get_deck endpoint |
| `src/schemas/deck.py` | MODIFY | Add DeckDetailResponse schema |
| `src/repositories/deck.py` | VERIFY | Ensure count_cards method exists |
| `src/core/exceptions.py` | VERIFY | Ensure DeckNotFoundException exists |

## API Specification

### GET /api/v1/decks/{deck_id}

**Path Parameters**:
| Parameter | Type | Description |
|-----------|------|-------------|
| `deck_id` | UUID | Deck UUID |

**Response** (200 OK):
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Greek A1 Vocabulary",
  "description": "Essential beginner vocabulary for Greek learners",
  "level": "A1",
  "is_active": true,
  "card_count": 50,
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-15T10:30:00Z"
}
```

**Error Responses**:
- 404: `{"detail": "Deck with ID {deck_id} not found"}`
- 422: Invalid UUID format (automatic FastAPI validation)

## Acceptance Criteria

- [ ] GET /api/v1/decks/{id} endpoint implemented
- [ ] Returns deck with card_count field
- [ ] Returns 404 for non-existent deck
- [ ] Returns 404 for inactive deck (is_active=False)
- [ ] DeckDetailResponse schema created with card_count field
- [ ] Invalid UUID returns 422 validation error
- [ ] Response includes all deck fields plus card_count

## Testing Requirements

Manual verification:
```bash
# Get existing deck
curl http://localhost:8000/api/v1/decks/550e8400-e29b-41d4-a716-446655440000

# Non-existent deck (should return 404)
curl http://localhost:8000/api/v1/decks/00000000-0000-0000-0000-000000000000

# Invalid UUID (should return 422)
curl http://localhost:8000/api/v1/decks/not-a-uuid
```

## Notes

- This is a public endpoint (no authentication required)
- Inactive decks should return 404 to public users
- The card_count is calculated via a separate count query
- The endpoint path `/{deck_id}` must be placed after `/search` to avoid route conflicts
<!-- SECTION:DESCRIPTION:END -->
