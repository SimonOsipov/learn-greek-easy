---
id: task-152
title: 07.04 Create Card Endpoint (Admin)
status: To Do
assignee: []
created_date: '2025-12-08 05:21'
updated_date: '2025-12-08 14:09'
labels:
  - backend
  - api
  - cards
  - task-07
dependencies: []
priority: high
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
# 07.04 Create Card Endpoint (Admin)

## Overview
Implement the POST /api/v1/cards endpoint for creating a new card. This is an admin-only endpoint requiring superuser privileges.

## Technical Specification

### Files to Modify

1. **Modify**: `src/api/v1/cards.py` - Add create_card endpoint

### Endpoint Implementation

Add to `src/api/v1/cards.py`:

```python
from fastapi import status
from src.core.dependencies import get_current_superuser
from src.db.models import User
from src.schemas.card import CardCreate

@router.post(
    "",
    response_model=CardResponse,
    status_code=status.HTTP_201_CREATED,
    summary="Create a new card",
    description="Create a new card in a deck. Requires superuser privileges.",
    responses={
        201: {
            "description": "Card created successfully",
            "content": {
                "application/json": {
                    "example": {
                        "id": "660e8400-e29b-41d4-a716-446655440002",
                        "deck_id": "550e8400-e29b-41d4-a716-446655440000",
                        "front_text": "efharisto",
                        "back_text": "thank you",
                        "example_sentence": "Efharisto poly!",
                        "pronunciation": "efharisto",
                        "difficulty": "easy",
                        "order_index": 0,
                        "created_at": "2024-01-15T10:30:00Z",
                        "updated_at": "2024-01-15T10:30:00Z"
                    }
                }
            },
        },
        401: {"description": "Not authenticated"},
        403: {"description": "Not authorized (requires superuser)"},
        404: {"description": "Deck not found"},
        422: {"description": "Validation error"},
    },
)
async def create_card(
    card_data: CardCreate,
    db: AsyncSession = Depends(get_db),
    current_user: User = Depends(get_current_superuser),
) -> CardResponse:
    """Create a new card.

    Requires superuser privileges.

    Args:
        card_data: Card creation data
        db: Database session (injected)
        current_user: Authenticated superuser (injected)

    Returns:
        CardResponse: The created card

    Raises:
        401: If not authenticated
        403: If authenticated but not superuser
        404: If deck doesn't exist
        422: If validation fails
    """
    # Validate deck exists
    deck_repo = DeckRepository(db)
    deck = await deck_repo.get(card_data.deck_id)
    if deck is None:
        raise DeckNotFoundException(deck_id=str(card_data.deck_id))

    # Create the card
    card_repo = CardRepository(db)
    card = await card_repo.create(card_data)

    # Commit the transaction
    await db.commit()
    await db.refresh(card)

    return CardResponse.model_validate(card)
```

### API Contract

**Endpoint**: POST /api/v1/cards

**Authentication**: Required (superuser)

**Request Body**:
```json
{
  "deck_id": "550e8400-e29b-41d4-a716-446655440000",
  "front_text": "efharisto",
  "back_text": "thank you",
  "example_sentence": "Efharisto poly!",
  "pronunciation": "efharisto",
  "difficulty": "easy",
  "order_index": 0
}
```

**Validation Rules** (from existing CardCreate schema):
- `deck_id`: Required, valid UUID
- `front_text`: Required, min 1 character
- `back_text`: Required, min 1 character
- `example_sentence`: Optional
- `pronunciation`: Optional, max 255 characters
- `difficulty`: Required, one of: easy, medium, hard
- `order_index`: Optional, defaults to 0, must be >= 0

**Response** (201 Created):
```json
{
  "id": "...",
  "deck_id": "...",
  "front_text": "efharisto",
  "back_text": "thank you",
  "example_sentence": "Efharisto poly!",
  "pronunciation": "efharisto",
  "difficulty": "easy",
  "order_index": 0,
  "created_at": "...",
  "updated_at": "..."
}
```

**Error Responses**:
- 401: Not authenticated
- 403: Not a superuser
- 404: Deck not found
- 422: Validation error

### Implementation Notes

- Use existing CardCreate schema from `src/schemas/card.py`
- Use `get_current_superuser` dependency for auth
- Validate deck exists before creating card
- Allow creating cards in inactive decks (admin privilege)
- Use BaseRepository.create() pattern

## Verification Steps

1. Test admin can create card successfully
2. Test non-admin user gets 403
3. Test unauthenticated request gets 401
4. Test invalid deck_id returns 404
5. Test validation errors return 422
6. Verify created card has correct fields
7. Verify card is associated with correct deck
<!-- SECTION:DESCRIPTION:END -->
