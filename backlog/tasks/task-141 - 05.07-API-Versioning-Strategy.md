---
id: task-141
title: 05.07 API Versioning Strategy
status: In Progress
assignee: []
created_date: '2025-12-07 09:50'
updated_date: '2025-12-07 13:03'
labels:
  - backend
  - api
  - architecture
  - task-05
  - refactoring
dependencies: []
priority: low
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
## API Versioning Strategy (05.07)

### Overview
Implement a proper API versioning structure to ensure:
1. Consistent `/api/v1/` prefix usage across all endpoints
2. Centralized v1 router aggregation for easier management
3. Preparedness for future v2 API without breaking changes

### Current State Analysis
- `settings.api_v1_prefix` is defined as `/api/v1` in config.py
- Auth router has **hardcoded** `prefix="/api/v1/auth"` instead of using settings
- `src/api/v1/` directory exists but lacks unified router structure
- Main.py has TODO comments for future routes (deck, card, review, progress)
- Health router is mounted at root level (not versioned - correct for health checks)

### Technical Requirements

#### 1. Create Unified V1 Router (`src/api/v1/router.py`)
Create a central v1 router that aggregates all v1 endpoints:
```python
from fastapi import APIRouter
from src.api.v1.auth import router as auth_router

v1_router = APIRouter()
v1_router.include_router(auth_router, prefix="/auth", tags=["Authentication"])
# Future: v1_router.include_router(deck_router, prefix="/decks", tags=["Decks"])
```

#### 2. Refactor Auth Router
Remove hardcoded prefix from auth router - it should be mounted with prefix by parent router:
- Change from: `prefix="/api/v1/auth"`
- Change to: `prefix=""` (or no prefix)

#### 3. Update Main.py
Mount the unified v1 router with the versioned prefix:
```python
from src.api.v1.router import v1_router
app.include_router(v1_router, prefix=settings.api_v1_prefix)
```

#### 4. Document Future V2 Strategy
Add placeholder structure and documentation comment for v2:
- Create `src/api/v2/__init__.py` (empty, placeholder)
- Add comments in main.py showing how v2 would be added

### Files to Modify
1. `src/api/v1/router.py` - **CREATE** - Central v1 router
2. `src/api/v1/auth.py` - **MODIFY** - Remove hardcoded prefix
3. `src/api/v1/__init__.py` - **MODIFY** - Export v1_router
4. `src/main.py` - **MODIFY** - Use centralized v1 router
5. `src/api/v2/__init__.py` - **CREATE** - Placeholder for future v2

### Backward Compatibility
- All existing endpoints remain at same URLs
- `/api/v1/auth/*` endpoints continue working identically
- Health endpoints stay at `/health*` (not versioned)
- Root endpoint stays at `/`

### Testing Strategy
- Run existing tests to verify no regressions
- Verify auth endpoints respond at same URLs
- Check OpenAPI docs show correct paths
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
- [ ] #1 All v1 endpoints use centralized v1_router
- [ ] #2 Auth router no longer has hardcoded /api/v1 prefix
- [ ] #3 v1_router is mounted with settings.api_v1_prefix in main.py
- [ ] #4 All existing auth endpoints work at same URLs
- [ ] #5 Health endpoints remain at /health* (unversioned)
- [ ] #6 Placeholder v2 directory created for future use
- [ ] #7 All existing tests pass
- [ ] #8 OpenAPI docs show correct endpoint paths
<!-- AC:END -->
